
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
        <meta name="author" content="Erfan Zare Chavoshi">
      
      
      
        <link rel="prev" href="../lib-python-EasyDel-modules-palm-modelling_palm_flax/">
      
      
        <link rel="next" href="../lib-python-EasyDel-modules-gpt_neo_x-modelling_gpt_neo_x_flax/">
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.5.3, mkdocs-material-9.4.14">
    
    
      
        <title>flax_modelling_utils - EasyDel</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.fad675c6.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#modulesflax_modelling_utils" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="EasyDel" class="md-header__button md-logo" aria-label="EasyDel" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            EasyDel
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              flax_modelling_utils
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/erfanzar/EasyDel" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="EasyDel" class="md-nav__button md-logo" aria-label="EasyDel" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    EasyDel
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/erfanzar/EasyDel" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../Install/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Install
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../AvailableModels/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    AvailableModels
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../Bits/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    EasyBIT
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Eval
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            Eval
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../lib-python-EasyDel-eval-lm_eval/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    lm_eval
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" >
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Transform
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            Transform
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../lib-python-EasyDel-transform-easydel_transform/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    easydel_transform
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../lib-python-EasyDel-transform-mpt/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    mpt
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../lib-python-EasyDel-transform-llama/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    llama
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../lib-python-EasyDel-transform-falcon/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    falcon
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../lib-python-EasyDel-transform-mistral/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    mistral
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../lib-python-EasyDel-transform-utils/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    utils
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../lib-python-EasyDel-smi-smi/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    smi
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8" >
        
          
          <label class="md-nav__link" for="__nav_8" id="__nav_8_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Serve
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8">
            <span class="md-nav__icon md-icon"></span>
            Serve
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../lib-python-EasyDel-serve-torch_serve/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    torch_serve
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../lib-python-EasyDel-serve-jax_serve/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    jax_serve
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../lib-python-EasyDel-serve-utils/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    utils
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_9" checked>
        
          
          <label class="md-nav__link" for="__nav_9" id="__nav_9_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Modules
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_9_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_9">
            <span class="md-nav__icon md-icon"></span>
            Modules
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../lib-python-EasyDel-modules-falcon-modelling_falcon_flax/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Falcon
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../lib-python-EasyDel-modules-palm-modelling_palm_flax/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Palm
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    flax_modelling_utils
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    flax_modelling_utils
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#lib.python.EasyDel.modules.flax_modelling_utils" class="md-nav__link">
    <span class="md-ellipsis">
      flax_modelling_utils
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lib.python.EasyDel.modules.flax_modelling_utils.JaxBaseClassModel" class="md-nav__link">
    <span class="md-ellipsis">
      JaxBaseClassModel
    </span>
  </a>
  
    <nav class="md-nav" aria-label="JaxBaseClassModel">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#lib.python.EasyDel.modules.flax_modelling_utils.JaxBaseClassModel.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__()
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#lib.python.EasyDel.modules.flax_modelling_utils.JaxBaseClassModel.get_axis_dims" class="md-nav__link">
    <span class="md-ellipsis">
      get_axis_dims()
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#lib.python.EasyDel.modules.flax_modelling_utils.JaxBaseClassModel.get_axis_names" class="md-nav__link">
    <span class="md-ellipsis">
      get_axis_names()
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#lib.python.EasyDel.modules.flax_modelling_utils.JaxBaseClassModel.get_backend" class="md-nav__link">
    <span class="md-ellipsis">
      get_backend()
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#lib.python.EasyDel.modules.flax_modelling_utils.JaxBaseClassModel.get_flash_attention" class="md-nav__link">
    <span class="md-ellipsis">
      get_flash_attention()
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#lib.python.EasyDel.modules.flax_modelling_utils.JaxBaseClassModel.jax_mesh" class="md-nav__link">
    <span class="md-ellipsis">
      jax_mesh()
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lib.python.EasyDel.modules.flax_modelling_utils.add_start_docstrings" class="md-nav__link">
    <span class="md-ellipsis">
      add_start_docstrings()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lib.python.EasyDel.modules.flax_modelling_utils.apply_rotary_pos_emb" class="md-nav__link">
    <span class="md-ellipsis">
      apply_rotary_pos_emb()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lib.python.EasyDel.modules.flax_modelling_utils.canonicalize_dtype" class="md-nav__link">
    <span class="md-ellipsis">
      canonicalize_dtype()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lib.python.EasyDel.modules.flax_modelling_utils.create_mesh" class="md-nav__link">
    <span class="md-ellipsis">
      create_mesh()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lib.python.EasyDel.modules.flax_modelling_utils.get_flash_attention" class="md-nav__link">
    <span class="md-ellipsis">
      get_flash_attention()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lib.python.EasyDel.modules.flax_modelling_utils.get_gradient_checkpoint_policy" class="md-nav__link">
    <span class="md-ellipsis">
      get_gradient_checkpoint_policy()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lib.python.EasyDel.modules.flax_modelling_utils.get_names_from_partition_spec" class="md-nav__link">
    <span class="md-ellipsis">
      get_names_from_partition_spec()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lib.python.EasyDel.modules.flax_modelling_utils.get_ranks_and_size" class="md-nav__link">
    <span class="md-ellipsis">
      get_ranks_and_size()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lib.python.EasyDel.modules.flax_modelling_utils.names_in_mesh" class="md-nav__link">
    <span class="md-ellipsis">
      names_in_mesh()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lib.python.EasyDel.modules.flax_modelling_utils.precompute_freq_cis" class="md-nav__link">
    <span class="md-ellipsis">
      precompute_freq_cis()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lib.python.EasyDel.modules.flax_modelling_utils.repeat_kv_bnsh" class="md-nav__link">
    <span class="md-ellipsis">
      repeat_kv_bnsh()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lib.python.EasyDel.modules.flax_modelling_utils.repeat_kv_bsnh" class="md-nav__link">
    <span class="md-ellipsis">
      repeat_kv_bsnh()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lib.python.EasyDel.modules.flax_modelling_utils.rotate_half" class="md-nav__link">
    <span class="md-ellipsis">
      rotate_half()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lib.python.EasyDel.modules.flax_modelling_utils.smart_flash_attention" class="md-nav__link">
    <span class="md-ellipsis">
      smart_flash_attention()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lib.python.EasyDel.modules.flax_modelling_utils.with_sharding_constraint" class="md-nav__link">
    <span class="md-ellipsis">
      with_sharding_constraint()
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../lib-python-EasyDel-modules-gpt_neo_x-modelling_gpt_neo_x_flax/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    GPT-Neox
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../lib-python-EasyDel-modules-gpt_j-modelling_gpt_j_flax/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    GPT-J
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../lib-python-EasyDel-modules-mistral-modelling_mistral_flax/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Mistral
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../lib-python-EasyDel-modules-auto_models/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    auto_models
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../lib-python-EasyDel-modules-lucid_transformer-modelling_lt_flax/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    LucidTransformers
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../lib-python-EasyDel-modules-opt-modelling_opt_flax/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    OPT
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../lib-python-EasyDel-modules-mosaic_mpt-modelling_mpt_flax/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    MPT
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../lib-python-EasyDel-modules-llama-modelling_llama_flax/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Llama
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../lib-python-EasyDel-modules-t5-modelling_t5_flax/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    T5
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../lib-python-EasyDel-configs-configs/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    configs
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_11" >
        
          
          <label class="md-nav__link" for="__nav_11" id="__nav_11_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Utils
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_11_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_11">
            <span class="md-nav__icon md-icon"></span>
            Utils
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../lib-python-EasyDel-utils-tensor_utils/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    tensor_utils
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../lib-python-EasyDel-utils-prompters/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    prompters
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../lib-python-EasyDel-utils-utils/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    utils
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../lib-python-EasyDel-utils-checker/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    checker
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_12" >
        
          
          <label class="md-nav__link" for="__nav_12" id="__nav_12_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    RLHF
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_12_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_12">
            <span class="md-nav__icon md-icon"></span>
            RLHF
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../lib-python-EasyDel-rlhf-trainer/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    trainer
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../lib-python-EasyDel-rlhf-reward/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    reward
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../lib-python-EasyDel-rlhf-ppo/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ppo
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../lib-python-EasyDel-rlhf-utils/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    utils
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_13" >
        
          
          <label class="md-nav__link" for="__nav_13" id="__nav_13_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Trainer
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_13_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_13">
            <span class="md-nav__icon md-icon"></span>
            Trainer
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../lib-python-EasyDel-trainer-fsdp_train/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    fsdp_train
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../lib-python-EasyDel-trainer-config/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    config
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../lib-python-EasyDel-trainer-tf_dataset/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    tf_dataset
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../lib-python-EasyDel-trainer-training_utils/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    training_utils
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_14" >
        
          
          <label class="md-nav__link" for="__nav_14" id="__nav_14_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Linen
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_14_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_14">
            <span class="md-nav__icon md-icon"></span>
            Linen
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../lib-python-EasyDel-linen-bits/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    bits
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../lib-python-EasyDel-linen-utils/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    utils
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_15" >
        
          
          <label class="md-nav__link" for="__nav_15" id="__nav_15_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    RL Trainer
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_15_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_15">
            <span class="md-nav__icon md-icon"></span>
            RL Trainer
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../lib-python-EasyDel-rl_trainer-models-modelling_base.md" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    models/modelling_base
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../lib-python-EasyDel-rl_trainer-models-modelling_value_head.md" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    models/modelling_value_head
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../lib-python-EasyDel-rl_trainer-core.md" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    core
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_16" >
        
          
          <label class="md-nav__link" for="__nav_16" id="__nav_16_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Data Preprocessing
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_16_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_16">
            <span class="md-nav__icon md-icon"></span>
            Data Preprocessing
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../lib-python-EasyDel-data_preprocessing-_processor/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    data_preprocessing/_processor
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_17" >
        
          
          <label class="md-nav__link" for="__nav_17" id="__nav_17_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Examples
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_17_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_17">
            <span class="md-nav__icon md-icon"></span>
            Examples
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../PyTorchServer/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    PytorchServer
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../JAXServer/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    JAXServer
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../DataProcessing/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    DataProcessing
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../TrainingExample/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    TrainingExample
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Falcon/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Falcon Models
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Llama/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Llama Models
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Llama2/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Llama2 Models
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Mistral/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Mistral Models
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../MosaicMPT/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    MosaicMPT Models
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#lib.python.EasyDel.modules.flax_modelling_utils" class="md-nav__link">
    <span class="md-ellipsis">
      flax_modelling_utils
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lib.python.EasyDel.modules.flax_modelling_utils.JaxBaseClassModel" class="md-nav__link">
    <span class="md-ellipsis">
      JaxBaseClassModel
    </span>
  </a>
  
    <nav class="md-nav" aria-label="JaxBaseClassModel">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#lib.python.EasyDel.modules.flax_modelling_utils.JaxBaseClassModel.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__()
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#lib.python.EasyDel.modules.flax_modelling_utils.JaxBaseClassModel.get_axis_dims" class="md-nav__link">
    <span class="md-ellipsis">
      get_axis_dims()
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#lib.python.EasyDel.modules.flax_modelling_utils.JaxBaseClassModel.get_axis_names" class="md-nav__link">
    <span class="md-ellipsis">
      get_axis_names()
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#lib.python.EasyDel.modules.flax_modelling_utils.JaxBaseClassModel.get_backend" class="md-nav__link">
    <span class="md-ellipsis">
      get_backend()
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#lib.python.EasyDel.modules.flax_modelling_utils.JaxBaseClassModel.get_flash_attention" class="md-nav__link">
    <span class="md-ellipsis">
      get_flash_attention()
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#lib.python.EasyDel.modules.flax_modelling_utils.JaxBaseClassModel.jax_mesh" class="md-nav__link">
    <span class="md-ellipsis">
      jax_mesh()
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lib.python.EasyDel.modules.flax_modelling_utils.add_start_docstrings" class="md-nav__link">
    <span class="md-ellipsis">
      add_start_docstrings()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lib.python.EasyDel.modules.flax_modelling_utils.apply_rotary_pos_emb" class="md-nav__link">
    <span class="md-ellipsis">
      apply_rotary_pos_emb()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lib.python.EasyDel.modules.flax_modelling_utils.canonicalize_dtype" class="md-nav__link">
    <span class="md-ellipsis">
      canonicalize_dtype()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lib.python.EasyDel.modules.flax_modelling_utils.create_mesh" class="md-nav__link">
    <span class="md-ellipsis">
      create_mesh()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lib.python.EasyDel.modules.flax_modelling_utils.get_flash_attention" class="md-nav__link">
    <span class="md-ellipsis">
      get_flash_attention()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lib.python.EasyDel.modules.flax_modelling_utils.get_gradient_checkpoint_policy" class="md-nav__link">
    <span class="md-ellipsis">
      get_gradient_checkpoint_policy()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lib.python.EasyDel.modules.flax_modelling_utils.get_names_from_partition_spec" class="md-nav__link">
    <span class="md-ellipsis">
      get_names_from_partition_spec()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lib.python.EasyDel.modules.flax_modelling_utils.get_ranks_and_size" class="md-nav__link">
    <span class="md-ellipsis">
      get_ranks_and_size()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lib.python.EasyDel.modules.flax_modelling_utils.names_in_mesh" class="md-nav__link">
    <span class="md-ellipsis">
      names_in_mesh()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lib.python.EasyDel.modules.flax_modelling_utils.precompute_freq_cis" class="md-nav__link">
    <span class="md-ellipsis">
      precompute_freq_cis()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lib.python.EasyDel.modules.flax_modelling_utils.repeat_kv_bnsh" class="md-nav__link">
    <span class="md-ellipsis">
      repeat_kv_bnsh()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lib.python.EasyDel.modules.flax_modelling_utils.repeat_kv_bsnh" class="md-nav__link">
    <span class="md-ellipsis">
      repeat_kv_bsnh()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lib.python.EasyDel.modules.flax_modelling_utils.rotate_half" class="md-nav__link">
    <span class="md-ellipsis">
      rotate_half()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lib.python.EasyDel.modules.flax_modelling_utils.smart_flash_attention" class="md-nav__link">
    <span class="md-ellipsis">
      smart_flash_attention()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lib.python.EasyDel.modules.flax_modelling_utils.with_sharding_constraint" class="md-nav__link">
    <span class="md-ellipsis">
      with_sharding_constraint()
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  


<h1 id="modulesflax_modelling_utils">modules.flax_modelling_utils</h1>


<div class="doc doc-object doc-module">



<a id="lib.python.EasyDel.modules.flax_modelling_utils"></a>
  <div class="doc doc-contents first">

  

  <div class="doc doc-children">








<div class="doc doc-object doc-class">




<h2 id="lib.python.EasyDel.modules.flax_modelling_utils.JaxBaseClassModel" class="doc doc-heading">
          <code>JaxBaseClassModel</code>


</h2>


  <div class="doc doc-contents ">

  
      <p>It initializes all the attributes of an object, and it's called when you create a new instance of that class.</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>self</code></td>
          <td>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Refer to the instance of the class</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>axis_dims</code></td>
          <td>
                <code><span title="typing.Sequence">Sequence</span>[int]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Sequence[int]: Specify the number of dimensions for each axis</p>
            </div>
          </td>
          <td>
                <code>(1, -1, 1, 1)</code>
          </td>
        </tr>
        <tr>
          <td><code>axis_names</code></td>
          <td>
                <code><span title="typing.Sequence">Sequence</span>[str]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Sequence[str]: Set the names of the axes</p>
            </div>
          </td>
          <td>
                <code>(&#39;dp&#39;, &#39;fsdp&#39;, &#39;tp&#39;, &#39;mp&#39;)</code>
          </td>
        </tr>
        <tr>
          <td><code>q_ps</code></td>
          <td>
                <code><span title="jax.sharding.PartitionSpec">PartitionSpec</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>jax.sharding.PartitionSpec: Specify the partitioning of the query tensor</p>
            </div>
          </td>
          <td>
                <code><span title="jax.sharding.PartitionSpec">PartitionSpec</span>((&#39;dp&#39;, &#39;fsdp&#39;), &#39;mp&#39;, &#39;tp&#39;, None)</code>
          </td>
        </tr>
        <tr>
          <td><code>k_ps</code></td>
          <td>
                <code><span title="jax.sharding.PartitionSpec">PartitionSpec</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>jax.sharding.PartitionSpec: Partition the key matrix</p>
            </div>
          </td>
          <td>
                <code><span title="jax.sharding.PartitionSpec">PartitionSpec</span>((&#39;dp&#39;, &#39;fsdp&#39;), &#39;mp&#39;, &#39;tp&#39;, None)</code>
          </td>
        </tr>
        <tr>
          <td><code>v_ps</code></td>
          <td>
                <code><span title="jax.sharding.PartitionSpec">PartitionSpec</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>jax.sharding.PartitionSpec: Specify the partitioning of the value tensor</p>
            </div>
          </td>
          <td>
                <code><span title="jax.sharding.PartitionSpec">PartitionSpec</span>((&#39;dp&#39;, &#39;fsdp&#39;), &#39;mp&#39;, &#39;tp&#39;, None)</code>
          </td>
        </tr>
        <tr>
          <td><code>b_ps</code></td>
          <td>
                <code><span title="jax.sharding.PartitionSpec">PartitionSpec</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>jax.sharding.PartitionSpec: Specify the Attention Bias partition spec</p>
            </div>
          </td>
          <td>
                <code><span title="jax.sharding.PartitionSpec">PartitionSpec</span>(&#39;dp&#39;, None, (&#39;dp&#39;, &#39;fsdp&#39;), None)</code>
          </td>
        </tr>
        <tr>
          <td><code>a_ps</code></td>
          <td>
                <code><span title="jax.sharding.PartitionSpec">PartitionSpec</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>jax.sharding.PartitionSpec: Specify the partitioning of the attention weights</p>
            </div>
          </td>
          <td>
                <code><span title="jax.sharding.PartitionSpec">PartitionSpec</span>((&#39;dp&#39;, &#39;fsdp&#39;), &#39;mp&#39;, &#39;tp&#39;, None)</code>
          </td>
        </tr>
        <tr>
          <td><code>backend</code></td>
          <td>
                <code><span title="typing.Optional">Optional</span>[None]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Optional[None]: Specify the backend to use</p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
    </tbody>
  </table>

            <details class="quote">
              <summary>Source code in <code>lib/python/EasyDel/modules/flax_modelling_utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">JaxBaseClassModel</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    It initializes all the attributes of an object, and it&#39;s called when you create a new instance of that class.</span>
<span class="sd">    :param self: Refer to the instance of the class</span>
<span class="sd">    :param axis_dims: Sequence[int]: Specify the number of dimensions for each axis</span>
<span class="sd">    :param axis_names: Sequence[str]: Set the names of the axes</span>
<span class="sd">    :param q_ps: jax.sharding.PartitionSpec: Specify the partitioning of the query tensor</span>
<span class="sd">    :param k_ps: jax.sharding.PartitionSpec: Partition the key matrix</span>
<span class="sd">    :param v_ps: jax.sharding.PartitionSpec: Specify the partitioning of the value tensor</span>
<span class="sd">    :param b_ps: jax.sharding.PartitionSpec: Specify the Attention Bias partition spec</span>
<span class="sd">    :param a_ps: jax.sharding.PartitionSpec: Specify the partitioning of the attention weights</span>
<span class="sd">    :param backend: Optional[None]: Specify the backend to use</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">axis_dims</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
            <span class="n">axis_names</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;dp&quot;</span><span class="p">,</span> <span class="s2">&quot;fsdp&quot;</span><span class="p">,</span> <span class="s2">&quot;tp&quot;</span><span class="p">,</span> <span class="s2">&quot;mp&quot;</span><span class="p">),</span>
            <span class="n">q_ps</span><span class="p">:</span> <span class="n">jax</span><span class="o">.</span><span class="n">sharding</span><span class="o">.</span><span class="n">PartitionSpec</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">sharding</span><span class="o">.</span><span class="n">PartitionSpec</span><span class="p">((</span><span class="s2">&quot;dp&quot;</span><span class="p">,</span> <span class="s2">&quot;fsdp&quot;</span><span class="p">),</span> <span class="s2">&quot;mp&quot;</span><span class="p">,</span> <span class="s2">&quot;tp&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
            <span class="n">k_ps</span><span class="p">:</span> <span class="n">jax</span><span class="o">.</span><span class="n">sharding</span><span class="o">.</span><span class="n">PartitionSpec</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">sharding</span><span class="o">.</span><span class="n">PartitionSpec</span><span class="p">((</span><span class="s2">&quot;dp&quot;</span><span class="p">,</span> <span class="s2">&quot;fsdp&quot;</span><span class="p">),</span> <span class="s2">&quot;mp&quot;</span><span class="p">,</span> <span class="s2">&quot;tp&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
            <span class="n">v_ps</span><span class="p">:</span> <span class="n">jax</span><span class="o">.</span><span class="n">sharding</span><span class="o">.</span><span class="n">PartitionSpec</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">sharding</span><span class="o">.</span><span class="n">PartitionSpec</span><span class="p">((</span><span class="s2">&quot;dp&quot;</span><span class="p">,</span> <span class="s2">&quot;fsdp&quot;</span><span class="p">),</span> <span class="s2">&quot;mp&quot;</span><span class="p">,</span> <span class="s2">&quot;tp&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
            <span class="n">b_ps</span><span class="p">:</span> <span class="n">jax</span><span class="o">.</span><span class="n">sharding</span><span class="o">.</span><span class="n">PartitionSpec</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">sharding</span><span class="o">.</span><span class="n">PartitionSpec</span><span class="p">(</span><span class="s2">&quot;dp&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="p">(</span><span class="s2">&quot;dp&quot;</span><span class="p">,</span> <span class="s2">&quot;fsdp&quot;</span><span class="p">),</span> <span class="kc">None</span><span class="p">),</span>
            <span class="n">a_ps</span><span class="p">:</span> <span class="n">jax</span><span class="o">.</span><span class="n">sharding</span><span class="o">.</span><span class="n">PartitionSpec</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">sharding</span><span class="o">.</span><span class="n">PartitionSpec</span><span class="p">((</span><span class="s2">&quot;dp&quot;</span><span class="p">,</span> <span class="s2">&quot;fsdp&quot;</span><span class="p">),</span> <span class="s2">&quot;mp&quot;</span><span class="p">,</span> <span class="s2">&quot;tp&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
            <span class="n">backend</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The __init__ function is the constructor for a class.</span>
<span class="sd">        It initializes all the attributes of an object, and it&#39;s called when you create a new instance of that class.</span>


<span class="sd">        :param self: Refer to the instance of the class</span>
<span class="sd">        :param axis_dims: Sequence[int]: Specify the number of dimensions for each axis</span>
<span class="sd">        :param axis_names: Sequence[str]: Set the names of the axes</span>
<span class="sd">        :param q_ps: jax.sharding.PartitionSpec: Specify the partitioning of the query tensor</span>
<span class="sd">        :param k_ps: jax.sharding.PartitionSpec: Partition the key matrix</span>
<span class="sd">        :param v_ps: jax.sharding.PartitionSpec: Specify the partitioning of the value tensor</span>
<span class="sd">        :param b_ps: jax.sharding.PartitionSpec: Specify the Attention Bias partition spec</span>
<span class="sd">        :param a_ps: jax.sharding.PartitionSpec: Specify the partitioning of the attention weights</span>
<span class="sd">        :param backend: Optional[None]: Specify the backend to use</span>
<span class="sd">        :return: A new instance of the class</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">q_ps</span> <span class="o">=</span> <span class="n">q_ps</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">k_ps</span> <span class="o">=</span> <span class="n">k_ps</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">v_ps</span> <span class="o">=</span> <span class="n">v_ps</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">b_ps</span> <span class="o">=</span> <span class="n">b_ps</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">a_ps</span> <span class="o">=</span> <span class="n">a_ps</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">axis_dims</span> <span class="o">=</span> <span class="n">axis_dims</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">axis_names</span> <span class="o">=</span> <span class="n">axis_names</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">backend</span> <span class="o">=</span> <span class="n">backend</span> <span class="k">if</span> <span class="n">backend</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">jax_mesh</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">jax</span><span class="o">.</span><span class="n">sharding</span><span class="o">.</span><span class="n">Mesh</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The jax_mesh function is a helper function that creates a jax.sharding.Mesh object from the</span>
<span class="sd">        axis_dims and axis_names attributes of an object, which are assumed to be lists of integers and strings, respectively.</span>
<span class="sd">        The backend attribute is also used if it exists.</span>

<span class="sd">        :param self: Refer to the object itself</span>
<span class="sd">        :return: A jaxMesh</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">create_mesh</span><span class="p">(</span>
            <span class="n">axis_dims</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">axis_dims</span><span class="p">,</span>
            <span class="n">axis_names</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">axis_names</span><span class="p">,</span>
            <span class="n">backend</span><span class="o">=</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">backend</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">backend</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;backend&#39;</span><span class="p">)</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_axis_dims</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The get_axis_dims function returns a sequence of integers representing the dimensions of each axis.</span>

<span class="sd">        :param self: Represent the instance of the class</span>
<span class="sd">        :return: The dimensions of the axes</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">axis_dims</span>

    <span class="k">def</span> <span class="nf">get_axis_names</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The get_axis_names function returns a list of the names of the axes.</span>

<span class="sd">        :param self: Represent the instance of the class</span>
<span class="sd">        :return: A list of the names of all axes</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">axis_names</span>

    <span class="k">def</span> <span class="nf">get_backend</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The get_backend function returns the backend that is currently being used.</span>
<span class="sd">        If no backend has been set, it will return the default JAX backend.</span>

<span class="sd">        :param self: Bind the method to an object</span>
<span class="sd">        :return: The backend platform</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">backend</span> <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">backend</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span> <span class="k">else</span> <span class="n">jax</span><span class="o">.</span><span class="n">lib</span><span class="o">.</span><span class="n">xla_bridge</span><span class="o">.</span><span class="n">get_backend</span><span class="p">()</span><span class="o">.</span><span class="n">platform</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">get_flash_attention</span><span class="p">():</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The get_flash_attention function is used to get the flash attention value from the database.</span>
<span class="sd">            :returns: The flash attention value from the database.</span>

<span class="sd">        :return: A function</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">get_flash_attention</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">add_pss</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">axis_dims</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
            <span class="n">axis_names</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;dp&quot;</span><span class="p">,</span> <span class="s2">&quot;fsdp&quot;</span><span class="p">,</span> <span class="s2">&quot;tp&quot;</span><span class="p">,</span> <span class="s2">&quot;mp&quot;</span><span class="p">),</span>
            <span class="n">q_ps</span><span class="p">:</span> <span class="n">jax</span><span class="o">.</span><span class="n">sharding</span><span class="o">.</span><span class="n">PartitionSpec</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">sharding</span><span class="o">.</span><span class="n">PartitionSpec</span><span class="p">((</span><span class="s2">&quot;dp&quot;</span><span class="p">,</span> <span class="s2">&quot;fsdp&quot;</span><span class="p">),</span> <span class="s2">&quot;mp&quot;</span><span class="p">,</span> <span class="s2">&quot;tp&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
            <span class="n">k_ps</span><span class="p">:</span> <span class="n">jax</span><span class="o">.</span><span class="n">sharding</span><span class="o">.</span><span class="n">PartitionSpec</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">sharding</span><span class="o">.</span><span class="n">PartitionSpec</span><span class="p">((</span><span class="s2">&quot;dp&quot;</span><span class="p">,</span> <span class="s2">&quot;fsdp&quot;</span><span class="p">),</span> <span class="s2">&quot;mp&quot;</span><span class="p">,</span> <span class="s2">&quot;tp&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
            <span class="n">v_ps</span><span class="p">:</span> <span class="n">jax</span><span class="o">.</span><span class="n">sharding</span><span class="o">.</span><span class="n">PartitionSpec</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">sharding</span><span class="o">.</span><span class="n">PartitionSpec</span><span class="p">((</span><span class="s2">&quot;dp&quot;</span><span class="p">,</span> <span class="s2">&quot;fsdp&quot;</span><span class="p">),</span> <span class="s2">&quot;mp&quot;</span><span class="p">,</span> <span class="s2">&quot;tp&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
            <span class="n">b_ps</span><span class="p">:</span> <span class="n">jax</span><span class="o">.</span><span class="n">sharding</span><span class="o">.</span><span class="n">PartitionSpec</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">sharding</span><span class="o">.</span><span class="n">PartitionSpec</span><span class="p">((</span><span class="s2">&quot;dp&quot;</span><span class="p">,</span> <span class="s2">&quot;fsdp&quot;</span><span class="p">),</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;tp&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
            <span class="n">a_ps</span><span class="p">:</span> <span class="n">jax</span><span class="o">.</span><span class="n">sharding</span><span class="o">.</span><span class="n">PartitionSpec</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">sharding</span><span class="o">.</span><span class="n">PartitionSpec</span><span class="p">((</span><span class="s2">&quot;dp&quot;</span><span class="p">,</span> <span class="s2">&quot;fsdp&quot;</span><span class="p">),</span> <span class="s2">&quot;mp&quot;</span><span class="p">,</span> <span class="s2">&quot;tp&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
            <span class="n">backend</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">axis_dims</span> <span class="o">=</span> <span class="n">axis_dims</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">axis_names</span> <span class="o">=</span> <span class="n">axis_names</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">q_ps</span> <span class="o">=</span> <span class="n">q_ps</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">k_ps</span> <span class="o">=</span> <span class="n">k_ps</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">v_ps</span> <span class="o">=</span> <span class="n">v_ps</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">b_ps</span> <span class="o">=</span> <span class="n">b_ps</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">a_ps</span> <span class="o">=</span> <span class="n">a_ps</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">backend</span> <span class="o">=</span> <span class="n">backend</span>
</code></pre></div></td></tr></table></div>
            </details>

  

  <div class="doc doc-children">










<div class="doc doc-object doc-function">




<h3 id="lib.python.EasyDel.modules.flax_modelling_utils.JaxBaseClassModel.__init__" class="doc doc-heading">
          <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">axis_dims</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">axis_names</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;dp&#39;</span><span class="p">,</span> <span class="s1">&#39;fsdp&#39;</span><span class="p">,</span> <span class="s1">&#39;tp&#39;</span><span class="p">,</span> <span class="s1">&#39;mp&#39;</span><span class="p">),</span> <span class="n">q_ps</span><span class="o">=</span><span class="n">jax</span><span class="o">.</span><span class="n">sharding</span><span class="o">.</span><span class="n">PartitionSpec</span><span class="p">((</span><span class="s1">&#39;dp&#39;</span><span class="p">,</span> <span class="s1">&#39;fsdp&#39;</span><span class="p">),</span> <span class="s1">&#39;mp&#39;</span><span class="p">,</span> <span class="s1">&#39;tp&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span> <span class="n">k_ps</span><span class="o">=</span><span class="n">jax</span><span class="o">.</span><span class="n">sharding</span><span class="o">.</span><span class="n">PartitionSpec</span><span class="p">((</span><span class="s1">&#39;dp&#39;</span><span class="p">,</span> <span class="s1">&#39;fsdp&#39;</span><span class="p">),</span> <span class="s1">&#39;mp&#39;</span><span class="p">,</span> <span class="s1">&#39;tp&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span> <span class="n">v_ps</span><span class="o">=</span><span class="n">jax</span><span class="o">.</span><span class="n">sharding</span><span class="o">.</span><span class="n">PartitionSpec</span><span class="p">((</span><span class="s1">&#39;dp&#39;</span><span class="p">,</span> <span class="s1">&#39;fsdp&#39;</span><span class="p">),</span> <span class="s1">&#39;mp&#39;</span><span class="p">,</span> <span class="s1">&#39;tp&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span> <span class="n">b_ps</span><span class="o">=</span><span class="n">jax</span><span class="o">.</span><span class="n">sharding</span><span class="o">.</span><span class="n">PartitionSpec</span><span class="p">(</span><span class="s1">&#39;dp&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="p">(</span><span class="s1">&#39;dp&#39;</span><span class="p">,</span> <span class="s1">&#39;fsdp&#39;</span><span class="p">),</span> <span class="kc">None</span><span class="p">),</span> <span class="n">a_ps</span><span class="o">=</span><span class="n">jax</span><span class="o">.</span><span class="n">sharding</span><span class="o">.</span><span class="n">PartitionSpec</span><span class="p">((</span><span class="s1">&#39;dp&#39;</span><span class="p">,</span> <span class="s1">&#39;fsdp&#39;</span><span class="p">),</span> <span class="s1">&#39;mp&#39;</span><span class="p">,</span> <span class="s1">&#39;tp&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span> <span class="n">backend</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>The <strong>init</strong> function is the constructor for a class.
It initializes all the attributes of an object, and it's called when you create a new instance of that class.</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>self</code></td>
          <td>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Refer to the instance of the class</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>axis_dims</code></td>
          <td>
                <code><span title="typing.Sequence">Sequence</span>[int]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Sequence[int]: Specify the number of dimensions for each axis</p>
            </div>
          </td>
          <td>
                <code>(1, -1, 1, 1)</code>
          </td>
        </tr>
        <tr>
          <td><code>axis_names</code></td>
          <td>
                <code><span title="typing.Sequence">Sequence</span>[str]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Sequence[str]: Set the names of the axes</p>
            </div>
          </td>
          <td>
                <code>(&#39;dp&#39;, &#39;fsdp&#39;, &#39;tp&#39;, &#39;mp&#39;)</code>
          </td>
        </tr>
        <tr>
          <td><code>q_ps</code></td>
          <td>
                <code><span title="jax.sharding.PartitionSpec">PartitionSpec</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>jax.sharding.PartitionSpec: Specify the partitioning of the query tensor</p>
            </div>
          </td>
          <td>
                <code><span title="jax.sharding.PartitionSpec">PartitionSpec</span>((&#39;dp&#39;, &#39;fsdp&#39;), &#39;mp&#39;, &#39;tp&#39;, None)</code>
          </td>
        </tr>
        <tr>
          <td><code>k_ps</code></td>
          <td>
                <code><span title="jax.sharding.PartitionSpec">PartitionSpec</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>jax.sharding.PartitionSpec: Partition the key matrix</p>
            </div>
          </td>
          <td>
                <code><span title="jax.sharding.PartitionSpec">PartitionSpec</span>((&#39;dp&#39;, &#39;fsdp&#39;), &#39;mp&#39;, &#39;tp&#39;, None)</code>
          </td>
        </tr>
        <tr>
          <td><code>v_ps</code></td>
          <td>
                <code><span title="jax.sharding.PartitionSpec">PartitionSpec</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>jax.sharding.PartitionSpec: Specify the partitioning of the value tensor</p>
            </div>
          </td>
          <td>
                <code><span title="jax.sharding.PartitionSpec">PartitionSpec</span>((&#39;dp&#39;, &#39;fsdp&#39;), &#39;mp&#39;, &#39;tp&#39;, None)</code>
          </td>
        </tr>
        <tr>
          <td><code>b_ps</code></td>
          <td>
                <code><span title="jax.sharding.PartitionSpec">PartitionSpec</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>jax.sharding.PartitionSpec: Specify the Attention Bias partition spec</p>
            </div>
          </td>
          <td>
                <code><span title="jax.sharding.PartitionSpec">PartitionSpec</span>(&#39;dp&#39;, None, (&#39;dp&#39;, &#39;fsdp&#39;), None)</code>
          </td>
        </tr>
        <tr>
          <td><code>a_ps</code></td>
          <td>
                <code><span title="jax.sharding.PartitionSpec">PartitionSpec</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>jax.sharding.PartitionSpec: Specify the partitioning of the attention weights</p>
            </div>
          </td>
          <td>
                <code><span title="jax.sharding.PartitionSpec">PartitionSpec</span>((&#39;dp&#39;, &#39;fsdp&#39;), &#39;mp&#39;, &#39;tp&#39;, None)</code>
          </td>
        </tr>
        <tr>
          <td><code>backend</code></td>
          <td>
                <code><span title="typing.Optional">Optional</span>[None]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Optional[None]: Specify the backend to use</p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
          </td>
          <td>
            <div class="doc-md-description">
              <p>A new instance of the class</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>lib/python/EasyDel/modules/flax_modelling_utils.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">axis_dims</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
        <span class="n">axis_names</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;dp&quot;</span><span class="p">,</span> <span class="s2">&quot;fsdp&quot;</span><span class="p">,</span> <span class="s2">&quot;tp&quot;</span><span class="p">,</span> <span class="s2">&quot;mp&quot;</span><span class="p">),</span>
        <span class="n">q_ps</span><span class="p">:</span> <span class="n">jax</span><span class="o">.</span><span class="n">sharding</span><span class="o">.</span><span class="n">PartitionSpec</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">sharding</span><span class="o">.</span><span class="n">PartitionSpec</span><span class="p">((</span><span class="s2">&quot;dp&quot;</span><span class="p">,</span> <span class="s2">&quot;fsdp&quot;</span><span class="p">),</span> <span class="s2">&quot;mp&quot;</span><span class="p">,</span> <span class="s2">&quot;tp&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
        <span class="n">k_ps</span><span class="p">:</span> <span class="n">jax</span><span class="o">.</span><span class="n">sharding</span><span class="o">.</span><span class="n">PartitionSpec</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">sharding</span><span class="o">.</span><span class="n">PartitionSpec</span><span class="p">((</span><span class="s2">&quot;dp&quot;</span><span class="p">,</span> <span class="s2">&quot;fsdp&quot;</span><span class="p">),</span> <span class="s2">&quot;mp&quot;</span><span class="p">,</span> <span class="s2">&quot;tp&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
        <span class="n">v_ps</span><span class="p">:</span> <span class="n">jax</span><span class="o">.</span><span class="n">sharding</span><span class="o">.</span><span class="n">PartitionSpec</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">sharding</span><span class="o">.</span><span class="n">PartitionSpec</span><span class="p">((</span><span class="s2">&quot;dp&quot;</span><span class="p">,</span> <span class="s2">&quot;fsdp&quot;</span><span class="p">),</span> <span class="s2">&quot;mp&quot;</span><span class="p">,</span> <span class="s2">&quot;tp&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
        <span class="n">b_ps</span><span class="p">:</span> <span class="n">jax</span><span class="o">.</span><span class="n">sharding</span><span class="o">.</span><span class="n">PartitionSpec</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">sharding</span><span class="o">.</span><span class="n">PartitionSpec</span><span class="p">(</span><span class="s2">&quot;dp&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="p">(</span><span class="s2">&quot;dp&quot;</span><span class="p">,</span> <span class="s2">&quot;fsdp&quot;</span><span class="p">),</span> <span class="kc">None</span><span class="p">),</span>
        <span class="n">a_ps</span><span class="p">:</span> <span class="n">jax</span><span class="o">.</span><span class="n">sharding</span><span class="o">.</span><span class="n">PartitionSpec</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">sharding</span><span class="o">.</span><span class="n">PartitionSpec</span><span class="p">((</span><span class="s2">&quot;dp&quot;</span><span class="p">,</span> <span class="s2">&quot;fsdp&quot;</span><span class="p">),</span> <span class="s2">&quot;mp&quot;</span><span class="p">,</span> <span class="s2">&quot;tp&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
        <span class="n">backend</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The __init__ function is the constructor for a class.</span>
<span class="sd">    It initializes all the attributes of an object, and it&#39;s called when you create a new instance of that class.</span>


<span class="sd">    :param self: Refer to the instance of the class</span>
<span class="sd">    :param axis_dims: Sequence[int]: Specify the number of dimensions for each axis</span>
<span class="sd">    :param axis_names: Sequence[str]: Set the names of the axes</span>
<span class="sd">    :param q_ps: jax.sharding.PartitionSpec: Specify the partitioning of the query tensor</span>
<span class="sd">    :param k_ps: jax.sharding.PartitionSpec: Partition the key matrix</span>
<span class="sd">    :param v_ps: jax.sharding.PartitionSpec: Specify the partitioning of the value tensor</span>
<span class="sd">    :param b_ps: jax.sharding.PartitionSpec: Specify the Attention Bias partition spec</span>
<span class="sd">    :param a_ps: jax.sharding.PartitionSpec: Specify the partitioning of the attention weights</span>
<span class="sd">    :param backend: Optional[None]: Specify the backend to use</span>
<span class="sd">    :return: A new instance of the class</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">q_ps</span> <span class="o">=</span> <span class="n">q_ps</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">k_ps</span> <span class="o">=</span> <span class="n">k_ps</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">v_ps</span> <span class="o">=</span> <span class="n">v_ps</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">b_ps</span> <span class="o">=</span> <span class="n">b_ps</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">a_ps</span> <span class="o">=</span> <span class="n">a_ps</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">axis_dims</span> <span class="o">=</span> <span class="n">axis_dims</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">axis_names</span> <span class="o">=</span> <span class="n">axis_names</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">backend</span> <span class="o">=</span> <span class="n">backend</span> <span class="k">if</span> <span class="n">backend</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h3 id="lib.python.EasyDel.modules.flax_modelling_utils.JaxBaseClassModel.get_axis_dims" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">get_axis_dims</span><span class="p">()</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>The get_axis_dims function returns a sequence of integers representing the dimensions of each axis.</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>self</code></td>
          <td>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Represent the instance of the class</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code><span title="typing.Sequence">Sequence</span>[int]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The dimensions of the axes</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>lib/python/EasyDel/modules/flax_modelling_utils.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_axis_dims</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The get_axis_dims function returns a sequence of integers representing the dimensions of each axis.</span>

<span class="sd">    :param self: Represent the instance of the class</span>
<span class="sd">    :return: The dimensions of the axes</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">axis_dims</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h3 id="lib.python.EasyDel.modules.flax_modelling_utils.JaxBaseClassModel.get_axis_names" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">get_axis_names</span><span class="p">()</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>The get_axis_names function returns a list of the names of the axes.</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>self</code></td>
          <td>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Represent the instance of the class</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code><span title="typing.Sequence">Sequence</span>[str]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>A list of the names of all axes</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>lib/python/EasyDel/modules/flax_modelling_utils.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_axis_names</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The get_axis_names function returns a list of the names of the axes.</span>

<span class="sd">    :param self: Represent the instance of the class</span>
<span class="sd">    :return: A list of the names of all axes</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">axis_names</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h3 id="lib.python.EasyDel.modules.flax_modelling_utils.JaxBaseClassModel.get_backend" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">get_backend</span><span class="p">()</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>The get_backend function returns the backend that is currently being used.
If no backend has been set, it will return the default JAX backend.</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>self</code></td>
          <td>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Bind the method to an object</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code>str</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The backend platform</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>lib/python/EasyDel/modules/flax_modelling_utils.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_backend</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The get_backend function returns the backend that is currently being used.</span>
<span class="sd">    If no backend has been set, it will return the default JAX backend.</span>

<span class="sd">    :param self: Bind the method to an object</span>
<span class="sd">    :return: The backend platform</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">backend</span> <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">backend</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span> <span class="k">else</span> <span class="n">jax</span><span class="o">.</span><span class="n">lib</span><span class="o">.</span><span class="n">xla_bridge</span><span class="o">.</span><span class="n">get_backend</span><span class="p">()</span><span class="o">.</span><span class="n">platform</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h3 id="lib.python.EasyDel.modules.flax_modelling_utils.JaxBaseClassModel.get_flash_attention" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">get_flash_attention</span><span class="p">()</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

</h3>


  <div class="doc doc-contents ">
  
      <p>The get_flash_attention function is used to get the flash attention value from the database.
    :returns: The flash attention value from the database.</p>



  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
          </td>
          <td>
            <div class="doc-md-description">
              <p>A function</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>lib/python/EasyDel/modules/flax_modelling_utils.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span> <span class="nf">get_flash_attention</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The get_flash_attention function is used to get the flash attention value from the database.</span>
<span class="sd">        :returns: The flash attention value from the database.</span>

<span class="sd">    :return: A function</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">get_flash_attention</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h3 id="lib.python.EasyDel.modules.flax_modelling_utils.JaxBaseClassModel.jax_mesh" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">jax_mesh</span><span class="p">()</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>The jax_mesh function is a helper function that creates a jax.sharding.Mesh object from the
axis_dims and axis_names attributes of an object, which are assumed to be lists of integers and strings, respectively.
The backend attribute is also used if it exists.</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>self</code></td>
          <td>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Refer to the object itself</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code><span title="jax.sharding.Mesh">Mesh</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>A jaxMesh</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>lib/python/EasyDel/modules/flax_modelling_utils.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">jax_mesh</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">jax</span><span class="o">.</span><span class="n">sharding</span><span class="o">.</span><span class="n">Mesh</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The jax_mesh function is a helper function that creates a jax.sharding.Mesh object from the</span>
<span class="sd">    axis_dims and axis_names attributes of an object, which are assumed to be lists of integers and strings, respectively.</span>
<span class="sd">    The backend attribute is also used if it exists.</span>

<span class="sd">    :param self: Refer to the object itself</span>
<span class="sd">    :return: A jaxMesh</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">create_mesh</span><span class="p">(</span>
        <span class="n">axis_dims</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">axis_dims</span><span class="p">,</span>
        <span class="n">axis_names</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">axis_names</span><span class="p">,</span>
        <span class="n">backend</span><span class="o">=</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">backend</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">backend</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;backend&#39;</span><span class="p">)</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>



  </div>

  </div>

</div>



<div class="doc doc-object doc-function">




<h2 id="lib.python.EasyDel.modules.flax_modelling_utils.add_start_docstrings" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">add_start_docstrings</span><span class="p">(</span><span class="o">*</span><span class="n">docstr</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>The add_start_docstrings function is a decorator that adds the docstrings to the beginning of a function.
The add_start_docstrings function takes in an arbitrary number of strings and returns a decorator.
The returned decorator takes in one argument, fn, which is assumed to be a function. The docstring for fn is set equal to
the concatenation of all the strings passed into add_start_docstrings plus (if it exists) the original docstring for fn.</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>*docstr</code></td>
          <td>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Pass in a variable number of arguments to the function</p>
            </div>
          </td>
          <td>
                <code>()</code>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
          </td>
          <td>
            <div class="doc-md-description">
              <p>A decorator that adds the docstrings to the function</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>lib/python/EasyDel/modules/flax_modelling_utils.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">add_start_docstrings</span><span class="p">(</span><span class="o">*</span><span class="n">docstr</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The add_start_docstrings function is a decorator that adds the docstrings to the beginning of a function.</span>
<span class="sd">    The add_start_docstrings function takes in an arbitrary number of strings and returns a decorator.</span>
<span class="sd">    The returned decorator takes in one argument, fn, which is assumed to be a function. The docstring for fn is set equal to</span>
<span class="sd">    the concatenation of all the strings passed into add_start_docstrings plus (if it exists) the original docstring for fn.</span>

<span class="sd">    :param *docstr: Pass in a variable number of arguments to the function</span>
<span class="sd">    :return: A decorator that adds the docstrings to the function</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">docstring_decorator</span><span class="p">(</span><span class="n">fn</span><span class="p">):</span>
        <span class="n">fn</span><span class="o">.</span><span class="vm">__doc__</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">docstr</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">fn</span><span class="o">.</span><span class="vm">__doc__</span> <span class="k">if</span> <span class="n">fn</span><span class="o">.</span><span class="vm">__doc__</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">fn</span>

    <span class="k">return</span> <span class="n">docstring_decorator</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h2 id="lib.python.EasyDel.modules.flax_modelling_utils.apply_rotary_pos_emb" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">apply_rotary_pos_emb</span><span class="p">(</span><span class="n">tensor</span><span class="p">,</span> <span class="n">sin_</span><span class="p">,</span> <span class="n">cos_</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>The apply_rotary_pos_emb function applies a rotary positional embedding to the input tensor.</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>tensor</code></td>
          <td>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Store the tensor that is passed into the function</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>sin_</code></td>
          <td>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Rotate the tensor by pi/2</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>cos_</code></td>
          <td>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Apply the cosine function to the tensor</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
          </td>
          <td>
            <div class="doc-md-description">
              <p>A tensor with the same shape as the input tensor</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>lib/python/EasyDel/modules/flax_modelling_utils.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">apply_rotary_pos_emb</span><span class="p">(</span><span class="n">tensor</span><span class="p">,</span> <span class="n">sin_</span><span class="p">,</span> <span class="n">cos_</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The apply_rotary_pos_emb function applies a rotary positional embedding to the input tensor.</span>

<span class="sd">    :param tensor: Store the tensor that is passed into the function</span>
<span class="sd">    :param sin_: Rotate the tensor by pi/2</span>
<span class="sd">    :param cos_: Apply the cosine function to the tensor</span>
<span class="sd">    :return: A tensor with the same shape as the input tensor</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">tensor</span> <span class="o">*</span> <span class="n">cos_</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">rotate_half</span><span class="p">(</span><span class="n">tensor</span><span class="p">)</span> <span class="o">*</span> <span class="n">sin_</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h2 id="lib.python.EasyDel.modules.flax_modelling_utils.canonicalize_dtype" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">canonicalize_dtype</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">inexact</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Canonicalize an optional dtype to the definitive dtype.</p>
<p>If the <code>dtype</code> is None this function will infer the dtype. If it is not
None it will be returned unmodified or an exceptions is raised if the dtype
is invalid.
from the input arguments using <code>jnp.result_type</code>.</p>
<p>Args:
  <em>args: JAX array compatible values. None values
    are ignored.
  dtype: Optional dtype override. If specified the arguments are cast to
    the specified dtype instead and dtype inference is disabled.
  inexact: When True, the output dtype must be a subdtype
  of <code>jnp.inexact</code>. Inexact dtypes are real or complex floating points. This
  is useful when you want to apply operations that don't work directly on
  integers like taking a mean for example.
Returns:
  The dtype that </em>args should be cast to.</p>

          <details class="quote">
            <summary>Source code in <code>lib/python/EasyDel/modules/flax_modelling_utils.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">canonicalize_dtype</span><span class="p">(</span>
        <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">dtype</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">chex</span><span class="o">.</span><span class="n">ArrayDType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">inexact</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">chex</span><span class="o">.</span><span class="n">ArrayDType</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Canonicalize an optional dtype to the definitive dtype.</span>

<span class="sd">    If the ``dtype`` is None this function will infer the dtype. If it is not</span>
<span class="sd">    None it will be returned unmodified or an exceptions is raised if the dtype</span>
<span class="sd">    is invalid.</span>
<span class="sd">    from the input arguments using ``jnp.result_type``.</span>

<span class="sd">    Args:</span>
<span class="sd">      *args: JAX array compatible values. None values</span>
<span class="sd">        are ignored.</span>
<span class="sd">      dtype: Optional dtype override. If specified the arguments are cast to</span>
<span class="sd">        the specified dtype instead and dtype inference is disabled.</span>
<span class="sd">      inexact: When True, the output dtype must be a subdtype</span>
<span class="sd">      of `jnp.inexact`. Inexact dtypes are real or complex floating points. This</span>
<span class="sd">      is useful when you want to apply operations that don&#39;t work directly on</span>
<span class="sd">      integers like taking a mean for example.</span>
<span class="sd">    Returns:</span>
<span class="sd">      The dtype that *args should be cast to.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">dtype</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">args_filtered</span> <span class="o">=</span> <span class="p">[</span><span class="n">jax</span><span class="o">.</span><span class="n">numpy</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">args</span> <span class="k">if</span> <span class="n">x</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">]</span>
        <span class="n">dtype</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">numpy</span><span class="o">.</span><span class="n">result_type</span><span class="p">(</span><span class="o">*</span><span class="n">args_filtered</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">inexact</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">jax</span><span class="o">.</span><span class="n">numpy</span><span class="o">.</span><span class="n">issubdtype</span><span class="p">(</span><span class="n">dtype</span><span class="p">,</span> <span class="n">jax</span><span class="o">.</span><span class="n">numpy</span><span class="o">.</span><span class="n">inexact</span><span class="p">):</span>
            <span class="n">dtype</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">numpy</span><span class="o">.</span><span class="n">promote_types</span><span class="p">(</span><span class="n">jax</span><span class="o">.</span><span class="n">numpy</span><span class="o">.</span><span class="n">float32</span><span class="p">,</span> <span class="n">dtype</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">inexact</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">jax</span><span class="o">.</span><span class="n">numpy</span><span class="o">.</span><span class="n">issubdtype</span><span class="p">(</span><span class="n">dtype</span><span class="p">,</span> <span class="n">jax</span><span class="o">.</span><span class="n">numpy</span><span class="o">.</span><span class="n">inexact</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Dtype must be inexact: </span><span class="si">{</span><span class="n">dtype</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">dtype</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h2 id="lib.python.EasyDel.modules.flax_modelling_utils.create_mesh" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">create_mesh</span><span class="p">(</span><span class="n">axis_dims</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">axis_names</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;dp&#39;</span><span class="p">,</span> <span class="s1">&#39;fsdp&#39;</span><span class="p">,</span> <span class="s1">&#39;tp&#39;</span><span class="p">,</span> <span class="s1">&#39;mp&#39;</span><span class="p">),</span> <span class="n">backend</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>The create_mesh function creates a mesh object that can be used to shard arrays.</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>axis_dims</code></td>
          <td>
                <code><span title="typing.Sequence">Sequence</span>[int]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Sequence[int]: Specify the dimensions of the mesh</p>
            </div>
          </td>
          <td>
                <code>(1, -1, 1, 1)</code>
          </td>
        </tr>
        <tr>
          <td><code>axis_names</code></td>
          <td>
                <code><span title="typing.Sequence">Sequence</span>[str]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Sequence[str]: Name the axes of the mesh</p>
            </div>
          </td>
          <td>
                <code>(&#39;dp&#39;, &#39;fsdp&#39;, &#39;tp&#39;, &#39;mp&#39;)</code>
          </td>
        </tr>
        <tr>
          <td><code>backend</code></td>
          <td>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Specify the backend to use</p>
            </div>
          </td>
          <td>
                <code>&#39;&#39;</code>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
          </td>
          <td>
            <div class="doc-md-description">
              <p>A mesh object</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>lib/python/EasyDel/modules/flax_modelling_utils.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">create_mesh</span><span class="p">(</span>
        <span class="n">axis_dims</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">axis_names</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;dp&quot;</span><span class="p">,</span> <span class="s2">&quot;fsdp&quot;</span><span class="p">,</span> <span class="s2">&quot;tp&quot;</span><span class="p">,</span> <span class="s2">&quot;mp&quot;</span><span class="p">),</span> <span class="n">backend</span><span class="o">=</span><span class="s2">&quot;&quot;</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The create_mesh function creates a mesh object that can be used to shard arrays.</span>

<span class="sd">    :param axis_dims: Sequence[int]: Specify the dimensions of the mesh</span>
<span class="sd">    :param axis_names: Sequence[str]: Name the axes of the mesh</span>
<span class="sd">    :param backend: Specify the backend to use</span>
<span class="sd">    :return: A mesh object</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">array_devices</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">numpy</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">jax</span><span class="o">.</span><span class="n">devices</span><span class="p">()</span> <span class="k">if</span> <span class="n">backend</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span> <span class="k">else</span> <span class="n">jax</span><span class="o">.</span><span class="n">devices</span><span class="p">(</span><span class="n">backend</span><span class="p">)),</span> <span class="mi">1</span><span class="p">))</span>
    <span class="n">resh</span> <span class="o">=</span> <span class="n">array_devices</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">axis_dims</span><span class="p">)</span><span class="o">.</span><span class="n">shape</span>

    <span class="k">return</span> <span class="n">jax</span><span class="o">.</span><span class="n">sharding</span><span class="o">.</span><span class="n">Mesh</span><span class="p">(</span>
        <span class="n">create_device_mesh</span><span class="p">(</span><span class="n">resh</span><span class="p">),</span> <span class="n">axis_names</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h2 id="lib.python.EasyDel.modules.flax_modelling_utils.get_flash_attention" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">get_flash_attention</span><span class="p">()</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>return: FlashAttention FN, Upcast Needed to float32,do_shard_map</p>

          <details class="quote">
            <summary>Source code in <code>lib/python/EasyDel/modules/flax_modelling_utils.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_flash_attention</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    return: FlashAttention FN, Upcast Needed to float32,do_shard_map</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">platform</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">lib</span><span class="o">.</span><span class="n">xla_bridge</span><span class="o">.</span><span class="n">get_backend</span><span class="p">()</span><span class="o">.</span><span class="n">platform</span>
    <span class="k">if</span> <span class="n">platform</span> <span class="o">==</span> <span class="s2">&quot;gpu&quot;</span><span class="p">:</span>
        <span class="n">float32_logits</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">ring_attention_fn</span> <span class="o">=</span> <span class="n">fjformer</span><span class="o">.</span><span class="n">attention</span><span class="o">.</span><span class="n">ring_flash_attention_gpu</span>
        <span class="n">do_shard_map</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">elif</span> <span class="n">platform</span> <span class="o">==</span> <span class="s2">&quot;tpu&quot;</span><span class="p">:</span>
        <span class="n">float32_logits</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">ring_attention_fn</span> <span class="o">=</span> <span class="n">fjformer</span><span class="o">.</span><span class="n">attention</span><span class="o">.</span><span class="n">tpu_flash_attention</span>
        <span class="n">do_shard_map</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unsupported platform </span><span class="si">{</span><span class="n">platform</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">ring_attention_fn</span><span class="p">,</span> <span class="n">float32_logits</span><span class="p">,</span> <span class="n">do_shard_map</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h2 id="lib.python.EasyDel.modules.flax_modelling_utils.get_gradient_checkpoint_policy" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">get_gradient_checkpoint_policy</span><span class="p">(</span><span class="n">name</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>The get_gradient_checkpoint_policy function is a helper function that returns the gradient checkpoint policy
    specified by the name parameter.</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>name</code></td>
          <td>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Select the checkpoint policy from the dictionary</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
          </td>
          <td>
            <div class="doc-md-description">
              <p>A function that is used in the jax</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>lib/python/EasyDel/modules/flax_modelling_utils.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_gradient_checkpoint_policy</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The get_gradient_checkpoint_policy function is a helper function that returns the gradient checkpoint policy</span>
<span class="sd">        specified by the name parameter.</span>

<span class="sd">    :param name: Select the checkpoint policy from the dictionary</span>
<span class="sd">    :return: A function that is used in the jax</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">gradients</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
        <span class="n">everything_saveable</span><span class="o">=</span><span class="n">jax</span><span class="o">.</span><span class="n">checkpoint_policies</span><span class="o">.</span><span class="n">everything_saveable</span><span class="p">,</span>
        <span class="n">nothing_saveable</span><span class="o">=</span><span class="n">jax</span><span class="o">.</span><span class="n">checkpoint_policies</span><span class="o">.</span><span class="n">nothing_saveable</span><span class="p">,</span>
        <span class="n">dots_saveable</span><span class="o">=</span><span class="n">jax</span><span class="o">.</span><span class="n">checkpoint_policies</span><span class="o">.</span><span class="n">dots_saveable</span><span class="p">,</span>
        <span class="n">checkpoint_dots</span><span class="o">=</span><span class="n">jax</span><span class="o">.</span><span class="n">checkpoint_policies</span><span class="o">.</span><span class="n">checkpoint_dots</span><span class="p">,</span>
        <span class="n">dots_with_no_batch_dims_saveable</span><span class="o">=</span><span class="n">jax</span><span class="o">.</span><span class="n">checkpoint_policies</span><span class="o">.</span><span class="n">dots_with_no_batch_dims_saveable</span><span class="p">,</span>
        <span class="n">checkpoint_dots_with_no_batch_dims</span><span class="o">=</span><span class="n">jax</span><span class="o">.</span><span class="n">checkpoint_policies</span><span class="o">.</span><span class="n">checkpoint_dots_with_no_batch_dims</span><span class="p">,</span>
        <span class="n">save_anything_except_these_names</span><span class="o">=</span><span class="n">jax</span><span class="o">.</span><span class="n">checkpoint_policies</span><span class="o">.</span><span class="n">save_anything_except_these_names</span><span class="p">,</span>
        <span class="n">save_any_names_but_these</span><span class="o">=</span><span class="n">jax</span><span class="o">.</span><span class="n">checkpoint_policies</span><span class="o">.</span><span class="n">save_any_names_but_these</span><span class="p">,</span>
        <span class="n">save_only_these_names</span><span class="o">=</span><span class="n">jax</span><span class="o">.</span><span class="n">checkpoint_policies</span><span class="o">.</span><span class="n">save_only_these_names</span><span class="p">,</span>
        <span class="n">save_from_both_policies</span><span class="o">=</span><span class="n">jax</span><span class="o">.</span><span class="n">checkpoint_policies</span><span class="o">.</span><span class="n">save_from_both_policies</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">gradients</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h2 id="lib.python.EasyDel.modules.flax_modelling_utils.get_names_from_partition_spec" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">get_names_from_partition_spec</span><span class="p">(</span><span class="n">partition_specs</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>The get_names_from_partition_spec function takes a partition_specs argument, which is either a dictionary or list.
If it's a dictionary, the function converts it to a list of values. Then for each item in the partition_specs list:
    If the item is None, continue (do nothing) and move on to next iteration of loop.
    If the item is an instance of str (i.e., if it's just one string), add that string to names set and move
    on to next iteration of loop.
    Otherwise, (if not None or str), call get_names_from_partition_spec recurs</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>partition_specs</code></td>
          <td>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Define the partitioning of a table</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
          </td>
          <td>
            <div class="doc-md-description">
              <p>A list of the names of all partitions</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>lib/python/EasyDel/modules/flax_modelling_utils.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_names_from_partition_spec</span><span class="p">(</span><span class="n">partition_specs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The get_names_from_partition_spec function takes a partition_specs argument, which is either a dictionary or list.</span>
<span class="sd">    If it&#39;s a dictionary, the function converts it to a list of values. Then for each item in the partition_specs list:</span>
<span class="sd">        If the item is None, continue (do nothing) and move on to next iteration of loop.</span>
<span class="sd">        If the item is an instance of str (i.e., if it&#39;s just one string), add that string to names set and move</span>
<span class="sd">        on to next iteration of loop.</span>
<span class="sd">        Otherwise, (if not None or str), call get_names_from_partition_spec recurs</span>

<span class="sd">    :param partition_specs: Define the partitioning of a table</span>
<span class="sd">    :return: A list of the names of all partitions</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">names</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">partition_specs</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="n">partition_specs</span> <span class="o">=</span> <span class="n">partition_specs</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">partition_specs</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">item</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">continue</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">names</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">names</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">get_names_from_partition_spec</span><span class="p">(</span><span class="n">item</span><span class="p">))</span>

    <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="n">names</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h2 id="lib.python.EasyDel.modules.flax_modelling_utils.get_ranks_and_size" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">get_ranks_and_size</span><span class="p">(</span><span class="n">mesh</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>The get_ranks_and_size function is used to determine the number of MPI processes
(<code>mp_node_size</code>) and the number of devices per process (<code>dp_node_size</code>).
The <code>mesh.shape[&amp;quot;tp&amp;quot;] * mesh.shape[&amp;quot;mp&amp;quot;]</code> determines how many MPI processes are needed,
and then we divide that by the local device count to get <code>`mp_node_size = max( 1, mp / jax.local )</code>.
This means that if there are more than enough devices for all MPI ranks on a node, each rank will only use one device; otherwise it will use</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>mesh</code></td>
          <td>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Get the shape of the mesh</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
          </td>
          <td>
            <div class="doc-md-description">
              <p>A dictionary with the following keys:</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>lib/python/EasyDel/modules/flax_modelling_utils.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_ranks_and_size</span><span class="p">(</span><span class="n">mesh</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The get_ranks_and_size function is used to determine the number of MPI processes</span>
<span class="sd">    (``mp_node_size``) and the number of devices per process (``dp_node_size``).</span>
<span class="sd">    The ``mesh.shape[&amp;quot;tp&amp;quot;] * mesh.shape[&amp;quot;mp&amp;quot;]`` determines how many MPI processes are needed,</span>
<span class="sd">    and then we divide that by the local device count to get ``mp_node_size = max( 1, mp / jax.local )`.</span>
<span class="sd">    This means that if there are more than enough devices for all MPI ranks on a node, each rank will only use one device; otherwise it will use</span>

<span class="sd">    :param mesh: Get the shape of the mesh</span>
<span class="sd">    :return: A dictionary with the following keys:</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">out</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">mesh</span><span class="o">=</span><span class="n">mesh</span><span class="p">)</span>
    <span class="n">mp_size</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="s2">&quot;tp&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">mesh</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="s2">&quot;mp&quot;</span><span class="p">]</span>
    <span class="n">mp_node_size</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">mp_size</span> <span class="o">//</span> <span class="n">jax</span><span class="o">.</span><span class="n">local_device_count</span><span class="p">())</span>
    <span class="n">dp_node_size</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">process_count</span><span class="p">()</span> <span class="o">//</span> <span class="n">mp_node_size</span>
    <span class="n">out</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">mp_node_size</span><span class="o">=</span><span class="n">mp_node_size</span><span class="p">,</span>
               <span class="n">dp_node_size</span><span class="o">=</span><span class="n">dp_node_size</span><span class="p">)</span>

    <span class="n">dp_node_rank</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">process_index</span><span class="p">()</span> <span class="o">//</span> <span class="n">mp_node_size</span>
    <span class="n">mp_node_rank</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">process_index</span><span class="p">()</span> <span class="o">%</span> <span class="n">mp_node_size</span>
    <span class="n">out</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">dp_node_rank</span><span class="o">=</span><span class="n">dp_node_rank</span><span class="p">,</span>
               <span class="n">mp_node_rank</span><span class="o">=</span><span class="n">mp_node_rank</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">out</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h2 id="lib.python.EasyDel.modules.flax_modelling_utils.names_in_mesh" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">names_in_mesh</span><span class="p">(</span><span class="o">*</span><span class="n">names</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>The names_in_mesh function is a decorator that can be used to check whether
the names of the axes passed into a function are valid.  It will raise an
exception if any of the axis names are not in the physical mesh.  For example,
if you have a function that takes two axes as arguments, and you want to make sure they're both in your mesh:</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>*names</code></td>
          <td>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Collect all the names passed to the function into a tuple</p>
            </div>
          </td>
          <td>
                <code>()</code>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
          </td>
          <td>
            <div class="doc-md-description">
              <p>A boolean indicating whether all the given</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>lib/python/EasyDel/modules/flax_modelling_utils.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span>
<span class="normal">88</span>
<span class="normal">89</span>
<span class="normal">90</span>
<span class="normal">91</span>
<span class="normal">92</span>
<span class="normal">93</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">names_in_mesh</span><span class="p">(</span><span class="o">*</span><span class="n">names</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The names_in_mesh function is a decorator that can be used to check whether</span>
<span class="sd">    the names of the axes passed into a function are valid.  It will raise an</span>
<span class="sd">    exception if any of the axis names are not in the physical mesh.  For example,</span>
<span class="sd">    if you have a function that takes two axes as arguments, and you want to make sure they&#39;re both in your mesh:</span>

<span class="sd">    :param *names: Collect all the names passed to the function into a tuple</span>
<span class="sd">    :return: A boolean indicating whether all the given</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="nb">set</span><span class="p">(</span><span class="n">names</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="nb">set</span><span class="p">(</span><span class="n">pxla</span><span class="o">.</span><span class="n">thread_resources</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">physical_mesh</span><span class="o">.</span><span class="n">axis_names</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h2 id="lib.python.EasyDel.modules.flax_modelling_utils.precompute_freq_cis" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">precompute_freq_cis</span><span class="p">(</span><span class="n">max_position_embedding</span><span class="p">,</span> <span class="n">head_dim</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>The precompute_freq_cis function is used to precompute the sinusoidal embeddings for positional encoding.</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>max_position_embedding</code></td>
          <td>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Define the maximum length of the sequence</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>head_dim</code></td>
          <td>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Determine the number of heads in the attention layer</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Two arrays:</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>lib/python/EasyDel/modules/flax_modelling_utils.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">precompute_freq_cis</span><span class="p">(</span><span class="n">max_position_embedding</span><span class="p">,</span> <span class="n">head_dim</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The precompute_freq_cis function is used to precompute the sinusoidal embeddings for positional encoding.</span>

<span class="sd">    :param max_position_embedding: Define the maximum length of the sequence</span>
<span class="sd">    :param head_dim: Determine the number of heads in the attention layer</span>
<span class="sd">    :return: Two arrays:</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">inv_freq</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="p">(</span><span class="mi">10000</span> <span class="o">**</span> <span class="p">(</span><span class="n">jax</span><span class="o">.</span><span class="n">numpy</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">head_dim</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">jax</span><span class="o">.</span><span class="n">numpy</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span> <span class="o">/</span> <span class="n">head_dim</span><span class="p">))</span>
    <span class="n">freq</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">numpy</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s2">&quot;i , j -&gt; i j&quot;</span><span class="p">,</span> <span class="n">jax</span><span class="o">.</span><span class="n">numpy</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">max_position_embedding</span><span class="p">),</span> <span class="n">inv_freq</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;float32&quot;</span><span class="p">)</span>

    <span class="n">embed</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">numpy</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">freq</span><span class="p">,</span> <span class="n">freq</span><span class="p">),</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">jax</span><span class="o">.</span><span class="n">numpy</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">embed</span><span class="p">)[:,</span> <span class="p">:],</span> <span class="n">jax</span><span class="o">.</span><span class="n">numpy</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">embed</span><span class="p">)[:,</span> <span class="p">:]</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h2 id="lib.python.EasyDel.modules.flax_modelling_utils.repeat_kv_bnsh" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">repeat_kv_bnsh</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">n_rep</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>The repeat_kv_bnsh function is used to repeat the key and value vectors for each head in a multi-head attention
module. This function takes as input an array of shape (batch_size, n_heads, sequence_length, head_dim) and returns
an array of shape (batch_size, n_heads * nrep, sequence length, head dim). The reason this is necessary is because the
attention module expects keys/values/queries to be repeated across heads but not across batches. However we want our
keys/values/queries to be repeated both across heads AND batches so that we can use them</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>x</code></td>
          <td>
                <code><span title="chex.Array">Array</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>chex.Array: Pass in the input to the function</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>n_rep</code></td>
          <td>
                <code>int</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>int: Repeat the key and value heads</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code><span title="chex.Array">Array</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>A new array with the same shape as x, except for the second dimension which is n_kv_heads * n_rep</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>lib/python/EasyDel/modules/flax_modelling_utils.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">repeat_kv_bnsh</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span><span class="p">,</span> <span class="n">n_rep</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The repeat_kv_bnsh function is used to repeat the key and value vectors for each head in a multi-head attention</span>
<span class="sd">    module. This function takes as input an array of shape (batch_size, n_heads, sequence_length, head_dim) and returns</span>
<span class="sd">    an array of shape (batch_size, n_heads * nrep, sequence length, head dim). The reason this is necessary is because the</span>
<span class="sd">    attention module expects keys/values/queries to be repeated across heads but not across batches. However we want our</span>
<span class="sd">    keys/values/queries to be repeated both across heads AND batches so that we can use them</span>

<span class="sd">    :param x: chex.Array: Pass in the input to the function</span>
<span class="sd">    :param n_rep: int: Repeat the key and value heads</span>
<span class="sd">    :return: A new array with the same shape as x, except for the second dimension which is n_kv_heads * n_rep</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">bs</span><span class="p">,</span> <span class="n">n_kv_heads</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">head_dim</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">shape</span>
    <span class="k">if</span> <span class="n">n_rep</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">x</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">x</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">jax</span><span class="o">.</span><span class="n">numpy</span><span class="o">.</span><span class="n">newaxis</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">numpy</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">n_rep</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">x</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">bs</span><span class="p">,</span> <span class="n">n_kv_heads</span> <span class="o">*</span> <span class="n">n_rep</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">head_dim</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h2 id="lib.python.EasyDel.modules.flax_modelling_utils.repeat_kv_bsnh" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">repeat_kv_bsnh</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">n_rep</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>The repeat_kv_bsnh function is used to repeat the key and value vectors for each head.</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>x</code></td>
          <td>
                <code><span title="chex.Array">Array</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>chex.Array: Specify the input array</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>n_rep</code></td>
          <td>
                <code>int</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>int: Repeat the key-value attention heads n_rep times</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code><span title="chex.Array">Array</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>A new array with the same batch size, sequence length, and head dimension as the input array</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>lib/python/EasyDel/modules/flax_modelling_utils.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">repeat_kv_bsnh</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span><span class="p">,</span> <span class="n">n_rep</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The repeat_kv_bsnh function is used to repeat the key and value vectors for each head.</span>

<span class="sd">    :param x: chex.Array: Specify the input array</span>
<span class="sd">    :param n_rep: int: Repeat the key-value attention heads n_rep times</span>
<span class="sd">    :return: A new array with the same batch size, sequence length, and head dimension as the input array</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">bs</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">n_kv_heads</span><span class="p">,</span> <span class="n">head_dim</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">shape</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">n_rep</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">x</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">x</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">jax</span><span class="o">.</span><span class="n">numpy</span><span class="o">.</span><span class="n">newaxis</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">numpy</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">n_rep</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

    <span class="n">x</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">x</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">bs</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">n_kv_heads</span> <span class="o">*</span> <span class="n">n_rep</span><span class="p">,</span> <span class="n">head_dim</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h2 id="lib.python.EasyDel.modules.flax_modelling_utils.rotate_half" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">rotate_half</span><span class="p">(</span><span class="n">x</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>The rotate_half function takes a complex-valued array and rotates the
phase of its second half by 180 degrees. This is equivalent to multiplying
the second half by -i, or equivalently rotating it 90 degrees counterclockwise.</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>x</code></td>
          <td>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Specify the input array</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
          </td>
          <td>
            <div class="doc-md-description">
              <p>A new array that is the same as the input</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>lib/python/EasyDel/modules/flax_modelling_utils.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">rotate_half</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The rotate_half function takes a complex-valued array and rotates the</span>
<span class="sd">    phase of its second half by 180 degrees. This is equivalent to multiplying</span>
<span class="sd">    the second half by -i, or equivalently rotating it 90 degrees counterclockwise.</span>


<span class="sd">    :param x: Specify the input array</span>
<span class="sd">    :return: A new array that is the same as the input</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">x1</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">//</span> <span class="mi">2</span><span class="p">]</span>
    <span class="n">x2</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">//</span> <span class="mi">2</span><span class="p">:]</span>
    <span class="k">return</span> <span class="n">jax</span><span class="o">.</span><span class="n">numpy</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="o">-</span><span class="n">x2</span><span class="p">,</span> <span class="n">x1</span><span class="p">),</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h2 id="lib.python.EasyDel.modules.flax_modelling_utils.smart_flash_attention" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">smart_flash_attention</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">bias</span><span class="p">,</span> <span class="n">q_ps</span><span class="p">,</span> <span class="n">k_ps</span><span class="p">,</span> <span class="n">v_ps</span><span class="p">,</span> <span class="n">b_ps</span><span class="p">,</span> <span class="n">a_ps</span><span class="p">,</span> <span class="n">block_k</span><span class="p">,</span> <span class="n">block_q</span><span class="p">,</span> <span class="n">block_b</span><span class="p">,</span> <span class="n">q_seq_len</span><span class="p">,</span> <span class="n">kv_seq_len</span><span class="p">,</span> <span class="n">num_attention_heads</span><span class="p">,</span> <span class="n">head_dims</span><span class="p">,</span> <span class="n">causal</span><span class="p">,</span> <span class="n">attn_pdrop</span><span class="p">,</span> <span class="n">mesh</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">jax</span><span class="o">.</span><span class="n">numpy</span><span class="o">.</span><span class="n">float32</span><span class="p">,</span> <span class="n">precision</span><span class="o">=</span><span class="n">jax</span><span class="o">.</span><span class="n">lax</span><span class="o">.</span><span class="n">Precision</span><span class="p">(</span><span class="s1">&#39;fastest&#39;</span><span class="p">),</span> <span class="n">dropout_rng</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">force_float32_tpu</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">deterministic</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Smart Flash Attention mechanism for efficient attention computation.</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>q</code></td>
          <td>
                <code><span title="chex.Array">Array</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Query tensor with shape [batch_size, num_attention_heads, q_seq_len, head_dims].</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>k</code></td>
          <td>
                <code><span title="chex.Array">Array</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Key tensor with shape [batch_size, num_attention_heads, kv_seq_len, head_dims].</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>v</code></td>
          <td>
                <code><span title="chex.Array">Array</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Value tensor with shape [batch_size, num_attention_heads, kv_seq_len, head_dims].</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>bias</code></td>
          <td>
                <code><span title="chex.Array">Array</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Bias tensor with shape [batch_size, num_attention_heads, q_seq_len, kv_seq_len].</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>q_ps</code></td>
          <td>
                <code><span title="jax.sharding.PartitionSpec">PartitionSpec</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>jax.sharding.PartitionSpec: Specify the partitioning of the query tensor</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>k_ps</code></td>
          <td>
                <code><span title="jax.sharding.PartitionSpec">PartitionSpec</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>jax.sharding.PartitionSpec: Partition the key matrix</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>v_ps</code></td>
          <td>
                <code><span title="jax.sharding.PartitionSpec">PartitionSpec</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>jax.sharding.PartitionSpec: Specify the partitioning of the value tensor</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>b_ps</code></td>
          <td>
                <code><span title="jax.sharding.PartitionSpec">PartitionSpec</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>jax.sharding.PartitionSpec: Specify the Attention Bias partition spec</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>a_ps</code></td>
          <td>
                <code><span title="jax.sharding.PartitionSpec">PartitionSpec</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>jax.sharding.PartitionSpec: Specify the partitioning of the attention weights</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>block_k</code></td>
          <td>
                <code>int</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Block size for key tensor reshaping.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>block_q</code></td>
          <td>
                <code>int</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Block size for query tensor reshaping.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>block_b</code></td>
          <td>
                <code>int</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Block size for bias tensor reshaping.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>q_seq_len</code></td>
          <td>
                <code>int</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Length of the query sequence.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>kv_seq_len</code></td>
          <td>
                <code>int</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Length of the key-value sequence.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>num_attention_heads</code></td>
          <td>
                <code>int</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Number of attention heads.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>head_dims</code></td>
          <td>
                <code>int</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Dimensionality of each attention head.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>causal</code></td>
          <td>
                <code>bool</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>If True, applies causal masking to the attention scores.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>attn_pdrop</code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Dropout probability for attention weights.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>mesh</code></td>
          <td>
                <code><span title="jax.sharding.Mesh">Mesh</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Mesh specifying the data distribution for parallel computation.</p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>dtype</code></td>
          <td>
                <code><span title="jax.numpy.dtype">dtype</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Data type of the tensors.</p>
            </div>
          </td>
          <td>
                <code><span title="jax.numpy.float32">float32</span></code>
          </td>
        </tr>
        <tr>
          <td><code>precision</code></td>
          <td>
                <code><span title="jax.lax.Precision">Precision</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Precision mode for computation (default is 'fastest').</p>
            </div>
          </td>
          <td>
                <code><span title="jax.lax.Precision">Precision</span>(&#39;fastest&#39;)</code>
          </td>
        </tr>
        <tr>
          <td><code>dropout_rng</code></td>
          <td>
                <code><span title="jax.random.PRNGKey">PRNGKey</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Random number generator key for dropout.</p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>force_float32_tpu</code></td>
          <td>
                <code>bool</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>If True, forces computation to use float32 on TPU.</p>
            </div>
          </td>
          <td>
                <code>True</code>
          </td>
        </tr>
        <tr>
          <td><code>deterministic</code></td>
          <td>
                <code>bool</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>If True, ensures deterministic computation.</p>
            </div>
          </td>
          <td>
                <code>False</code>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code>tensor</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>chex.Array: Output tensor with the same shape as the input value tensor v.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Raises:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code>ValueError</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>If the shapes of input tensors are not compatible for attention computation.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>lib/python/EasyDel/modules/flax_modelling_utils.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">smart_flash_attention</span><span class="p">(</span>
        <span class="n">q</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span><span class="p">,</span>
        <span class="n">k</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span><span class="p">,</span>
        <span class="n">v</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span><span class="p">,</span>
        <span class="n">bias</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span><span class="p">,</span>
        <span class="n">q_ps</span><span class="p">:</span> <span class="n">jax</span><span class="o">.</span><span class="n">sharding</span><span class="o">.</span><span class="n">PartitionSpec</span><span class="p">,</span>
        <span class="n">k_ps</span><span class="p">:</span> <span class="n">jax</span><span class="o">.</span><span class="n">sharding</span><span class="o">.</span><span class="n">PartitionSpec</span><span class="p">,</span>
        <span class="n">v_ps</span><span class="p">:</span> <span class="n">jax</span><span class="o">.</span><span class="n">sharding</span><span class="o">.</span><span class="n">PartitionSpec</span><span class="p">,</span>
        <span class="n">b_ps</span><span class="p">:</span> <span class="n">jax</span><span class="o">.</span><span class="n">sharding</span><span class="o">.</span><span class="n">PartitionSpec</span><span class="p">,</span>
        <span class="n">a_ps</span><span class="p">:</span> <span class="n">jax</span><span class="o">.</span><span class="n">sharding</span><span class="o">.</span><span class="n">PartitionSpec</span><span class="p">,</span>
        <span class="n">block_k</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">block_q</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">block_b</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">q_seq_len</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">kv_seq_len</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">num_attention_heads</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">head_dims</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">causal</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
        <span class="n">attn_pdrop</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
        <span class="n">mesh</span><span class="p">:</span> <span class="n">jax</span><span class="o">.</span><span class="n">sharding</span><span class="o">.</span><span class="n">Mesh</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">dtype</span><span class="p">:</span> <span class="n">jax</span><span class="o">.</span><span class="n">numpy</span><span class="o">.</span><span class="n">dtype</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">numpy</span><span class="o">.</span><span class="n">float32</span><span class="p">,</span>
        <span class="n">precision</span><span class="p">:</span> <span class="n">jax</span><span class="o">.</span><span class="n">lax</span><span class="o">.</span><span class="n">Precision</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">lax</span><span class="o">.</span><span class="n">Precision</span><span class="p">(</span><span class="s1">&#39;fastest&#39;</span><span class="p">),</span>
        <span class="n">dropout_rng</span><span class="p">:</span> <span class="n">jax</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">PRNGKey</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">force_float32_tpu</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">deterministic</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Smart Flash Attention mechanism for efficient attention computation.</span>

<span class="sd">    :param q: Query tensor with shape [batch_size, num_attention_heads, q_seq_len, head_dims].</span>
<span class="sd">    :type q: tensor</span>

<span class="sd">    :param k: Key tensor with shape [batch_size, num_attention_heads, kv_seq_len, head_dims].</span>
<span class="sd">    :type k: tensor</span>

<span class="sd">    :param v: Value tensor with shape [batch_size, num_attention_heads, kv_seq_len, head_dims].</span>
<span class="sd">    :type v: tensor</span>

<span class="sd">    :param bias: Bias tensor with shape [batch_size, num_attention_heads, q_seq_len, kv_seq_len].</span>
<span class="sd">    :type bias: tensor</span>

<span class="sd">    :param q_ps: jax.sharding.PartitionSpec: Specify the partitioning of the query tensor</span>

<span class="sd">    :param k_ps: jax.sharding.PartitionSpec: Partition the key matrix</span>

<span class="sd">    :param v_ps: jax.sharding.PartitionSpec: Specify the partitioning of the value tensor</span>

<span class="sd">    :param b_ps: jax.sharding.PartitionSpec: Specify the Attention Bias partition spec</span>

<span class="sd">    :param a_ps: jax.sharding.PartitionSpec: Specify the partitioning of the attention weights</span>

<span class="sd">    :param block_k: Block size for key tensor reshaping.</span>
<span class="sd">    :type block_k: int</span>

<span class="sd">    :param block_q: Block size for query tensor reshaping.</span>
<span class="sd">    :type block_q: int</span>

<span class="sd">    :param block_b: Block size for bias tensor reshaping.</span>
<span class="sd">    :type block_b: int</span>

<span class="sd">    :param q_seq_len: Length of the query sequence.</span>
<span class="sd">    :type q_seq_len: int</span>

<span class="sd">    :param kv_seq_len: Length of the key-value sequence.</span>
<span class="sd">    :type kv_seq_len: int</span>

<span class="sd">    :param num_attention_heads: Number of attention heads.</span>
<span class="sd">    :type num_attention_heads: int</span>

<span class="sd">    :param head_dims: Dimensionality of each attention head.</span>
<span class="sd">    :type head_dims: int</span>

<span class="sd">    :param causal: If True, applies causal masking to the attention scores.</span>
<span class="sd">    :type causal: bool</span>

<span class="sd">    :param attn_pdrop: Dropout probability for attention weights.</span>
<span class="sd">    :type attn_pdrop: float</span>

<span class="sd">    :param mesh: Mesh specifying the data distribution for parallel computation.</span>
<span class="sd">    :type mesh: mesh_type</span>

<span class="sd">    :param dtype: Data type of the tensors.</span>
<span class="sd">    :type dtype: data_type</span>

<span class="sd">    :param precision: Precision mode for computation (default is &#39;fastest&#39;).</span>
<span class="sd">    :type precision: str</span>

<span class="sd">    :param dropout_rng: Random number generator key for dropout.</span>
<span class="sd">    :type dropout_rng: rng_key</span>

<span class="sd">    :param force_float32_tpu: If True, forces computation to use float32 on TPU.</span>
<span class="sd">    :type force_float32_tpu: bool</span>

<span class="sd">    :param deterministic: If True, ensures deterministic computation.</span>
<span class="sd">    :type deterministic: bool</span>

<span class="sd">    :return: chex.Array: Output tensor with the same shape as the input value tensor v.</span>
<span class="sd">    :rtype: tensor</span>

<span class="sd">    :raises ValueError: If the shapes of input tensors are not compatible for attention computation.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">assertion_mkv_err</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    Q,K,V and bias shapes must be like</span>
<span class="s2">    Q Shape : [batch_size, num_attention_heads, q_seq_len, head_dims]</span>
<span class="s2">    K Shape : [batch_size, num_attention_heads, kv_seq_len, head_dims]</span>
<span class="s2">    V Shape : [batch_size, num_attention_heads, kv_seq_len, head_dims]</span>
<span class="s2">    bias Shape : [batch_size, num_attention_heads, q_seq_len, kv_seq_len]</span>
<span class="s2">    &quot;&quot;&quot;</span>
    <span class="n">batch_size</span> <span class="o">=</span> <span class="n">q</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">assert</span> <span class="n">batch_size</span> <span class="o">==</span> <span class="n">k</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">v</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s1">&#39;Batch Size for q,k,v wont match&#39;</span>

    <span class="k">assert</span> <span class="n">q</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="p">(</span><span class="n">batch_size</span><span class="p">,</span> <span class="n">num_attention_heads</span><span class="p">,</span> <span class="n">q_seq_len</span><span class="p">,</span> <span class="n">head_dims</span><span class="p">),</span> <span class="n">assertion_mkv_err</span>
    <span class="k">assert</span> <span class="n">k</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="p">(</span><span class="n">batch_size</span><span class="p">,</span> <span class="n">num_attention_heads</span><span class="p">,</span> <span class="n">kv_seq_len</span><span class="p">,</span> <span class="n">head_dims</span><span class="p">),</span> <span class="n">assertion_mkv_err</span>
    <span class="k">assert</span> <span class="n">v</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="p">(</span><span class="n">batch_size</span><span class="p">,</span> <span class="n">num_attention_heads</span><span class="p">,</span> <span class="n">kv_seq_len</span><span class="p">,</span> <span class="n">head_dims</span><span class="p">),</span> <span class="n">assertion_mkv_err</span>
    <span class="k">assert</span> <span class="n">bias</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="p">(</span><span class="n">batch_size</span><span class="p">,</span> <span class="n">num_attention_heads</span><span class="p">,</span> <span class="n">q_seq_len</span><span class="p">,</span> <span class="n">kv_seq_len</span><span class="p">),</span> <span class="n">assertion_mkv_err</span>

    <span class="n">flash_attn_fn</span><span class="p">,</span> <span class="n">f32_upcast</span><span class="p">,</span> <span class="n">do_shard_map</span> <span class="o">=</span> <span class="n">get_flash_attention</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">do_shard_map</span><span class="p">:</span>
        <span class="n">q</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">jax</span><span class="o">.</span><span class="n">numpy</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">)),</span> <span class="p">[</span><span class="n">q</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">])</span>
        <span class="k">assert</span> <span class="n">mesh</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;For Using Shard Map on GPUs you have to pass Mesh&#39;</span>
        <span class="n">ring_attention_sharded</span> <span class="o">=</span> <span class="n">shard_map</span><span class="p">(</span>
            <span class="n">partial</span><span class="p">(</span>
                <span class="n">flash_attn_fn</span><span class="p">,</span>
                <span class="n">axis_name</span><span class="o">=</span><span class="s2">&quot;mp&quot;</span><span class="p">,</span>
                <span class="n">float32_logits</span><span class="o">=</span><span class="n">f32_upcast</span><span class="p">,</span>
                <span class="n">blockwise_kwargs</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
                    <span class="n">deterministic</span><span class="o">=</span><span class="n">deterministic</span><span class="p">,</span>
                    <span class="n">dropout_rng</span><span class="o">=</span><span class="n">dropout_rng</span><span class="p">,</span>
                    <span class="n">attn_pdrop</span><span class="o">=</span><span class="n">attn_pdrop</span><span class="p">,</span>
                    <span class="n">causal</span><span class="o">=</span><span class="n">causal</span><span class="p">,</span>
                    <span class="n">query_chunk_size</span><span class="o">=</span><span class="n">block_q</span><span class="p">,</span>
                    <span class="n">key_chunk_size</span><span class="o">=</span><span class="n">block_k</span><span class="p">,</span>
                    <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">,</span>
                    <span class="n">policy</span><span class="o">=</span><span class="n">jax</span><span class="o">.</span><span class="n">checkpoint_policies</span><span class="o">.</span><span class="n">nothing_saveable</span><span class="p">,</span>
                    <span class="n">precision</span><span class="o">=</span><span class="n">precision</span><span class="p">,</span>
                    <span class="n">prevent_cse</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="p">),</span>
            <span class="n">mesh</span><span class="o">=</span><span class="n">mesh</span><span class="p">,</span>
            <span class="n">in_specs</span><span class="o">=</span><span class="p">(</span>
                <span class="n">q_ps</span><span class="p">,</span>
                <span class="n">k_ps</span><span class="p">,</span>
                <span class="n">v_ps</span><span class="p">,</span>
                <span class="n">b_ps</span>
            <span class="p">),</span>
            <span class="n">out_specs</span><span class="o">=</span><span class="n">a_ps</span><span class="p">,</span>
            <span class="n">check_rep</span><span class="o">=</span><span class="kc">False</span>
        <span class="p">)</span>
        <span class="n">attn_output</span> <span class="o">=</span> <span class="n">ring_attention_sharded</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">bias</span><span class="p">)</span>
        <span class="n">attn_output</span> <span class="o">=</span> <span class="n">with_sharding_constraint</span><span class="p">(</span><span class="n">attn_output</span><span class="p">,</span> <span class="n">a_ps</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">force_float32_tpu</span> <span class="ow">or</span> <span class="n">f32_upcast</span><span class="p">:</span>
            <span class="n">q</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">jax</span><span class="o">.</span><span class="n">numpy</span><span class="o">.</span><span class="n">float32</span><span class="p">),</span> <span class="p">[</span><span class="n">q</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">])</span>
        <span class="n">attn_output</span> <span class="o">=</span> <span class="n">fjformer</span><span class="o">.</span><span class="n">attention</span><span class="o">.</span><span class="n">jax_flash_attn_tpu</span><span class="o">.</span><span class="n">flash_attention</span><span class="p">(</span>
            <span class="n">q</span><span class="p">,</span>
            <span class="n">k</span><span class="p">,</span>
            <span class="n">v</span><span class="p">,</span>
            <span class="n">bias</span><span class="p">,</span>
            <span class="kc">None</span><span class="p">,</span>
            <span class="n">causal</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">sm_scale</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
            <span class="n">block_sizes</span><span class="o">=</span><span class="n">fjformer</span><span class="o">.</span><span class="n">attention</span><span class="o">.</span><span class="n">jax_flash_attn_tpu</span><span class="o">.</span><span class="n">BlockSizes</span><span class="p">(</span>
                <span class="n">block_b</span><span class="o">=</span><span class="n">block_b</span><span class="p">,</span>
                <span class="n">block_k</span><span class="o">=</span><span class="n">block_k</span><span class="p">,</span>
                <span class="n">block_q</span><span class="o">=</span><span class="n">block_q</span><span class="p">,</span>
                <span class="n">block_k_major</span><span class="o">=</span><span class="n">block_k</span>
            <span class="p">),</span>
            <span class="n">debug</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="n">attn_output</span> <span class="o">=</span> <span class="n">attn_output</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">dtype</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">attn_output</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h2 id="lib.python.EasyDel.modules.flax_modelling_utils.with_sharding_constraint" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">with_sharding_constraint</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">partition_specs</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>The with_sharding_constraint function is used to ensure that the sharding of a tensor
is consistent with the sharding of its inputs.  This function should be called on any
tensor which has been created by an operation which does not automatically handle this,
such as tf.concat or tf.split.</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>x</code></td>
          <td>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Define the tensor that will be sharded</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>partition_specs</code></td>
          <td>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Specify the partitioning of the data</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The same tensor with the</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>lib/python/EasyDel/modules/flax_modelling_utils.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">with_sharding_constraint</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">partition_specs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The with_sharding_constraint function is used to ensure that the sharding of a tensor</span>
<span class="sd">    is consistent with the sharding of its inputs.  This function should be called on any</span>
<span class="sd">    tensor which has been created by an operation which does not automatically handle this,</span>
<span class="sd">    such as tf.concat or tf.split.</span>

<span class="sd">    :param x: Define the tensor that will be sharded</span>
<span class="sd">    :param partition_specs: Specify the partitioning of the data</span>
<span class="sd">    :return: The same tensor with the</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">axis_names</span> <span class="o">=</span> <span class="n">get_names_from_partition_spec</span><span class="p">(</span><span class="n">partition_specs</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">names_in_mesh</span><span class="p">(</span><span class="o">*</span><span class="n">axis_names</span><span class="p">):</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">wsc</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">partition_specs</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">x</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>



  </div>

  </div>

</div>





                
              </article>
            </div>
          
          
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Erfan Zare Chavoshi-EasyDel
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "..", "features": [], "search": "../assets/javascripts/workers/search.f886a092.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.cd18aaf1.min.js"></script>
      
    
  </body>
</html>