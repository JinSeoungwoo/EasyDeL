
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
        <meta name="author" content="Erfan Zare Chavoshi">
      
      
      
        <link rel="prev" href="../lib-python-EasyDel-serve-torch_serve/">
      
      
        <link rel="next" href="../lib-python-EasyDel-serve-utils/">
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.5.3, mkdocs-material-9.4.14">
    
    
      
        <title>jax_serve - EasyDel</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.fad675c6.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#servejax_serve" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="EasyDel" class="md-header__button md-logo" aria-label="EasyDel" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            EasyDel
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              jax_serve
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/erfanzar/EasyDel" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="EasyDel" class="md-nav__button md-logo" aria-label="EasyDel" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    EasyDel
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/erfanzar/EasyDel" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../Install/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Install
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../AvailableModels/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    AvailableModels
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../Bits/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    EasyBIT
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Eval
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            Eval
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../lib-python-EasyDel-eval-lm_eval/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    lm_eval
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" >
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Transform
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            Transform
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../lib-python-EasyDel-transform-easydel_transform/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    easydel_transform
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../lib-python-EasyDel-transform-mpt/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    mpt
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../lib-python-EasyDel-transform-llama/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    llama
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../lib-python-EasyDel-transform-falcon/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    falcon
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../lib-python-EasyDel-transform-mistral/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    mistral
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../lib-python-EasyDel-transform-utils/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    utils
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../lib-python-EasyDel-smi-smi/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    smi
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8" checked>
        
          
          <label class="md-nav__link" for="__nav_8" id="__nav_8_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Serve
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_8_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_8">
            <span class="md-nav__icon md-icon"></span>
            Serve
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../lib-python-EasyDel-serve-torch_serve/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    torch_serve
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    jax_serve
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    jax_serve
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#lib.python.EasyDel.serve.jax_serve" class="md-nav__link">
    <span class="md-ellipsis">
      jax_serve
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lib.python.EasyDel.serve.jax_serve.JAXServer" class="md-nav__link">
    <span class="md-ellipsis">
      JAXServer
    </span>
  </a>
  
    <nav class="md-nav" aria-label="JAXServer">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#lib.python.EasyDel.serve.jax_serve.JAXServer.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__()
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#lib.python.EasyDel.serve.jax_serve.JAXServer.auto_configure" class="md-nav__link">
    <span class="md-ellipsis">
      auto_configure()
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#lib.python.EasyDel.serve.jax_serve.JAXServer.compile" class="md-nav__link">
    <span class="md-ellipsis">
      compile()
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#lib.python.EasyDel.serve.jax_serve.JAXServer.configure_generate_functions" class="md-nav__link">
    <span class="md-ellipsis">
      configure_generate_functions()
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#lib.python.EasyDel.serve.jax_serve.JAXServer.create_gradio_ui_chat" class="md-nav__link">
    <span class="md-ellipsis">
      create_gradio_ui_chat()
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#lib.python.EasyDel.serve.jax_serve.JAXServer.create_gradio_ui_instruct" class="md-nav__link">
    <span class="md-ellipsis">
      create_gradio_ui_instruct()
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#lib.python.EasyDel.serve.jax_serve.JAXServer.end" class="md-nav__link">
    <span class="md-ellipsis">
      end()
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#lib.python.EasyDel.serve.jax_serve.JAXServer.fire" class="md-nav__link">
    <span class="md-ellipsis">
      fire()
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#lib.python.EasyDel.serve.jax_serve.JAXServer.format_chat" class="md-nav__link">
    <span class="md-ellipsis">
      format_chat()
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#lib.python.EasyDel.serve.jax_serve.JAXServer.format_instruct" class="md-nav__link">
    <span class="md-ellipsis">
      format_instruct()
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#lib.python.EasyDel.serve.jax_serve.JAXServer.forward_chat" class="md-nav__link">
    <span class="md-ellipsis">
      forward_chat()
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#lib.python.EasyDel.serve.jax_serve.JAXServer.forward_chat_non_api" class="md-nav__link">
    <span class="md-ellipsis">
      forward_chat_non_api()
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#lib.python.EasyDel.serve.jax_serve.JAXServer.forward_instruct" class="md-nav__link">
    <span class="md-ellipsis">
      forward_instruct()
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#lib.python.EasyDel.serve.jax_serve.JAXServer.forward_instruct_non_api" class="md-nav__link">
    <span class="md-ellipsis">
      forward_instruct_non_api()
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#lib.python.EasyDel.serve.jax_serve.JAXServer.generate" class="md-nav__link">
    <span class="md-ellipsis">
      generate()
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#lib.python.EasyDel.serve.jax_serve.JAXServer.get_memory" class="md-nav__link">
    <span class="md-ellipsis">
      get_memory()
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#lib.python.EasyDel.serve.jax_serve.JAXServer.greedy_generate" class="md-nav__link">
    <span class="md-ellipsis">
      greedy_generate()
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#lib.python.EasyDel.serve.jax_serve.JAXServer.launch" class="md-nav__link">
    <span class="md-ellipsis">
      launch()
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#lib.python.EasyDel.serve.jax_serve.JAXServer.load" class="md-nav__link">
    <span class="md-ellipsis">
      load()
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#lib.python.EasyDel.serve.jax_serve.JAXServer.load_from_params" class="md-nav__link">
    <span class="md-ellipsis">
      load_from_params()
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#lib.python.EasyDel.serve.jax_serve.JAXServer.process" class="md-nav__link">
    <span class="md-ellipsis">
      process()
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#lib.python.EasyDel.serve.jax_serve.JAXServer.process_gradio_chat" class="md-nav__link">
    <span class="md-ellipsis">
      process_gradio_chat()
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#lib.python.EasyDel.serve.jax_serve.JAXServer.process_gradio_instruct" class="md-nav__link">
    <span class="md-ellipsis">
      process_gradio_instruct()
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#lib.python.EasyDel.serve.jax_serve.JAXServer.shard_params" class="md-nav__link">
    <span class="md-ellipsis">
      shard_params()
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#lib.python.EasyDel.serve.jax_serve.JAXServer.status" class="md-nav__link">
    <span class="md-ellipsis">
      status()
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lib.python.EasyDel.serve.jax_serve.JaxServerConfig" class="md-nav__link">
    <span class="md-ellipsis">
      JaxServerConfig
    </span>
  </a>
  
    <nav class="md-nav" aria-label="JaxServerConfig">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#lib.python.EasyDel.serve.jax_serve.JaxServerConfig.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__()
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../lib-python-EasyDel-serve-utils/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    utils
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_9" >
        
          
          <label class="md-nav__link" for="__nav_9" id="__nav_9_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Modules
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_9_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_9">
            <span class="md-nav__icon md-icon"></span>
            Modules
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../lib-python-EasyDel-modules-falcon-modelling_falcon_flax/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Falcon
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../lib-python-EasyDel-modules-palm-modelling_palm_flax/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Palm
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../lib-python-EasyDel-modules-flax_modelling_utils/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    flax_modelling_utils
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../lib-python-EasyDel-modules-gpt_neo_x-modelling_gpt_neo_x_flax/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    GPT-Neox
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../lib-python-EasyDel-modules-gpt_j-modelling_gpt_j_flax/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    GPT-J
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../lib-python-EasyDel-modules-mistral-modelling_mistral_flax/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Mistral
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../lib-python-EasyDel-modules-auto_models/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    auto_models
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../lib-python-EasyDel-modules-lucid_transformer-modelling_lt_flax/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    LucidTransformers
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../lib-python-EasyDel-modules-opt-modelling_opt_flax/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    OPT
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../lib-python-EasyDel-modules-mosaic_mpt-modelling_mpt_flax/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    MPT
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../lib-python-EasyDel-modules-llama-modelling_llama_flax/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Llama
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../lib-python-EasyDel-modules-t5-modelling_t5_flax/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    T5
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../lib-python-EasyDel-configs-configs/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    configs
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_11" >
        
          
          <label class="md-nav__link" for="__nav_11" id="__nav_11_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Utils
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_11_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_11">
            <span class="md-nav__icon md-icon"></span>
            Utils
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../lib-python-EasyDel-utils-tensor_utils/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    tensor_utils
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../lib-python-EasyDel-utils-prompters/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    prompters
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../lib-python-EasyDel-utils-utils/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    utils
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../lib-python-EasyDel-utils-checker/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    checker
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_12" >
        
          
          <label class="md-nav__link" for="__nav_12" id="__nav_12_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    RLHF
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_12_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_12">
            <span class="md-nav__icon md-icon"></span>
            RLHF
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../lib-python-EasyDel-rlhf-trainer/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    trainer
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../lib-python-EasyDel-rlhf-reward/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    reward
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../lib-python-EasyDel-rlhf-ppo/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ppo
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../lib-python-EasyDel-rlhf-utils/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    utils
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_13" >
        
          
          <label class="md-nav__link" for="__nav_13" id="__nav_13_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Trainer
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_13_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_13">
            <span class="md-nav__icon md-icon"></span>
            Trainer
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../lib-python-EasyDel-trainer-fsdp_train/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    fsdp_train
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../lib-python-EasyDel-trainer-config/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    config
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../lib-python-EasyDel-trainer-tf_dataset/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    tf_dataset
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../lib-python-EasyDel-trainer-training_utils/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    training_utils
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_14" >
        
          
          <label class="md-nav__link" for="__nav_14" id="__nav_14_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Linen
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_14_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_14">
            <span class="md-nav__icon md-icon"></span>
            Linen
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../lib-python-EasyDel-linen-bits/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    bits
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../lib-python-EasyDel-linen-utils/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    utils
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_15" >
        
          
          <label class="md-nav__link" for="__nav_15" id="__nav_15_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    RL Trainer
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_15_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_15">
            <span class="md-nav__icon md-icon"></span>
            RL Trainer
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../lib-python-EasyDel-rl_trainer-models-modelling_base.md" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    models/modelling_base
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../lib-python-EasyDel-rl_trainer-models-modelling_value_head.md" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    models/modelling_value_head
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../lib-python-EasyDel-rl_trainer-core.md" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    core
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_16" >
        
          
          <label class="md-nav__link" for="__nav_16" id="__nav_16_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Data Preprocessing
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_16_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_16">
            <span class="md-nav__icon md-icon"></span>
            Data Preprocessing
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../lib-python-EasyDel-data_preprocessing-_processor/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    data_preprocessing/_processor
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_17" >
        
          
          <label class="md-nav__link" for="__nav_17" id="__nav_17_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Examples
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_17_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_17">
            <span class="md-nav__icon md-icon"></span>
            Examples
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../PyTorchServer/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    PytorchServer
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../JAXServer/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    JAXServer
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../DataProcessing/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    DataProcessing
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../TrainingExample/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    TrainingExample
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Falcon/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Falcon Models
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Llama/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Llama Models
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Llama2/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Llama2 Models
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Mistral/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Mistral Models
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../MosaicMPT/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    MosaicMPT Models
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#lib.python.EasyDel.serve.jax_serve" class="md-nav__link">
    <span class="md-ellipsis">
      jax_serve
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lib.python.EasyDel.serve.jax_serve.JAXServer" class="md-nav__link">
    <span class="md-ellipsis">
      JAXServer
    </span>
  </a>
  
    <nav class="md-nav" aria-label="JAXServer">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#lib.python.EasyDel.serve.jax_serve.JAXServer.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__()
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#lib.python.EasyDel.serve.jax_serve.JAXServer.auto_configure" class="md-nav__link">
    <span class="md-ellipsis">
      auto_configure()
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#lib.python.EasyDel.serve.jax_serve.JAXServer.compile" class="md-nav__link">
    <span class="md-ellipsis">
      compile()
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#lib.python.EasyDel.serve.jax_serve.JAXServer.configure_generate_functions" class="md-nav__link">
    <span class="md-ellipsis">
      configure_generate_functions()
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#lib.python.EasyDel.serve.jax_serve.JAXServer.create_gradio_ui_chat" class="md-nav__link">
    <span class="md-ellipsis">
      create_gradio_ui_chat()
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#lib.python.EasyDel.serve.jax_serve.JAXServer.create_gradio_ui_instruct" class="md-nav__link">
    <span class="md-ellipsis">
      create_gradio_ui_instruct()
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#lib.python.EasyDel.serve.jax_serve.JAXServer.end" class="md-nav__link">
    <span class="md-ellipsis">
      end()
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#lib.python.EasyDel.serve.jax_serve.JAXServer.fire" class="md-nav__link">
    <span class="md-ellipsis">
      fire()
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#lib.python.EasyDel.serve.jax_serve.JAXServer.format_chat" class="md-nav__link">
    <span class="md-ellipsis">
      format_chat()
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#lib.python.EasyDel.serve.jax_serve.JAXServer.format_instruct" class="md-nav__link">
    <span class="md-ellipsis">
      format_instruct()
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#lib.python.EasyDel.serve.jax_serve.JAXServer.forward_chat" class="md-nav__link">
    <span class="md-ellipsis">
      forward_chat()
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#lib.python.EasyDel.serve.jax_serve.JAXServer.forward_chat_non_api" class="md-nav__link">
    <span class="md-ellipsis">
      forward_chat_non_api()
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#lib.python.EasyDel.serve.jax_serve.JAXServer.forward_instruct" class="md-nav__link">
    <span class="md-ellipsis">
      forward_instruct()
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#lib.python.EasyDel.serve.jax_serve.JAXServer.forward_instruct_non_api" class="md-nav__link">
    <span class="md-ellipsis">
      forward_instruct_non_api()
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#lib.python.EasyDel.serve.jax_serve.JAXServer.generate" class="md-nav__link">
    <span class="md-ellipsis">
      generate()
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#lib.python.EasyDel.serve.jax_serve.JAXServer.get_memory" class="md-nav__link">
    <span class="md-ellipsis">
      get_memory()
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#lib.python.EasyDel.serve.jax_serve.JAXServer.greedy_generate" class="md-nav__link">
    <span class="md-ellipsis">
      greedy_generate()
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#lib.python.EasyDel.serve.jax_serve.JAXServer.launch" class="md-nav__link">
    <span class="md-ellipsis">
      launch()
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#lib.python.EasyDel.serve.jax_serve.JAXServer.load" class="md-nav__link">
    <span class="md-ellipsis">
      load()
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#lib.python.EasyDel.serve.jax_serve.JAXServer.load_from_params" class="md-nav__link">
    <span class="md-ellipsis">
      load_from_params()
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#lib.python.EasyDel.serve.jax_serve.JAXServer.process" class="md-nav__link">
    <span class="md-ellipsis">
      process()
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#lib.python.EasyDel.serve.jax_serve.JAXServer.process_gradio_chat" class="md-nav__link">
    <span class="md-ellipsis">
      process_gradio_chat()
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#lib.python.EasyDel.serve.jax_serve.JAXServer.process_gradio_instruct" class="md-nav__link">
    <span class="md-ellipsis">
      process_gradio_instruct()
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#lib.python.EasyDel.serve.jax_serve.JAXServer.shard_params" class="md-nav__link">
    <span class="md-ellipsis">
      shard_params()
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#lib.python.EasyDel.serve.jax_serve.JAXServer.status" class="md-nav__link">
    <span class="md-ellipsis">
      status()
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lib.python.EasyDel.serve.jax_serve.JaxServerConfig" class="md-nav__link">
    <span class="md-ellipsis">
      JaxServerConfig
    </span>
  </a>
  
    <nav class="md-nav" aria-label="JaxServerConfig">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#lib.python.EasyDel.serve.jax_serve.JaxServerConfig.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__()
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  


<h1 id="servejax_serve">serve.jax_serve</h1>


<div class="doc doc-object doc-module">



<a id="lib.python.EasyDel.serve.jax_serve"></a>
  <div class="doc doc-contents first">

  

  <div class="doc doc-children">








<div class="doc doc-object doc-class">




<h2 id="lib.python.EasyDel.serve.jax_serve.JAXServer" class="doc doc-heading">
          <code>JAXServer</code>


</h2>


  <div class="doc doc-contents ">
          <p class="doc doc-class-bases">
            Bases: <code>object</code></p>


            <details class="quote">
              <summary>Source code in <code>lib/python/EasyDel/serve/jax_serve.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span>
<span class="normal">667</span>
<span class="normal">668</span>
<span class="normal">669</span>
<span class="normal">670</span>
<span class="normal">671</span>
<span class="normal">672</span>
<span class="normal">673</span>
<span class="normal">674</span>
<span class="normal">675</span>
<span class="normal">676</span>
<span class="normal">677</span>
<span class="normal">678</span>
<span class="normal">679</span>
<span class="normal">680</span>
<span class="normal">681</span>
<span class="normal">682</span>
<span class="normal">683</span>
<span class="normal">684</span>
<span class="normal">685</span>
<span class="normal">686</span>
<span class="normal">687</span>
<span class="normal">688</span>
<span class="normal">689</span>
<span class="normal">690</span>
<span class="normal">691</span>
<span class="normal">692</span>
<span class="normal">693</span>
<span class="normal">694</span>
<span class="normal">695</span>
<span class="normal">696</span>
<span class="normal">697</span>
<span class="normal">698</span>
<span class="normal">699</span>
<span class="normal">700</span>
<span class="normal">701</span>
<span class="normal">702</span>
<span class="normal">703</span>
<span class="normal">704</span>
<span class="normal">705</span>
<span class="normal">706</span>
<span class="normal">707</span>
<span class="normal">708</span>
<span class="normal">709</span>
<span class="normal">710</span>
<span class="normal">711</span>
<span class="normal">712</span>
<span class="normal">713</span>
<span class="normal">714</span>
<span class="normal">715</span>
<span class="normal">716</span>
<span class="normal">717</span>
<span class="normal">718</span>
<span class="normal">719</span>
<span class="normal">720</span>
<span class="normal">721</span>
<span class="normal">722</span>
<span class="normal">723</span>
<span class="normal">724</span>
<span class="normal">725</span>
<span class="normal">726</span>
<span class="normal">727</span>
<span class="normal">728</span>
<span class="normal">729</span>
<span class="normal">730</span>
<span class="normal">731</span>
<span class="normal">732</span>
<span class="normal">733</span>
<span class="normal">734</span>
<span class="normal">735</span>
<span class="normal">736</span>
<span class="normal">737</span>
<span class="normal">738</span>
<span class="normal">739</span>
<span class="normal">740</span>
<span class="normal">741</span>
<span class="normal">742</span>
<span class="normal">743</span>
<span class="normal">744</span>
<span class="normal">745</span>
<span class="normal">746</span>
<span class="normal">747</span>
<span class="normal">748</span>
<span class="normal">749</span>
<span class="normal">750</span>
<span class="normal">751</span>
<span class="normal">752</span>
<span class="normal">753</span>
<span class="normal">754</span>
<span class="normal">755</span>
<span class="normal">756</span>
<span class="normal">757</span>
<span class="normal">758</span>
<span class="normal">759</span>
<span class="normal">760</span>
<span class="normal">761</span>
<span class="normal">762</span>
<span class="normal">763</span>
<span class="normal">764</span>
<span class="normal">765</span>
<span class="normal">766</span>
<span class="normal">767</span>
<span class="normal">768</span>
<span class="normal">769</span>
<span class="normal">770</span>
<span class="normal">771</span>
<span class="normal">772</span>
<span class="normal">773</span>
<span class="normal">774</span>
<span class="normal">775</span>
<span class="normal">776</span>
<span class="normal">777</span>
<span class="normal">778</span>
<span class="normal">779</span>
<span class="normal">780</span>
<span class="normal">781</span>
<span class="normal">782</span>
<span class="normal">783</span>
<span class="normal">784</span>
<span class="normal">785</span>
<span class="normal">786</span>
<span class="normal">787</span>
<span class="normal">788</span>
<span class="normal">789</span>
<span class="normal">790</span>
<span class="normal">791</span>
<span class="normal">792</span>
<span class="normal">793</span>
<span class="normal">794</span>
<span class="normal">795</span>
<span class="normal">796</span>
<span class="normal">797</span>
<span class="normal">798</span>
<span class="normal">799</span>
<span class="normal">800</span>
<span class="normal">801</span>
<span class="normal">802</span>
<span class="normal">803</span>
<span class="normal">804</span>
<span class="normal">805</span>
<span class="normal">806</span>
<span class="normal">807</span>
<span class="normal">808</span>
<span class="normal">809</span>
<span class="normal">810</span>
<span class="normal">811</span>
<span class="normal">812</span>
<span class="normal">813</span>
<span class="normal">814</span>
<span class="normal">815</span>
<span class="normal">816</span>
<span class="normal">817</span>
<span class="normal">818</span>
<span class="normal">819</span>
<span class="normal">820</span>
<span class="normal">821</span>
<span class="normal">822</span>
<span class="normal">823</span>
<span class="normal">824</span>
<span class="normal">825</span>
<span class="normal">826</span>
<span class="normal">827</span>
<span class="normal">828</span>
<span class="normal">829</span>
<span class="normal">830</span>
<span class="normal">831</span>
<span class="normal">832</span>
<span class="normal">833</span>
<span class="normal">834</span>
<span class="normal">835</span>
<span class="normal">836</span>
<span class="normal">837</span>
<span class="normal">838</span>
<span class="normal">839</span>
<span class="normal">840</span>
<span class="normal">841</span>
<span class="normal">842</span>
<span class="normal">843</span>
<span class="normal">844</span>
<span class="normal">845</span>
<span class="normal">846</span>
<span class="normal">847</span>
<span class="normal">848</span>
<span class="normal">849</span>
<span class="normal">850</span>
<span class="normal">851</span>
<span class="normal">852</span>
<span class="normal">853</span>
<span class="normal">854</span>
<span class="normal">855</span>
<span class="normal">856</span>
<span class="normal">857</span>
<span class="normal">858</span>
<span class="normal">859</span>
<span class="normal">860</span>
<span class="normal">861</span>
<span class="normal">862</span>
<span class="normal">863</span>
<span class="normal">864</span>
<span class="normal">865</span>
<span class="normal">866</span>
<span class="normal">867</span>
<span class="normal">868</span>
<span class="normal">869</span>
<span class="normal">870</span>
<span class="normal">871</span>
<span class="normal">872</span>
<span class="normal">873</span>
<span class="normal">874</span>
<span class="normal">875</span>
<span class="normal">876</span>
<span class="normal">877</span>
<span class="normal">878</span>
<span class="normal">879</span>
<span class="normal">880</span>
<span class="normal">881</span>
<span class="normal">882</span>
<span class="normal">883</span>
<span class="normal">884</span>
<span class="normal">885</span>
<span class="normal">886</span>
<span class="normal">887</span>
<span class="normal">888</span>
<span class="normal">889</span>
<span class="normal">890</span>
<span class="normal">891</span>
<span class="normal">892</span>
<span class="normal">893</span>
<span class="normal">894</span>
<span class="normal">895</span>
<span class="normal">896</span>
<span class="normal">897</span>
<span class="normal">898</span>
<span class="normal">899</span>
<span class="normal">900</span>
<span class="normal">901</span>
<span class="normal">902</span>
<span class="normal">903</span>
<span class="normal">904</span>
<span class="normal">905</span>
<span class="normal">906</span>
<span class="normal">907</span>
<span class="normal">908</span>
<span class="normal">909</span>
<span class="normal">910</span>
<span class="normal">911</span>
<span class="normal">912</span>
<span class="normal">913</span>
<span class="normal">914</span>
<span class="normal">915</span>
<span class="normal">916</span>
<span class="normal">917</span>
<span class="normal">918</span>
<span class="normal">919</span>
<span class="normal">920</span>
<span class="normal">921</span>
<span class="normal">922</span>
<span class="normal">923</span>
<span class="normal">924</span>
<span class="normal">925</span>
<span class="normal">926</span>
<span class="normal">927</span>
<span class="normal">928</span>
<span class="normal">929</span>
<span class="normal">930</span>
<span class="normal">931</span>
<span class="normal">932</span>
<span class="normal">933</span>
<span class="normal">934</span>
<span class="normal">935</span>
<span class="normal">936</span>
<span class="normal">937</span>
<span class="normal">938</span>
<span class="normal">939</span>
<span class="normal">940</span>
<span class="normal">941</span>
<span class="normal">942</span>
<span class="normal">943</span>
<span class="normal">944</span>
<span class="normal">945</span>
<span class="normal">946</span>
<span class="normal">947</span>
<span class="normal">948</span>
<span class="normal">949</span>
<span class="normal">950</span>
<span class="normal">951</span>
<span class="normal">952</span>
<span class="normal">953</span>
<span class="normal">954</span>
<span class="normal">955</span>
<span class="normal">956</span>
<span class="normal">957</span>
<span class="normal">958</span>
<span class="normal">959</span>
<span class="normal">960</span>
<span class="normal">961</span>
<span class="normal">962</span>
<span class="normal">963</span>
<span class="normal">964</span>
<span class="normal">965</span>
<span class="normal">966</span>
<span class="normal">967</span>
<span class="normal">968</span>
<span class="normal">969</span>
<span class="normal">970</span>
<span class="normal">971</span>
<span class="normal">972</span>
<span class="normal">973</span>
<span class="normal">974</span>
<span class="normal">975</span>
<span class="normal">976</span>
<span class="normal">977</span>
<span class="normal">978</span>
<span class="normal">979</span>
<span class="normal">980</span>
<span class="normal">981</span>
<span class="normal">982</span>
<span class="normal">983</span>
<span class="normal">984</span>
<span class="normal">985</span>
<span class="normal">986</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">JAXServer</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>

<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The __init__ function is called when the class is instantiated.</span>
<span class="sd">        It sets up all the attributes that will be used by other methods in the class.</span>


<span class="sd">        :param self: Refer to the current instance of a class</span>
<span class="sd">        :param config: Pass the jaxserverconfig object</span>
<span class="sd">        :return: A fastapi object</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">process_uvicorn</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">prefix_tokenizer</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">tokenizer</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">,</span> \
            <span class="bp">self</span><span class="o">.</span><span class="n">rules</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_generate</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_greedy_generate</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="mi">8</span>
        <span class="k">assert</span> <span class="n">config</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="n">JaxServerConfig</span><span class="p">),</span> <span class="s1">&#39;config can be None or JaxServerConfig Type&#39;</span>
        <span class="k">if</span> <span class="n">config</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">config</span> <span class="o">=</span> <span class="n">JaxServerConfig</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">config</span> <span class="o">=</span> <span class="n">config</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_funcs_generated</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">number_of_served_request_until_last_up_time</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">rng_generator</span> <span class="o">=</span> <span class="n">RNG</span><span class="p">(</span><span class="mi">42</span><span class="p">)</span>
        <span class="n">initialise_tracking</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>
        <span class="n">array</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">jax</span><span class="o">.</span><span class="n">devices</span><span class="p">()),</span> <span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">mesh_axes_shape</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mesh</span> <span class="o">=</span> <span class="n">Mesh</span><span class="p">(</span><span class="n">mesh_utils</span><span class="o">.</span><span class="n">create_device_mesh</span><span class="p">(</span><span class="n">array</span><span class="o">.</span><span class="n">shape</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">mesh_axes_names</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">app</span> <span class="o">=</span> <span class="n">FastAPI</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s1">&#39;/chat&#39;</span><span class="p">)(</span><span class="bp">self</span><span class="o">.</span><span class="n">forward_chat</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s1">&#39;/instruct&#39;</span><span class="p">)(</span><span class="bp">self</span><span class="o">.</span><span class="n">forward_instruct</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;/status&#39;</span><span class="p">)(</span><span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gradio_app_chat</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_gradio_ui_chat</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gradio_app_instruct</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_gradio_ui_instruct</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">app</span> <span class="o">=</span> <span class="n">gr</span><span class="o">.</span><span class="n">mount_gradio_app</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">gradio_app_chat</span><span class="p">,</span> <span class="s1">&#39;/gradio_chat&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">app</span> <span class="o">=</span> <span class="n">gr</span><span class="o">.</span><span class="n">mount_gradio_app</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">gradio_app_instruct</span><span class="p">,</span> <span class="s1">&#39;/gradio_instruct&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">status</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The status function returns a dictionary with the following keys:</span>
<span class="sd">            config: A dictionary containing all of the configuration parameters for this server.</span>
<span class="sd">            devices: A string describing which devices are available to JAX.</span>
<span class="sd">            number_of_backends: The number of backends available to JAX.  This is usually equal to the number of GPUs on your machine, but can be less if you have not installed CUDA or if you have disabled some GPUs in your system BIOS settings (e.g., because they are defective).  It can also be more than one if you have multiple machines connected via MPI and running under Horov</span>

<span class="sd">        :param self: Represent the instance of the class</span>
<span class="sd">        :return: A dictionary with the following keys:</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="s1">&#39;config&#39;</span><span class="p">:</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">items</span><span class="p">()},</span>
            <span class="s1">&#39;devices&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">jax</span><span class="o">.</span><span class="n">devices</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="s1">&#39;number_of_backends&#39;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">jax</span><span class="o">.</span><span class="n">devices</span><span class="p">()),</span>
            <span class="s1">&#39;status&#39;</span><span class="p">:</span> <span class="s1">&#39;Ready&#39;</span><span class="p">,</span>
            <span class="s1">&#39;number_of_served_request_until_last_up_time&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">number_of_served_request_until_last_up_time</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="s1">&#39;memory&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">get_mem</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">}</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">get_memory</span><span class="p">():</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The get_memory function returns the total memory of the system in bytes.</span>


<span class="sd">        :return: The amount of memory used by the program</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">get_mem</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">configure_generate_functions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">tokenizer</span><span class="p">):</span>

<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The configure_generate_functions function is used to configure the generation functions for a given model.</span>

<span class="sd">        :param self: Access variables within the class</span>
<span class="sd">        :param model: Generate the model</span>
<span class="sd">        :param tokenizer: Get the eos_token_id, pad_token_id and bos token id</span>
<span class="sd">        :return: A function that takes in three parameters:</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">rules</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;you should first shard params with using ``shard_params`` method&#39;</span>

        <span class="k">if</span> <span class="n">tokenizer</span><span class="o">.</span><span class="n">pad_token</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                <span class="s1">&#39;Tokenizer does not contain padding token setting padding token to eos token for open end generation&#39;</span><span class="p">)</span>
            <span class="n">tokenizer</span><span class="o">.</span><span class="n">pad_token</span> <span class="o">=</span> <span class="n">tokenizer</span><span class="o">.</span><span class="n">eos_token</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">tokenizer</span><span class="o">.</span><span class="n">padding_side</span> <span class="o">=</span> <span class="s1">&#39;left&#39;</span>
            <span class="n">tokenizer</span><span class="o">.</span><span class="n">truncation_side</span> <span class="o">=</span> <span class="s1">&#39;left&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">prefix_tokenizer</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">tokenizer</span><span class="p">)</span>
            <span class="n">tokenizer</span><span class="o">.</span><span class="n">padding_side</span> <span class="o">=</span> <span class="s1">&#39;right&#39;</span>
            <span class="n">tokenizer</span><span class="o">.</span><span class="n">truncation_side</span> <span class="o">=</span> <span class="s1">&#39;right&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tokenizer</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">tokenizer</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">prefix_str</span><span class="p">(</span>
                <span class="s1">&#39;Warning&#39;</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;The class Model of Tokenizer </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">tokenizer</span><span class="p">)</span><span class="si">}</span><span class="s1"> do not support deepcopy option &#39;</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">use_prefix_tokenizer</span><span class="p">:</span>
                <span class="n">tokenizer</span><span class="o">.</span><span class="n">padding_side</span> <span class="o">=</span> <span class="s1">&#39;left&#39;</span>
                <span class="n">tokenizer</span><span class="o">.</span><span class="n">truncation_side</span> <span class="o">=</span> <span class="s1">&#39;left&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">tokenizer</span><span class="o">.</span><span class="n">padding_side</span> <span class="o">=</span> <span class="s1">&#39;right&#39;</span>
                <span class="n">tokenizer</span><span class="o">.</span><span class="n">truncation_side</span> <span class="o">=</span> <span class="s1">&#39;right&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">prefix_tokenizer</span> <span class="o">=</span> <span class="n">tokenizer</span>

        <span class="nd">@functools</span><span class="o">.</span><span class="n">partial</span><span class="p">(</span>
            <span class="n">pjit</span><span class="p">,</span>
            <span class="n">in_shardings</span><span class="o">=</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rules</span><span class="p">,</span> <span class="n">Ps</span><span class="p">(),</span> <span class="n">Ps</span><span class="p">()),</span>
            <span class="n">out_shardings</span><span class="o">=</span><span class="p">(</span><span class="n">Ps</span><span class="p">())</span>
        <span class="p">)</span>
        <span class="k">def</span> <span class="nf">greedy_generate</span><span class="p">(</span><span class="n">parameters</span><span class="p">,</span> <span class="n">input_ids</span><span class="p">,</span> <span class="n">attention_mask</span><span class="p">):</span>
            <span class="n">input_ids</span> <span class="o">=</span> <span class="n">with_sharding_constraint</span><span class="p">(</span><span class="n">input_ids</span><span class="p">,</span> <span class="n">Ps</span><span class="p">((</span><span class="s1">&#39;dp&#39;</span><span class="p">,</span> <span class="s1">&#39;fsdp&#39;</span><span class="p">)))</span>
            <span class="n">attention_mask</span> <span class="o">=</span> <span class="n">with_sharding_constraint</span><span class="p">(</span><span class="n">attention_mask</span><span class="p">,</span> <span class="n">Ps</span><span class="p">((</span><span class="s1">&#39;dp&#39;</span><span class="p">,</span> <span class="s1">&#39;fsdp&#39;</span><span class="p">)))</span>
            <span class="n">predict</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">generate</span><span class="p">(</span>
                <span class="n">input_ids</span><span class="p">,</span>
                <span class="n">attention_mask</span><span class="o">=</span><span class="n">attention_mask</span><span class="p">,</span>
                <span class="n">params</span><span class="o">=</span><span class="n">parameters</span><span class="p">,</span>
                <span class="n">generation_config</span><span class="o">=</span><span class="n">GenerationConfig</span><span class="p">(</span>
                    <span class="n">max_new_tokens</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">max_stream_tokens</span><span class="p">,</span>
                    <span class="n">eos_token_id</span><span class="o">=</span><span class="n">tokenizer</span><span class="o">.</span><span class="n">eos_token_id</span><span class="p">,</span>
                    <span class="n">pad_token_id</span><span class="o">=</span><span class="n">tokenizer</span><span class="o">.</span><span class="n">pad_token_id</span><span class="p">,</span>
                    <span class="n">bos_token_id</span><span class="o">=</span><span class="n">tokenizer</span><span class="o">.</span><span class="n">bos_token_id</span><span class="p">,</span>

                    <span class="n">do_sample</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                    <span class="n">num_beams</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="p">)</span><span class="o">.</span><span class="n">sequences</span><span class="p">[:,</span> <span class="n">input_ids</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]:]</span>
            <span class="k">return</span> <span class="n">predict</span>

        <span class="nd">@functools</span><span class="o">.</span><span class="n">partial</span><span class="p">(</span>
            <span class="n">pjit</span><span class="p">,</span>
            <span class="n">in_shardings</span><span class="o">=</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rules</span><span class="p">,</span> <span class="n">Ps</span><span class="p">(),</span> <span class="n">Ps</span><span class="p">()),</span>
            <span class="n">out_shardings</span><span class="o">=</span><span class="p">(</span><span class="n">Ps</span><span class="p">())</span>
        <span class="p">)</span>
        <span class="k">def</span> <span class="nf">generate</span><span class="p">(</span><span class="n">parameters</span><span class="p">,</span> <span class="n">input_ids</span><span class="p">,</span> <span class="n">attention_mask</span><span class="p">):</span>
            <span class="n">input_ids</span> <span class="o">=</span> <span class="n">with_sharding_constraint</span><span class="p">(</span><span class="n">input_ids</span><span class="p">,</span> <span class="n">Ps</span><span class="p">((</span><span class="s1">&#39;dp&#39;</span><span class="p">,</span> <span class="s1">&#39;fsdp&#39;</span><span class="p">)))</span>
            <span class="n">attention_mask</span> <span class="o">=</span> <span class="n">with_sharding_constraint</span><span class="p">(</span><span class="n">attention_mask</span><span class="p">,</span> <span class="n">Ps</span><span class="p">((</span><span class="s1">&#39;dp&#39;</span><span class="p">,</span> <span class="s1">&#39;fsdp&#39;</span><span class="p">)))</span>
            <span class="n">predict</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">generate</span><span class="p">(</span>
                <span class="n">input_ids</span><span class="p">,</span>
                <span class="n">attention_mask</span><span class="o">=</span><span class="n">attention_mask</span><span class="p">,</span>
                <span class="n">params</span><span class="o">=</span><span class="n">parameters</span><span class="p">,</span>
                <span class="n">generation_config</span><span class="o">=</span><span class="n">GenerationConfig</span><span class="p">(</span>
                    <span class="n">max_new_tokens</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">max_stream_tokens</span><span class="p">,</span>

                    <span class="n">eos_token_id</span><span class="o">=</span><span class="n">tokenizer</span><span class="o">.</span><span class="n">eos_token_id</span><span class="p">,</span>
                    <span class="n">pad_token_id</span><span class="o">=</span><span class="n">tokenizer</span><span class="o">.</span><span class="n">pad_token_id</span><span class="p">,</span>
                    <span class="n">bos_token_id</span><span class="o">=</span><span class="n">tokenizer</span><span class="o">.</span><span class="n">bos_token_id</span><span class="p">,</span>

                    <span class="n">temperature</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">temperature</span><span class="p">,</span>
                    <span class="n">do_sample</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                    <span class="n">num_beams</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                    <span class="n">top_p</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">top_p</span><span class="p">,</span>
                    <span class="n">top_k</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">top_k</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="p">)</span><span class="o">.</span><span class="n">sequences</span><span class="p">[:,</span> <span class="n">input_ids</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]:]</span>
            <span class="k">return</span> <span class="n">predict</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_generate</span> <span class="o">=</span> <span class="n">generate</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_greedy_generate</span> <span class="o">=</span> <span class="n">greedy_generate</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_funcs_generated</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">auto_configure</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">tokenizer</span><span class="p">,</span> <span class="n">partition_rules</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The auto_configure function is a helper function that will automatically configure the model for distributed training.</span>
<span class="sd">        It does this by:</span>
<span class="sd">            1) sharding the parameters of the model based on partition_rules, and then</span>
<span class="sd">            2) configuring generate functions to be used in distributed training.</span>

<span class="sd">        :param self: Represent the instance of the class</span>
<span class="sd">        :param model: Configure the model</span>
<span class="sd">        :param params: Store the parameters that are used to configure the model</span>
<span class="sd">        :param tokenizer: Tokenize the input text</span>
<span class="sd">        :param partition_rules: Specify how the parameters should be partitioned</span>
<span class="sd">        :return: A dictionary with the following keys:</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">shard_params</span><span class="p">(</span><span class="n">params</span><span class="o">=</span><span class="n">params</span><span class="p">,</span> <span class="n">partition_rules</span><span class="o">=</span><span class="n">partition_rules</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">configure_generate_functions</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">tokenizer</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">generate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                 <span class="n">params</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">flax</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">FrozenDict</span><span class="p">,</span> <span class="nb">dict</span><span class="p">],</span>
                 <span class="n">input_ids</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span><span class="p">,</span>
                 <span class="n">attention_mask</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span><span class="p">,</span>
                 <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The generate function is used to generate a sequence of tokens from the model.</span>

<span class="sd">        :param self: Access variables that belong to the class</span>
<span class="sd">        :param params: Union[flax.core.FrozenDict, dict]: Pass the parameters of the model to be used in generating text</span>
<span class="sd">        :param input_ids: chex.Array: Pass the input to the model</span>
<span class="sd">        :param attention_mask: chex.Array: Mask the padding tokens</span>
<span class="sd">        :return: The logits of the model</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_funcs_generated</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span>
                <span class="s1">&#39;this method will be implemented automatically after using ``configure_generate_functions`` function&#39;</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">mesh</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_generate</span><span class="p">(</span>
                    <span class="n">params</span><span class="p">,</span> <span class="n">input_ids</span><span class="p">,</span> <span class="n">attention_mask</span>
                <span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">load</span><span class="p">(</span>
            <span class="bp">cls</span><span class="p">,</span>
            <span class="n">model</span><span class="p">:</span> <span class="n">transformers</span><span class="o">.</span><span class="n">FlaxPreTrainedModel</span><span class="p">,</span>
            <span class="n">config_model</span><span class="p">:</span> <span class="n">transformers</span><span class="o">.</span><span class="n">PretrainedConfig</span><span class="p">,</span>
            <span class="n">tokenizer</span><span class="p">:</span> <span class="n">transformers</span><span class="o">.</span><span class="n">PreTrainedTokenizer</span><span class="p">,</span>
            <span class="n">path</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">PathLike</span><span class="p">],</span>
            <span class="n">config</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">add_params_field</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
            <span class="n">init_shape</span><span class="p">:</span> <span class="nb">tuple</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
            <span class="n">do_memory_log</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
            <span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The load function is used to load a pretrained model from disk.</span>

<span class="sd">        :param cls: Refer to the class itself</span>
<span class="sd">        :param model: transformers.FlaxPreTrainedModel: Initialize the server</span>
<span class="sd">        :param config_model: transformers.PretrainedConfig: Get the partition rules</span>
<span class="sd">        :param tokenizer: transformers.PreTrainedTokenizer: Load the tokenizer from the model</span>
<span class="sd">        :param path: typing.Union[str, os.PathLike]: Specify the path to the checkpoint file</span>
<span class="sd">        :param config: Configure the server</span>
<span class="sd">        :param add_params_field: bool: Add a params field to the server</span>
<span class="sd">        :param init_shape: tuple: Specify the shape of the input to be used for generating shard_fns</span>
<span class="sd">        :param do_memory_log: bool: Log the memory usage of the server</span>
<span class="sd">        :param verbose: bool: Print the compilation process</span>
<span class="sd">        :return: A server</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">model</span><span class="p">,</span>
                       <span class="s1">&#39;init_weights&#39;</span><span class="p">),</span> <span class="s1">&#39;model must contain init_weights func in order to init params for shard_fns&#39;</span>
        <span class="k">assert</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">config_model</span><span class="p">,</span>
                       <span class="s1">&#39;get_partition_rules&#39;</span><span class="p">),</span> <span class="s1">&#39;config_model must contain get_partition_rules functions&#39;</span>
        <span class="n">server</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">(</span><span class="n">config</span><span class="o">=</span><span class="n">config</span><span class="p">)</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
            <span class="s1">&#39;running _init() func in order to make shard_fns&#39;</span>
        <span class="p">)</span>
        <span class="k">with</span> <span class="n">jax</span><span class="o">.</span><span class="n">default_device</span><span class="p">(</span><span class="n">jax</span><span class="o">.</span><span class="n">devices</span><span class="p">(</span><span class="s1">&#39;cpu&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]):</span>
            <span class="k">def</span> <span class="nf">_init</span><span class="p">():</span>
                <span class="k">return</span> <span class="n">model</span><span class="o">.</span><span class="n">init_weights</span><span class="p">(</span><span class="n">jax</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">PRNGKey</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="n">init_shape</span><span class="p">)</span>

            <span class="n">shape</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">eval_shape</span><span class="p">(</span><span class="n">_init</span><span class="p">)</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
            <span class="s1">&#39;matching partition rules&#39;</span>
        <span class="p">)</span>
        <span class="n">rules</span> <span class="o">=</span> <span class="n">match_partition_rules</span><span class="p">(</span><span class="n">params</span><span class="o">=</span><span class="n">shape</span><span class="p">,</span> <span class="n">rules</span><span class="o">=</span><span class="n">config_model</span><span class="o">.</span><span class="n">get_partition_rules</span><span class="p">(</span><span class="kc">True</span><span class="p">))</span>

        <span class="k">with</span> <span class="n">server</span><span class="o">.</span><span class="n">mesh</span><span class="p">:</span>
            <span class="n">shard_fns</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">make_shard_and_gather_fns</span><span class="p">(</span><span class="n">rules</span><span class="p">,</span> <span class="n">get_float_dtype_by_name</span><span class="p">(</span><span class="n">server</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">dtype</span><span class="p">))</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                <span class="s1">&#39;loading checkpoints&#39;</span>
            <span class="p">)</span>

            <span class="n">shard_fns</span> <span class="o">=</span> <span class="n">flax</span><span class="o">.</span><span class="n">traverse_util</span><span class="o">.</span><span class="n">flatten_dict</span><span class="p">(</span><span class="n">shard_fns</span><span class="p">)</span>
            <span class="n">server</span><span class="o">.</span><span class="n">params</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">stream</span><span class="p">:</span>
                <span class="n">unpacker</span> <span class="o">=</span> <span class="n">msgpack</span><span class="o">.</span><span class="n">Unpacker</span><span class="p">(</span><span class="n">stream</span><span class="p">,</span> <span class="n">read_size</span><span class="o">=</span><span class="mi">83886080</span><span class="p">,</span> <span class="n">max_buffer_size</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
                <span class="n">pbar</span> <span class="o">=</span> <span class="n">tqdm</span><span class="o">.</span><span class="n">tqdm</span><span class="p">(</span><span class="n">unpacker</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">pbar</span><span class="p">:</span>
                    <span class="n">key</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
                    <span class="n">tensor</span> <span class="o">=</span> <span class="n">from_bytes</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
                    <span class="n">tensor</span> <span class="o">=</span> <span class="n">shard_fns</span><span class="p">[</span><span class="n">key</span><span class="p">](</span><span class="n">tensor</span><span class="p">)</span>
                    <span class="n">server</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">tensor</span>
                    <span class="k">if</span> <span class="n">do_memory_log</span><span class="p">:</span>
                        <span class="n">pbar</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">server</span><span class="o">.</span><span class="n">get_memory</span><span class="p">())</span>
                    <span class="n">pbar</span><span class="o">.</span><span class="n">set_description</span><span class="p">(</span><span class="s1">&#39;Sharding Params&#39;</span><span class="p">)</span>
        <span class="n">server</span><span class="o">.</span><span class="n">params</span> <span class="o">=</span> <span class="n">flax</span><span class="o">.</span><span class="n">traverse_util</span><span class="o">.</span><span class="n">unflatten_dict</span><span class="p">(</span><span class="n">server</span><span class="o">.</span><span class="n">params</span><span class="p">)</span>
        <span class="n">server</span><span class="o">.</span><span class="n">params</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;params&#39;</span><span class="p">:</span> <span class="n">server</span><span class="o">.</span><span class="n">params</span><span class="p">}</span> <span class="k">if</span> <span class="n">add_params_field</span> <span class="k">else</span> <span class="n">server</span><span class="o">.</span><span class="n">params</span>

        <span class="n">server</span><span class="o">.</span><span class="n">rules</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;params&#39;</span><span class="p">:</span> <span class="n">rules</span><span class="p">}</span> <span class="k">if</span> <span class="n">add_params_field</span> <span class="k">else</span> <span class="n">rules</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
            <span class="s1">&#39;configuring generate functions for the server&#39;</span>
        <span class="p">)</span>
        <span class="n">server</span><span class="o">.</span><span class="n">configure_generate_functions</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">tokenizer</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">server</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">pre_compile</span><span class="p">:</span>
            <span class="n">server</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">server</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">load_from_params</span><span class="p">(</span>
            <span class="bp">cls</span><span class="p">,</span>
            <span class="n">model</span><span class="p">:</span> <span class="n">transformers</span><span class="o">.</span><span class="n">FlaxPreTrainedModel</span><span class="p">,</span>
            <span class="n">config_model</span><span class="p">:</span> <span class="n">transformers</span><span class="o">.</span><span class="n">PretrainedConfig</span><span class="p">,</span>
            <span class="n">tokenizer</span><span class="p">:</span> <span class="n">transformers</span><span class="o">.</span><span class="n">PreTrainedTokenizer</span><span class="p">,</span>
            <span class="n">params</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Dict</span><span class="p">,</span>
            <span class="n">config</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">add_params_field</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
            <span class="n">do_memory_log</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
            <span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The load_from_params function is used to load a model from the parameters of a pretrained model.</span>
<span class="sd">        It takes in the following arguments:</span>
<span class="sd">            - cls: The class of the server you are loading, this should be Server or TPU_Server depending on what backend you want to use.</span>
<span class="sd">            - model: A FlaxPreTrainedModel object that contains all of your models functions and parameters. This can be found in transformers/flax_utils/models/*model*.py</span>
<span class="sd">                where *model* is replaced with whatever transformer you are using (e.g., bert). You can also create your own custom</span>

<span class="sd">        :param cls: Create a new instance of the class</span>
<span class="sd">        :param model: transformers.FlaxPreTrainedModel: Load the model</span>
<span class="sd">        :param config_model: transformers.PretrainedConfig: Get the partition rules</span>
<span class="sd">        :param tokenizer: transformers.PreTrainedTokenizer: Tokenize the input text</span>
<span class="sd">        :param params: typing.Dict: Pass in the parameters of the model</span>
<span class="sd">        :param config: Pass in the config file for the server</span>
<span class="sd">        :param add_params_field: bool: Add a params field to the server</span>
<span class="sd">        :param do_memory_log: bool: Log the memory usage of the server</span>
<span class="sd">        :param verbose: bool: Print out the status of the compilation</span>
<span class="sd">        :return: A server object</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">model</span><span class="p">,</span>
                       <span class="s1">&#39;init_weights&#39;</span><span class="p">),</span> <span class="s1">&#39;model must contain init_weights func in order to init params for shard_fns&#39;</span>
        <span class="k">assert</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">config_model</span><span class="p">,</span>
                       <span class="s1">&#39;get_partition_rules&#39;</span><span class="p">),</span> <span class="s1">&#39;config_model must contain get_partition_rules functions&#39;</span>
        <span class="n">server</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">(</span><span class="n">config</span><span class="o">=</span><span class="n">config</span><span class="p">)</span>

        <span class="k">with</span> <span class="n">server</span><span class="o">.</span><span class="n">mesh</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                <span class="s1">&#39;matching partition rules&#39;</span>
            <span class="p">)</span>
            <span class="n">rules</span> <span class="o">=</span> <span class="n">match_partition_rules</span><span class="p">(</span><span class="n">params</span><span class="o">=</span><span class="n">params</span><span class="p">,</span> <span class="n">rules</span><span class="o">=</span><span class="n">config_model</span><span class="o">.</span><span class="n">get_partition_rules</span><span class="p">(</span><span class="kc">True</span><span class="p">))</span>
            <span class="n">shard_fns</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">make_shard_and_gather_fns</span><span class="p">(</span><span class="n">rules</span><span class="p">,</span> <span class="n">get_float_dtype_by_name</span><span class="p">(</span><span class="n">server</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">dtype</span><span class="p">))</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                <span class="s1">&#39;sharding parameters across all of the chosen backend(tpu/gpu/cpu)s&#39;</span>
            <span class="p">)</span>
            <span class="n">params</span> <span class="o">=</span> <span class="n">flax</span><span class="o">.</span><span class="n">traverse_util</span><span class="o">.</span><span class="n">flatten_dict</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>
            <span class="n">shard_fns</span> <span class="o">=</span> <span class="n">flax</span><span class="o">.</span><span class="n">traverse_util</span><span class="o">.</span><span class="n">flatten_dict</span><span class="p">(</span><span class="n">shard_fns</span><span class="p">)</span>
            <span class="n">pbar</span> <span class="o">=</span> <span class="n">tqdm</span><span class="o">.</span><span class="n">tqdm</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">pbar</span><span class="p">:</span>

                <span class="n">key</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
                <span class="n">params</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">shard_fns</span><span class="p">[</span><span class="n">key</span><span class="p">](</span><span class="n">params</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>

                <span class="k">if</span> <span class="n">do_memory_log</span><span class="p">:</span>
                    <span class="n">pbar</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">server</span><span class="o">.</span><span class="n">get_memory</span><span class="p">())</span>
                <span class="n">pbar</span><span class="o">.</span><span class="n">set_description</span><span class="p">(</span><span class="s1">&#39;Sharding Params&#39;</span><span class="p">)</span>
            <span class="n">server</span><span class="o">.</span><span class="n">params</span> <span class="o">=</span> <span class="n">flax</span><span class="o">.</span><span class="n">traverse_util</span><span class="o">.</span><span class="n">unflatten_dict</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>
            <span class="n">server</span><span class="o">.</span><span class="n">params</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;params&#39;</span><span class="p">:</span> <span class="n">server</span><span class="o">.</span><span class="n">params</span><span class="p">}</span> <span class="k">if</span> <span class="n">add_params_field</span> <span class="k">else</span> <span class="n">server</span><span class="o">.</span><span class="n">params</span>
        <span class="n">server</span><span class="o">.</span><span class="n">rules</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;params&#39;</span><span class="p">:</span> <span class="n">rules</span><span class="p">}</span> <span class="k">if</span> <span class="n">add_params_field</span> <span class="k">else</span> <span class="n">rules</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
            <span class="s1">&#39;configuring generate functions for the server&#39;</span>
        <span class="p">)</span>
        <span class="n">server</span><span class="o">.</span><span class="n">configure_generate_functions</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">tokenizer</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">server</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">pre_compile</span><span class="p">:</span>
            <span class="n">server</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">server</span>

    <span class="k">def</span> <span class="nf">compile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The compile function is used to compile the model for use in inference.</span>
<span class="sd">        It does this by running through all possible combinations of rules and actions,</span>
<span class="sd">        and compiling them into functions that can be called later on during inference.</span>
<span class="sd">        This allows us to avoid having to recompile the model every time we want to run it,</span>
<span class="sd">        which would be very slow.</span>

<span class="sd">        :param self: Represent the instance of the class</span>
<span class="sd">        :param verbose: bool: Print out the compiling process</span>
<span class="sd">        :return: True, but what does it do?</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">_funcs_generated</span><span class="p">,</span> <span class="s1">&#39;funcs are not generated yet&#39;</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">rules</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;rules should not be None&#39;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">use_prefix_tokenizer</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\033</span><span class="s1">[1;91mCompiling Model Forwards Greedy/NonGreedy(Generate)&#39;</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Compiling Greedy Funcs&#39;</span><span class="p">)</span>

            <span class="n">r</span><span class="p">,</span> <span class="n">a</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="mi">2</span>
            <span class="k">for</span> <span class="n">r</span><span class="p">,</span> <span class="n">a</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">process</span><span class="p">(</span>
                    <span class="n">string</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span>
                    <span class="n">max_new_tokens</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">max_stream_tokens</span><span class="p">,</span>
                    <span class="n">greedy</span><span class="o">=</span><span class="kc">True</span>
            <span class="p">):</span>
                <span class="o">...</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Compiling NonGreedy(Generate) Funcs</span><span class="se">\033</span><span class="s1">[1;0m&#39;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">r</span><span class="p">,</span> <span class="n">a</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">process</span><span class="p">(</span>
                    <span class="n">string</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span>
                    <span class="n">max_new_tokens</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">max_stream_tokens</span><span class="p">,</span>
                    <span class="n">greedy</span><span class="o">=</span><span class="kc">False</span>
            <span class="p">):</span>
                <span class="o">...</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span>
                <span class="s1">&#39;</span><span class="se">\033</span><span class="s1">[1;91mSkip Compiling the compiling process is useless &#39;</span>
                <span class="s1">&#39;when you are not using prefix tokenizer</span><span class="se">\033</span><span class="s1">[1;0m&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">greedy_generate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                        <span class="n">params</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">flax</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">FrozenDict</span><span class="p">,</span> <span class="nb">dict</span><span class="p">],</span>
                        <span class="n">input_ids</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span><span class="p">,</span>
                        <span class="n">attention_mask</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span><span class="p">,</span>
                        <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The greedy_generate function is a helper function that takes in the model parameters, input_ids and attention_mask</span>
<span class="sd">        and returns the generated tokens. It uses greedy search to generate tokens one at a time.</span>


<span class="sd">        :param self: Refer to the object itself</span>
<span class="sd">        :param params: Union[flax.core.FrozenDict, dict]: Pass the parameters to the model</span>
<span class="sd">        :param input_ids: chex.Array: Pass in the input sequence</span>
<span class="sd">        :param attention_mask: chex.Array: Mask the input tokens</span>
<span class="sd">        :param : Specify the parameters of the model</span>
<span class="sd">        :return:  generated_ids</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_funcs_generated</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span>
                <span class="s1">&#39;this method will be implemented automatically after using ``configure_generate_functions`` function&#39;</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">mesh</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_greedy_generate</span><span class="p">(</span>
                    <span class="n">params</span><span class="p">,</span> <span class="n">input_ids</span><span class="p">,</span> <span class="n">attention_mask</span>
                <span class="p">)</span>

    <span class="k">def</span> <span class="nf">shard_params</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">partition_rules</span><span class="p">):</span>

<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The shard_params function takes in a set of parameters and a partition rule.</span>
<span class="sd">        The partition rule is used to determine how the parameters should be sharded across devices.</span>
<span class="sd">        For example, if we have two devices, one with 4GB of memory and another with 8GB of memory,</span>
<span class="sd">        we may want to shard our model such that the device with more memory has more parameters on it.</span>
<span class="sd">        This function returns an updated version of params where each parameter is now stored on its own device.</span>

<span class="sd">        :param self: Bind the instance of the class to a method</span>
<span class="sd">        :param params: Pass the parameters of the model to be sharded</span>
<span class="sd">        :param partition_rules: Specify how the parameters should be partitioned</span>
<span class="sd">        :return: The sharded parameters</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">log</span><span class="p">(</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">,</span>
            <span class="s1">&#39;the parameters will be sharded and ba saved inside server you can access them by ``JAXServer.params``&#39;</span><span class="p">)</span>
        <span class="n">rules</span> <span class="o">=</span> <span class="n">match_partition_rules</span><span class="p">(</span><span class="n">params</span><span class="o">=</span><span class="n">params</span><span class="p">,</span> <span class="n">rules</span><span class="o">=</span><span class="n">partition_rules</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rules</span> <span class="o">=</span> <span class="n">rules</span>
        <span class="n">shard_fns</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">make_shard_and_gather_fns</span><span class="p">(</span><span class="n">rules</span><span class="p">,</span> <span class="n">get_float_dtype_by_name</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">dtype</span><span class="p">))</span>

        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">mesh</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">params</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">tree_map</span><span class="p">(</span>
                <span class="k">lambda</span> <span class="n">f</span><span class="p">,</span> <span class="n">p</span><span class="p">:</span> <span class="n">f</span><span class="p">(</span><span class="n">p</span><span class="p">),</span> <span class="n">shard_fns</span><span class="p">,</span> <span class="n">params</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span>

    <span class="k">def</span> <span class="nf">forward_chat</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">ChatRequest</span><span class="p">):</span>

<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The forward_chat function is the main function of this class.</span>
<span class="sd">        It takes in a ChatRequest object, which contains a prompt and history.</span>
<span class="sd">        The prompt is the user&#39;s input to be processed by the chatbot, while history</span>
<span class="sd">        is an array of previous inputs and outputs from both sides (user and bot).</span>
<span class="sd">        The forward_chat function then formats these inputs into one string that can be processed by our model.</span>
<span class="sd">        This formatted string is then passed through our process() method, which returns an output response as well as how many tokens were used to generate it.</span>

<span class="sd">        :param self: Access the attributes and methods of the class</span>
<span class="sd">        :param data: ChatRequest: Pass in the data from the request</span>
<span class="sd">        :return: A dictionary with the following keys:</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_funcs_generated</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">{</span>
                <span class="s1">&#39;status&#39;</span><span class="p">:</span> <span class="s2">&quot;down&quot;</span>
            <span class="p">}</span>

        <span class="n">string</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">format_chat</span><span class="p">(</span>
            <span class="n">prompt</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">prompt</span><span class="p">,</span>
            <span class="n">system</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">history</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">history</span>
        <span class="p">)</span>

        <span class="n">response</span><span class="p">,</span> <span class="n">used_tokens</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="mi">2</span>
        <span class="k">for</span> <span class="n">response</span><span class="p">,</span> <span class="n">used_tokens</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">process</span><span class="p">(</span>
                <span class="n">string</span><span class="o">=</span><span class="n">string</span><span class="p">,</span>
                <span class="n">greedy</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">greedy</span><span class="p">,</span>
                <span class="n">max_new_tokens</span><span class="o">=</span><span class="kc">None</span>
        <span class="p">):</span>
            <span class="o">...</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">number_of_served_request_until_last_up_time</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="s1">&#39;input&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">string</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span>
            <span class="s1">&#39;response&#39;</span><span class="p">:</span> <span class="n">response</span><span class="p">,</span>
            <span class="s1">&#39;tokens_used&#39;</span><span class="p">:</span> <span class="n">used_tokens</span><span class="p">,</span>
        <span class="p">}</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">format_instruct</span><span class="p">(</span><span class="n">system</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">instruction</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Here you will get the system and instruction from user, and you can apply your prompting style</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">()</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">format_chat</span><span class="p">(</span><span class="n">history</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">prompt</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">system</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="kc">None</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Here you will get the system, prompt and history from user, and you can apply your prompting style</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">forward_instruct</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">InstructRequest</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The forward_instruct function is the main function of this class.</span>
<span class="sd">        It takes in a InstructRequest object, which contains the system and instruction to be processed.</span>
<span class="sd">        The function then formats the input string using format_instruct, and passes it into process().</span>
<span class="sd">        process() returns a tuple containing (response, used_tokens). The response is returned as part of</span>
<span class="sd">        the response dictionary. If no valid responses are found by process(), None will be returned instead.</span>

<span class="sd">        :param self: Bind the method to the object</span>
<span class="sd">        :param data: InstructRequest: Pass the system and instruction to the function</span>
<span class="sd">        :return: A dictionary with three keys:</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_funcs_generated</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">{</span>
                <span class="s1">&#39;status&#39;</span><span class="p">:</span> <span class="s2">&quot;down&quot;</span>
            <span class="p">}</span>

        <span class="n">response</span><span class="p">,</span> <span class="n">used_tokens</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="mi">2</span>
        <span class="n">string</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">format_instruct</span><span class="p">(</span>
            <span class="n">system</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">system</span><span class="p">,</span>
            <span class="n">instruction</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">instruction</span>
        <span class="p">)</span>
        <span class="k">for</span> <span class="n">response</span><span class="p">,</span> <span class="n">used_tokens</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">process</span><span class="p">(</span>
                <span class="n">string</span><span class="o">=</span><span class="n">string</span><span class="p">,</span>
                <span class="n">greedy</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">greedy</span><span class="p">,</span>
                <span class="n">max_new_tokens</span><span class="o">=</span><span class="kc">None</span>
        <span class="p">):</span>
            <span class="o">...</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">number_of_served_request_until_last_up_time</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="s1">&#39;input&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">string</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span>
            <span class="s1">&#39;response&#39;</span><span class="p">:</span> <span class="n">response</span><span class="p">,</span>
            <span class="s1">&#39;tokens_used&#39;</span><span class="p">:</span> <span class="n">used_tokens</span><span class="p">,</span>
        <span class="p">}</span>

    <span class="k">def</span> <span class="nf">forward_instruct_non_api</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prompt</span><span class="p">,</span> <span class="n">system</span><span class="p">,</span> <span class="n">greedy</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The forward_instruct_non_api function is a wrapper for the forward_instruct function.</span>
<span class="sd">        It takes in a prompt, system, and greedy flag as arguments and returns the response from</span>
<span class="sd">        the forward_instruct function. The purpose of this wrapper is to allow users to call</span>
<span class="sd">        forward_instruct without having to create an InstructRequest object.</span>

<span class="sd">        :param self: Represent the instance of the class</span>
<span class="sd">        :param prompt: Pass the instruction to the system</span>
<span class="sd">        :param system: Specify which system to use for the instruction</span>
<span class="sd">        :param greedy: Determine whether the system should return</span>
<span class="sd">        :return: The response from the forward_instruct function</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">InstructRequest</span><span class="p">(</span>
            <span class="n">prompt</span><span class="o">=</span><span class="n">prompt</span><span class="p">,</span>
            <span class="n">system</span><span class="o">=</span><span class="n">system</span><span class="p">,</span>
            <span class="n">greedy</span><span class="o">=</span><span class="n">greedy</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">forward_instruct</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">forward_chat_non_api</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prompt</span><span class="p">,</span> <span class="n">history</span><span class="p">,</span> <span class="n">greedy</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The forward_chat_non_api function is a wrapper for the forward_chat function.</span>
<span class="sd">        It takes in a prompt, history, and greedy parameter and returns the response from</span>
<span class="sd">        the forward_chat function. The purpose of this wrapper is to allow users to use</span>
<span class="sd">        the chatbot without having to create ChatRequest objects.</span>

<span class="sd">        :param self: Represent the instance of the class</span>
<span class="sd">        :param prompt: Pass the user&#39;s input to the model</span>
<span class="sd">        :param history: Pass the history of the conversation to the model</span>
<span class="sd">        :param greedy: Determine whether the model should use a greedy search</span>
<span class="sd">        :return: A chat-response object</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">ChatRequest</span><span class="p">(</span>
            <span class="n">prompt</span><span class="o">=</span><span class="n">prompt</span><span class="p">,</span>
            <span class="n">history</span><span class="o">=</span><span class="n">history</span><span class="p">,</span>
            <span class="n">greedy</span><span class="o">=</span><span class="n">greedy</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">forward_chat</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">process</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                <span class="n">string</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                <span class="o">*</span><span class="p">,</span>
                <span class="n">greedy</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                <span class="n">max_new_tokens</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                <span class="o">**</span><span class="n">kwargs</span>
                <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The process function is the main function of a model. It takes in an input string and returns a list of strings</span>
<span class="sd">        that are generated from that input string. The process function can be called multiple times with different inputs,</span>
<span class="sd">        and each time it will return a new set of outputs based on those inputs.</span>

<span class="sd">        :param self: Access the class attributes</span>
<span class="sd">        :param string: str: Pass the string that we want to generate</span>
<span class="sd">        :param *: Pass a variable number of arguments to a function</span>
<span class="sd">        :param greedy: bool: Determine whether to use the greedy or non-greedy version of the generate function</span>
<span class="sd">        :param max_new_tokens: int: Set the number of tokens to generate</span>
<span class="sd">        :param **kwargs: Pass any additional parameters to the process function</span>
<span class="sd">        :return: A generator that yields the predicted text and the number of tokens generated</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">tokens</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">prefix_tokenizer</span><span class="p">(</span>
            <span class="n">string</span><span class="p">,</span>
            <span class="n">max_length</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">max_length</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">max_stream_tokens</span><span class="p">,</span>
            <span class="n">padding</span><span class="o">=</span><span class="s1">&#39;max_length&#39;</span><span class="p">,</span>
            <span class="n">return_tensors</span><span class="o">=</span><span class="s1">&#39;jax&#39;</span>
        <span class="p">)</span> \
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">use_prefix_tokenizer</span> <span class="k">else</span> \
            <span class="bp">self</span><span class="o">.</span><span class="n">tokenizer</span><span class="p">(</span>
                <span class="n">string</span><span class="p">,</span>
                <span class="n">return_tensors</span><span class="o">=</span><span class="s1">&#39;jax&#39;</span>
            <span class="p">)</span>

        <span class="n">input_ids</span> <span class="o">=</span> <span class="n">tokens</span><span class="o">.</span><span class="n">input_ids</span>
        <span class="n">attention_mask</span> <span class="o">=</span> <span class="n">tokens</span><span class="o">.</span><span class="n">attention_mask</span>
        <span class="n">num_generated_tokens</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">pad</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">max_length</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">max_stream_tokens</span>

        <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">((</span><span class="n">max_new_tokens</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">max_new_tokens</span><span class="p">)</span> <span class="o">//</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">max_stream_tokens</span><span class="p">):</span>
            <span class="n">predicted_token</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">greedy_generate</span><span class="p">(</span>
                <span class="n">params</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">,</span>
                <span class="n">input_ids</span><span class="o">=</span><span class="n">input_ids</span><span class="p">,</span>
                <span class="n">attention_mask</span><span class="o">=</span><span class="n">attention_mask</span>
            <span class="p">)</span> <span class="k">if</span> <span class="n">greedy</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">generate</span><span class="p">(</span>
                <span class="n">params</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">,</span>
                <span class="n">input_ids</span><span class="o">=</span><span class="n">input_ids</span><span class="p">,</span>
                <span class="n">attention_mask</span><span class="o">=</span><span class="n">attention_mask</span>
            <span class="p">)</span>

            <span class="n">num_generated_tokens</span> <span class="o">+=</span> <span class="n">predicted_token</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

            <span class="n">input_ids</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span>
                <span class="p">(</span><span class="n">input_ids</span><span class="p">,</span> <span class="n">predicted_token</span><span class="p">),</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span>
            <span class="p">)[:,</span> <span class="o">-</span><span class="n">pad</span><span class="p">:]</span>
            <span class="n">attention_mask</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span>
                <span class="p">(</span><span class="n">attention_mask</span><span class="p">,</span> <span class="n">jnp</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">attention_mask</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">max_stream_tokens</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">jnp</span><span class="o">.</span><span class="n">int32</span><span class="p">)),</span>
                <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span>
            <span class="p">)[:,</span> <span class="o">-</span><span class="n">pad</span><span class="p">:]</span>

            <span class="k">yield</span> <span class="bp">self</span><span class="o">.</span><span class="n">tokenizer</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="n">input_ids</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="o">-</span><span class="n">num_generated_tokens</span><span class="p">:],</span>
                                        <span class="n">skip_special_tokens</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span> <span class="n">num_generated_tokens</span>
            <span class="k">if</span> <span class="n">predicted_token</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">tokenizer</span><span class="o">.</span><span class="n">eos_token_id</span> <span class="ow">or</span> <span class="n">predicted_token</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span>
                <span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">prefix_tokenizer</span><span class="o">.</span><span class="n">eos_token_id</span><span class="p">:</span>
                <span class="k">break</span>

    <span class="k">def</span> <span class="nf">process_gradio_chat</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prompt</span><span class="p">,</span> <span class="n">history</span><span class="p">,</span> <span class="n">max_new_tokens</span><span class="p">,</span> <span class="n">system</span><span class="p">,</span> <span class="n">greedy</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The process_gradio_chat function is a wrapper for the process function.</span>
<span class="sd">        It takes in a prompt, history, max_new_tokens and system as arguments.</span>
<span class="sd">        The string variable is set to the output of format_chat with the given history and prompt.</span>
<span class="sd">        If stream tokens are not enabled then it will append an empty response to history and iterate through all responses from process until there are no more left (the last one). It will then return an empty string along with this new updated version of history. If stream tokens are enabled it appends an empty response to the end of our current list of histories (history) and iterates through</span>

<span class="sd">        :param self: Refer to the object itself</span>
<span class="sd">        :param prompt: Add the user&#39;s input to the history</span>
<span class="sd">        :param history: Keep track of the conversation</span>
<span class="sd">        :param max_new_tokens: Limit the number of tokens that can be generated by the model</span>
<span class="sd">        :param system: Determine whether the message is from the user or system</span>
<span class="sd">        :param greedy: Determine if the model should generate a response token by token or all at once</span>
<span class="sd">        :return: A tuple of two values:</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">string</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">format_chat</span><span class="p">(</span><span class="n">history</span><span class="o">=</span><span class="n">history</span><span class="p">,</span> <span class="n">prompt</span><span class="o">=</span><span class="n">prompt</span><span class="p">,</span> <span class="n">system</span><span class="o">=</span><span class="n">system</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">stream_tokens_for_gradio</span><span class="p">:</span>
            <span class="n">response</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
            <span class="k">for</span> <span class="n">response</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">process</span><span class="p">(</span>
                    <span class="n">string</span><span class="o">=</span><span class="n">string</span><span class="p">,</span>
                    <span class="n">greedy</span><span class="o">=</span><span class="n">greedy</span><span class="p">,</span>
                    <span class="n">max_new_tokens</span><span class="o">=</span><span class="n">max_new_tokens</span><span class="p">,</span>
            <span class="p">):</span>
                <span class="k">pass</span>
            <span class="n">history</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">prompt</span><span class="p">,</span> <span class="n">response</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">history</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">prompt</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">])</span>
            <span class="k">for</span> <span class="n">response</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">process</span><span class="p">(</span>
                    <span class="n">string</span><span class="o">=</span><span class="n">string</span><span class="p">,</span>
                    <span class="n">greedy</span><span class="o">=</span><span class="n">greedy</span><span class="p">,</span>
                    <span class="n">max_new_tokens</span><span class="o">=</span><span class="n">max_new_tokens</span><span class="p">,</span>
            <span class="p">):</span>
                <span class="n">history</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">response</span>
                <span class="k">yield</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">history</span>
        <span class="k">return</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">history</span>

    <span class="k">def</span> <span class="nf">process_gradio_instruct</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">instruction</span><span class="p">,</span> <span class="n">system</span><span class="p">,</span> <span class="n">max_new_tokens</span><span class="p">,</span> <span class="n">greedy</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The process_gradio_instruct function is a wrapper for the process function.</span>
<span class="sd">        It takes in an instruction and system, formats them into a string, and then passes that string to the process function.</span>
<span class="sd">        The response from this call to process is returned as output.</span>

<span class="sd">        :param self: Refer to the instance of the class</span>
<span class="sd">        :param instruction: Pass in the instruction from the user</span>
<span class="sd">        :param system: Determine which system to use for the instruction</span>
<span class="sd">        :param max_new_tokens: Limit the number of new tokens that can be added to the vocabulary</span>
<span class="sd">        :param greedy: Determine whether the model should be greedy or not</span>
<span class="sd">        :return: A tuple of two strings:</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">string</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">format_instruct</span><span class="p">(</span><span class="n">instruction</span><span class="o">=</span><span class="n">instruction</span><span class="p">,</span> <span class="n">system</span><span class="o">=</span><span class="n">system</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">stream_tokens_for_gradio</span><span class="p">:</span>
            <span class="n">response</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
            <span class="k">for</span> <span class="n">response</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">process</span><span class="p">(</span>
                    <span class="n">string</span><span class="o">=</span><span class="n">string</span><span class="p">,</span>
                    <span class="n">greedy</span><span class="o">=</span><span class="n">greedy</span><span class="p">,</span>
                    <span class="n">max_new_tokens</span><span class="o">=</span><span class="n">max_new_tokens</span><span class="p">,</span>
            <span class="p">):</span>
                <span class="k">pass</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">response</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
            <span class="k">for</span> <span class="n">response</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">process</span><span class="p">(</span>
                    <span class="n">string</span><span class="o">=</span><span class="n">string</span><span class="p">,</span>
                    <span class="n">greedy</span><span class="o">=</span><span class="n">greedy</span><span class="p">,</span>
                    <span class="n">max_new_tokens</span><span class="o">=</span><span class="n">max_new_tokens</span><span class="p">,</span>
                    <span class="n">stream</span><span class="o">=</span><span class="kc">True</span>
            <span class="p">):</span>
                <span class="k">yield</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">response</span>
        <span class="k">return</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">response</span>

    <span class="k">def</span> <span class="nf">create_gradio_ui_chat</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The create_gradio_ui_chat function creates a Gradio UI for the chatbot.</span>

<span class="sd">        :param self: Represent the instance of the class</span>
<span class="sd">        :return: A block</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">gr</span><span class="o">.</span><span class="n">Blocks</span><span class="p">(</span>
                <span class="n">theme</span><span class="o">=</span><span class="n">seafoam</span><span class="p">)</span> <span class="k">as</span> <span class="n">block</span><span class="p">:</span>
            <span class="n">gr</span><span class="o">.</span><span class="n">Markdown</span><span class="p">(</span><span class="s2">&quot;# &lt;h1&gt; &lt;center&gt;Powered by [EasyDeL](https://github.com/erfanzar/EasyDel) &lt;/center&gt; &lt;/h1&gt;&quot;</span><span class="p">)</span>
            <span class="k">with</span> <span class="n">gr</span><span class="o">.</span><span class="n">Row</span><span class="p">():</span>
                <span class="n">history</span> <span class="o">=</span> <span class="n">gr</span><span class="o">.</span><span class="n">Chatbot</span><span class="p">(</span><span class="n">elem_id</span><span class="o">=</span><span class="s2">&quot;EasyDel&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;EasyDel&quot;</span><span class="p">,</span> <span class="n">container</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">600</span><span class="p">)</span>

            <span class="k">with</span> <span class="n">gr</span><span class="o">.</span><span class="n">Row</span><span class="p">():</span>
                <span class="k">with</span> <span class="n">gr</span><span class="o">.</span><span class="n">Column</span><span class="p">():</span>
                    <span class="n">prompt</span> <span class="o">=</span> <span class="n">gr</span><span class="o">.</span><span class="n">Textbox</span><span class="p">(</span><span class="n">show_label</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">placeholder</span><span class="o">=</span><span class="s1">&#39;Message Box&#39;</span><span class="p">,</span> <span class="n">container</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                <span class="k">with</span> <span class="n">gr</span><span class="o">.</span><span class="n">Column</span><span class="p">():</span>
                    <span class="k">with</span> <span class="n">gr</span><span class="o">.</span><span class="n">Row</span><span class="p">():</span>
                        <span class="n">submit</span> <span class="o">=</span> <span class="n">gr</span><span class="o">.</span><span class="n">Button</span><span class="p">(</span><span class="n">variant</span><span class="o">=</span><span class="s2">&quot;primary&quot;</span><span class="p">)</span>
                        <span class="n">stop</span> <span class="o">=</span> <span class="n">gr</span><span class="o">.</span><span class="n">Button</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="s1">&#39;Stop &#39;</span><span class="p">)</span>
                        <span class="n">clear</span> <span class="o">=</span> <span class="n">gr</span><span class="o">.</span><span class="n">Button</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="s1">&#39;Clear Conversation&#39;</span><span class="p">)</span>

            <span class="k">with</span> <span class="n">gr</span><span class="o">.</span><span class="n">Row</span><span class="p">():</span>
                <span class="k">with</span> <span class="n">gr</span><span class="o">.</span><span class="n">Accordion</span><span class="p">(</span><span class="s1">&#39;Advanced Options&#39;</span><span class="p">,</span> <span class="nb">open</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
                    <span class="n">max_new_tokens</span> <span class="o">=</span> <span class="n">gr</span><span class="o">.</span><span class="n">Slider</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">max_new_tokens</span><span class="p">,</span> <span class="n">maximum</span><span class="o">=</span><span class="mi">10000</span><span class="p">,</span>
                                               <span class="n">minimum</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">max_stream_tokens</span><span class="p">,</span>
                                               <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Max New Tokens&#39;</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">max_stream_tokens</span><span class="p">,</span> <span class="p">)</span>

                    <span class="n">system</span> <span class="o">=</span> <span class="n">gr</span><span class="o">.</span><span class="n">Textbox</span><span class="p">(</span><span class="n">show_label</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">placeholder</span><span class="o">=</span><span class="s1">&#39;System Prompt&#39;</span><span class="p">,</span> <span class="n">container</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
                    <span class="n">greedy</span> <span class="o">=</span> <span class="n">gr</span><span class="o">.</span><span class="n">Checkbox</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Greedy Search&#39;</span><span class="p">)</span>

            <span class="n">inputs</span> <span class="o">=</span> <span class="p">[</span><span class="n">prompt</span><span class="p">,</span> <span class="n">history</span><span class="p">,</span> <span class="n">max_new_tokens</span><span class="p">,</span> <span class="n">system</span><span class="p">,</span> <span class="n">greedy</span><span class="p">]</span>
            <span class="n">sub_event</span> <span class="o">=</span> <span class="n">submit</span><span class="o">.</span><span class="n">click</span><span class="p">(</span><span class="n">fn</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">process_gradio_chat</span><span class="p">,</span> <span class="n">inputs</span><span class="o">=</span><span class="n">inputs</span><span class="p">,</span> <span class="n">outputs</span><span class="o">=</span><span class="p">[</span><span class="n">prompt</span><span class="p">,</span> <span class="n">history</span><span class="p">])</span>

            <span class="k">def</span> <span class="nf">clear_</span><span class="p">():</span>
                <span class="k">return</span> <span class="p">[]</span>

            <span class="n">clear</span><span class="o">.</span><span class="n">click</span><span class="p">(</span><span class="n">fn</span><span class="o">=</span><span class="n">clear_</span><span class="p">,</span> <span class="n">outputs</span><span class="o">=</span><span class="p">[</span><span class="n">history</span><span class="p">])</span>
            <span class="n">txt_event</span> <span class="o">=</span> <span class="n">prompt</span><span class="o">.</span><span class="n">submit</span><span class="p">(</span><span class="n">fn</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">process_gradio_chat</span><span class="p">,</span> <span class="n">inputs</span><span class="o">=</span><span class="n">inputs</span><span class="p">,</span> <span class="n">outputs</span><span class="o">=</span><span class="p">[</span><span class="n">prompt</span><span class="p">,</span> <span class="n">history</span><span class="p">])</span>

            <span class="n">stop</span><span class="o">.</span><span class="n">click</span><span class="p">(</span><span class="n">fn</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">inputs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">outputs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">cancels</span><span class="o">=</span><span class="p">[</span><span class="n">txt_event</span><span class="p">,</span> <span class="n">sub_event</span><span class="p">])</span>

        <span class="n">block</span><span class="o">.</span><span class="n">queue</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">block</span>

    <span class="k">def</span> <span class="nf">create_gradio_ui_instruct</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The create_gradio_ui_instruct function creates a Gradio UI for the EasyDeL model.</span>
<span class="sd">        The function takes in an instance of the EasyDeL class and returns a Gradio UI object.</span>


<span class="sd">        :param self: Represent the instance of the class</span>
<span class="sd">        :return: A block</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">gr</span><span class="o">.</span><span class="n">Blocks</span><span class="p">(</span>
                <span class="n">theme</span><span class="o">=</span><span class="n">seafoam</span><span class="p">)</span> <span class="k">as</span> <span class="n">block</span><span class="p">:</span>
            <span class="n">gr</span><span class="o">.</span><span class="n">Markdown</span><span class="p">(</span><span class="s2">&quot;# &lt;h1&gt; &lt;center&gt;Powered by [EasyDeL](https://github.com/erfanzar/EasyDel) &lt;/center&gt; &lt;/h1&gt;&quot;</span><span class="p">)</span>
            <span class="k">with</span> <span class="n">gr</span><span class="o">.</span><span class="n">Row</span><span class="p">():</span>
                <span class="n">pred</span> <span class="o">=</span> <span class="n">gr</span><span class="o">.</span><span class="n">TextArea</span><span class="p">(</span><span class="n">elem_id</span><span class="o">=</span><span class="s2">&quot;EasyDel&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;EasyDel&quot;</span><span class="p">,</span> <span class="n">container</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

            <span class="k">with</span> <span class="n">gr</span><span class="o">.</span><span class="n">Row</span><span class="p">():</span>
                <span class="n">submit</span> <span class="o">=</span> <span class="n">gr</span><span class="o">.</span><span class="n">Button</span><span class="p">(</span><span class="n">variant</span><span class="o">=</span><span class="s2">&quot;primary&quot;</span><span class="p">)</span>
                <span class="n">stop</span> <span class="o">=</span> <span class="n">gr</span><span class="o">.</span><span class="n">Button</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="s1">&#39;Stop &#39;</span><span class="p">)</span>
                <span class="n">clear</span> <span class="o">=</span> <span class="n">gr</span><span class="o">.</span><span class="n">Button</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="s1">&#39;Clear Conversation&#39;</span><span class="p">)</span>
            <span class="k">with</span> <span class="n">gr</span><span class="o">.</span><span class="n">Column</span><span class="p">():</span>
                <span class="n">prompt</span> <span class="o">=</span> <span class="n">gr</span><span class="o">.</span><span class="n">Textbox</span><span class="p">(</span><span class="n">show_label</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">placeholder</span><span class="o">=</span><span class="s1">&#39;Instruct Message&#39;</span><span class="p">,</span> <span class="n">container</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

            <span class="k">with</span> <span class="n">gr</span><span class="o">.</span><span class="n">Row</span><span class="p">():</span>
                <span class="k">with</span> <span class="n">gr</span><span class="o">.</span><span class="n">Accordion</span><span class="p">(</span><span class="s1">&#39;Advanced Options&#39;</span><span class="p">,</span> <span class="nb">open</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
                    <span class="n">system</span> <span class="o">=</span> <span class="n">gr</span><span class="o">.</span><span class="n">Textbox</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span>
                                        <span class="n">show_label</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">placeholder</span><span class="o">=</span><span class="s1">&#39;System Message&#39;</span><span class="p">,</span> <span class="n">container</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                    <span class="n">max_new_tokens</span> <span class="o">=</span> <span class="n">gr</span><span class="o">.</span><span class="n">Slider</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">max_new_tokens</span><span class="p">,</span> <span class="n">maximum</span><span class="o">=</span><span class="mi">10000</span><span class="p">,</span>
                                               <span class="n">minimum</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">max_stream_tokens</span><span class="p">,</span>
                                               <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Max New Tokens&#39;</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">max_stream_tokens</span><span class="p">,</span> <span class="p">)</span>

                    <span class="n">greedy</span> <span class="o">=</span> <span class="n">gr</span><span class="o">.</span><span class="n">Checkbox</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Greedy Search&#39;</span><span class="p">)</span>

            <span class="n">inputs</span> <span class="o">=</span> <span class="p">[</span><span class="n">prompt</span><span class="p">,</span> <span class="n">system</span><span class="p">,</span> <span class="n">max_new_tokens</span><span class="p">,</span> <span class="n">greedy</span><span class="p">]</span>
            <span class="n">sub_event</span> <span class="o">=</span> <span class="n">submit</span><span class="o">.</span><span class="n">click</span><span class="p">(</span><span class="n">fn</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">process_gradio_instruct</span><span class="p">,</span> <span class="n">inputs</span><span class="o">=</span><span class="n">inputs</span><span class="p">,</span> <span class="n">outputs</span><span class="o">=</span><span class="p">[</span><span class="n">prompt</span><span class="p">,</span> <span class="n">pred</span><span class="p">])</span>

            <span class="k">def</span> <span class="nf">clear_</span><span class="p">():</span>
                <span class="k">return</span> <span class="s1">&#39;&#39;</span>

            <span class="n">clear</span><span class="o">.</span><span class="n">click</span><span class="p">(</span><span class="n">fn</span><span class="o">=</span><span class="n">clear_</span><span class="p">,</span> <span class="n">outputs</span><span class="o">=</span><span class="p">[</span><span class="n">pred</span><span class="p">])</span>
            <span class="n">txt_event</span> <span class="o">=</span> <span class="n">prompt</span><span class="o">.</span><span class="n">submit</span><span class="p">(</span><span class="n">fn</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">process_gradio_instruct</span><span class="p">,</span> <span class="n">inputs</span><span class="o">=</span><span class="n">inputs</span><span class="p">,</span> <span class="n">outputs</span><span class="o">=</span><span class="p">[</span><span class="n">prompt</span><span class="p">,</span> <span class="n">pred</span><span class="p">])</span>

            <span class="n">stop</span><span class="o">.</span><span class="n">click</span><span class="p">(</span><span class="n">fn</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">inputs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">outputs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">cancels</span><span class="o">=</span><span class="p">[</span><span class="n">txt_event</span><span class="p">,</span> <span class="n">sub_event</span><span class="p">])</span>

        <span class="n">block</span><span class="o">.</span><span class="n">queue</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">block</span>

    <span class="k">def</span> <span class="nf">fire</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The fire function is a wrapper around the uvicorn.run function that allows you to run your model in a separate process</span>
<span class="sd">        from the main one. This is useful for running models on GPUs, as it prevents any other processes from using them while</span>
<span class="sd">        the model is being served.</span>

<span class="sd">        :param self: Refer to the instance of the class</span>
<span class="sd">        :return: A process, which is a child of the main process</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">_funcs_generated</span><span class="p">,</span> <span class="s1">&#39;you have to first add your model and parameters into server before using fire &#39;</span> \
                                      <span class="s1">&#39;with using ``configure_generate_functions``&#39;</span>

        <span class="k">def</span> <span class="nf">run</span><span class="p">():</span>
            <span class="n">uvicorn</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="p">,</span> <span class="n">host</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">host</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">port</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">process_uvicorn</span> <span class="o">=</span> <span class="n">mp</span><span class="o">.</span><span class="n">Process</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">run</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">process_uvicorn</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">end</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The end function is used to stop the server.</span>
<span class="sd">            It will wait for the process to end before returning.</span>

<span class="sd">        :param self: Represent the instance of the class</span>
<span class="sd">        :return: The process_uvicorn</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">process_uvicorn</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">process_uvicorn</span><span class="o">.</span><span class="n">join</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;you have to fire server before ending that this command will be ignored&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">launch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
               <span class="n">share_chat</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
               <span class="n">share_inst</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
               <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The launch function is a wrapper for the launch function of the gradio.Interface class.</span>
<span class="sd">        It takes two boolean arguments: share_chat and share_inst, which are used to determine whether to</span>
<span class="sd">        share the chatbot interface and/or instruction interface respectively. If both are set to False, then neither</span>
<span class="sd">        interface will be shared (this is useful if you want to run your app locally). If one or both of them are True,</span>
<span class="sd">        then they will be shared on Gradio&#39;s servers with a unique URL that can be accessed by anyone in order for them</span>
<span class="sd">        to interact with your app.</span>

<span class="sd">        :param self: Represent the instance of the class</span>
<span class="sd">        :param share_chat: bool: Determine if the chatbot should be shared</span>
<span class="sd">        :param share_inst: bool: Share the instructions for the app</span>
<span class="sd">        :return: A dictionary with the share urls for chat and instructions</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">share_kwargs</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">assert</span> <span class="ow">not</span> <span class="n">share_chat</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">share_inst</span><span class="p">,</span> <span class="s1">&#39;you have to pass at least one of sharing options True&#39;</span>
        <span class="k">if</span> <span class="n">share_chat</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">gradio_app_chat</span><span class="o">.</span><span class="n">launch</span><span class="p">(</span><span class="n">share</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">share_kwargs</span><span class="p">[</span><span class="s1">&#39;chat&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gradio_app_chat</span><span class="o">.</span><span class="n">share_url</span>
        <span class="k">if</span> <span class="n">share_inst</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">gradio_app_instruct</span><span class="o">.</span><span class="n">launch</span><span class="p">(</span><span class="n">share</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">share_kwargs</span><span class="p">[</span><span class="s1">&#39;inst&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gradio_app_instruct</span><span class="o">.</span><span class="n">share_url</span>
        <span class="k">return</span> <span class="n">share_kwargs</span>
</code></pre></div></td></tr></table></div>
            </details>

  

  <div class="doc doc-children">










<div class="doc doc-object doc-function">




<h3 id="lib.python.EasyDel.serve.jax_serve.JAXServer.__init__" class="doc doc-heading">
          <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">config</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>The <strong>init</strong> function is called when the class is instantiated.
It sets up all the attributes that will be used by other methods in the class.</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>self</code></td>
          <td>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Refer to the current instance of a class</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>config</code></td>
          <td>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Pass the jaxserverconfig object</p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
          </td>
          <td>
            <div class="doc-md-description">
              <p>A fastapi object</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>lib/python/EasyDel/serve/jax_serve.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>

<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The __init__ function is called when the class is instantiated.</span>
<span class="sd">    It sets up all the attributes that will be used by other methods in the class.</span>


<span class="sd">    :param self: Refer to the current instance of a class</span>
<span class="sd">    :param config: Pass the jaxserverconfig object</span>
<span class="sd">    :return: A fastapi object</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">process_uvicorn</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">prefix_tokenizer</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">tokenizer</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">,</span> \
        <span class="bp">self</span><span class="o">.</span><span class="n">rules</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_generate</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_greedy_generate</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="mi">8</span>
    <span class="k">assert</span> <span class="n">config</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="n">JaxServerConfig</span><span class="p">),</span> <span class="s1">&#39;config can be None or JaxServerConfig Type&#39;</span>
    <span class="k">if</span> <span class="n">config</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">config</span> <span class="o">=</span> <span class="n">JaxServerConfig</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">config</span> <span class="o">=</span> <span class="n">config</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_funcs_generated</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">number_of_served_request_until_last_up_time</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">rng_generator</span> <span class="o">=</span> <span class="n">RNG</span><span class="p">(</span><span class="mi">42</span><span class="p">)</span>
    <span class="n">initialise_tracking</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>
    <span class="n">array</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">jax</span><span class="o">.</span><span class="n">devices</span><span class="p">()),</span> <span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">mesh_axes_shape</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">mesh</span> <span class="o">=</span> <span class="n">Mesh</span><span class="p">(</span><span class="n">mesh_utils</span><span class="o">.</span><span class="n">create_device_mesh</span><span class="p">(</span><span class="n">array</span><span class="o">.</span><span class="n">shape</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">mesh_axes_names</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">app</span> <span class="o">=</span> <span class="n">FastAPI</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s1">&#39;/chat&#39;</span><span class="p">)(</span><span class="bp">self</span><span class="o">.</span><span class="n">forward_chat</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s1">&#39;/instruct&#39;</span><span class="p">)(</span><span class="bp">self</span><span class="o">.</span><span class="n">forward_instruct</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;/status&#39;</span><span class="p">)(</span><span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">gradio_app_chat</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_gradio_ui_chat</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">gradio_app_instruct</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_gradio_ui_instruct</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">app</span> <span class="o">=</span> <span class="n">gr</span><span class="o">.</span><span class="n">mount_gradio_app</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">gradio_app_chat</span><span class="p">,</span> <span class="s1">&#39;/gradio_chat&#39;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">app</span> <span class="o">=</span> <span class="n">gr</span><span class="o">.</span><span class="n">mount_gradio_app</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">gradio_app_instruct</span><span class="p">,</span> <span class="s1">&#39;/gradio_instruct&#39;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h3 id="lib.python.EasyDel.serve.jax_serve.JAXServer.auto_configure" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">auto_configure</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">tokenizer</span><span class="p">,</span> <span class="n">partition_rules</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>The auto_configure function is a helper function that will automatically configure the model for distributed training.
It does this by:
    1) sharding the parameters of the model based on partition_rules, and then
    2) configuring generate functions to be used in distributed training.</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>self</code></td>
          <td>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Represent the instance of the class</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>model</code></td>
          <td>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Configure the model</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>params</code></td>
          <td>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Store the parameters that are used to configure the model</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>tokenizer</code></td>
          <td>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Tokenize the input text</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>partition_rules</code></td>
          <td>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Specify how the parameters should be partitioned</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
          </td>
          <td>
            <div class="doc-md-description">
              <p>A dictionary with the following keys:</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>lib/python/EasyDel/serve/jax_serve.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">auto_configure</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">tokenizer</span><span class="p">,</span> <span class="n">partition_rules</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The auto_configure function is a helper function that will automatically configure the model for distributed training.</span>
<span class="sd">    It does this by:</span>
<span class="sd">        1) sharding the parameters of the model based on partition_rules, and then</span>
<span class="sd">        2) configuring generate functions to be used in distributed training.</span>

<span class="sd">    :param self: Represent the instance of the class</span>
<span class="sd">    :param model: Configure the model</span>
<span class="sd">    :param params: Store the parameters that are used to configure the model</span>
<span class="sd">    :param tokenizer: Tokenize the input text</span>
<span class="sd">    :param partition_rules: Specify how the parameters should be partitioned</span>
<span class="sd">    :return: A dictionary with the following keys:</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">shard_params</span><span class="p">(</span><span class="n">params</span><span class="o">=</span><span class="n">params</span><span class="p">,</span> <span class="n">partition_rules</span><span class="o">=</span><span class="n">partition_rules</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">configure_generate_functions</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">tokenizer</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h3 id="lib.python.EasyDel.serve.jax_serve.JAXServer.compile" class="doc doc-heading">
          <code class="highlight language-python"><span class="nb">compile</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>The compile function is used to compile the model for use in inference.
It does this by running through all possible combinations of rules and actions,
and compiling them into functions that can be called later on during inference.
This allows us to avoid having to recompile the model every time we want to run it,
which would be very slow.</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>self</code></td>
          <td>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Represent the instance of the class</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>verbose</code></td>
          <td>
                <code>bool</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>bool: Print out the compiling process</p>
            </div>
          </td>
          <td>
                <code>True</code>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code>bool</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>True, but what does it do?</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>lib/python/EasyDel/serve/jax_serve.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">compile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The compile function is used to compile the model for use in inference.</span>
<span class="sd">    It does this by running through all possible combinations of rules and actions,</span>
<span class="sd">    and compiling them into functions that can be called later on during inference.</span>
<span class="sd">    This allows us to avoid having to recompile the model every time we want to run it,</span>
<span class="sd">    which would be very slow.</span>

<span class="sd">    :param self: Represent the instance of the class</span>
<span class="sd">    :param verbose: bool: Print out the compiling process</span>
<span class="sd">    :return: True, but what does it do?</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">_funcs_generated</span><span class="p">,</span> <span class="s1">&#39;funcs are not generated yet&#39;</span>
    <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">rules</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;rules should not be None&#39;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">use_prefix_tokenizer</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\033</span><span class="s1">[1;91mCompiling Model Forwards Greedy/NonGreedy(Generate)&#39;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Compiling Greedy Funcs&#39;</span><span class="p">)</span>

        <span class="n">r</span><span class="p">,</span> <span class="n">a</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="mi">2</span>
        <span class="k">for</span> <span class="n">r</span><span class="p">,</span> <span class="n">a</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">process</span><span class="p">(</span>
                <span class="n">string</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span>
                <span class="n">max_new_tokens</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">max_stream_tokens</span><span class="p">,</span>
                <span class="n">greedy</span><span class="o">=</span><span class="kc">True</span>
        <span class="p">):</span>
            <span class="o">...</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Compiling NonGreedy(Generate) Funcs</span><span class="se">\033</span><span class="s1">[1;0m&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">r</span><span class="p">,</span> <span class="n">a</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">process</span><span class="p">(</span>
                <span class="n">string</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span>
                <span class="n">max_new_tokens</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">max_stream_tokens</span><span class="p">,</span>
                <span class="n">greedy</span><span class="o">=</span><span class="kc">False</span>
        <span class="p">):</span>
            <span class="o">...</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span>
            <span class="s1">&#39;</span><span class="se">\033</span><span class="s1">[1;91mSkip Compiling the compiling process is useless &#39;</span>
            <span class="s1">&#39;when you are not using prefix tokenizer</span><span class="se">\033</span><span class="s1">[1;0m&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="kc">True</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h3 id="lib.python.EasyDel.serve.jax_serve.JAXServer.configure_generate_functions" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">configure_generate_functions</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">tokenizer</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>The configure_generate_functions function is used to configure the generation functions for a given model.</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>self</code></td>
          <td>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Access variables within the class</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>model</code></td>
          <td>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Generate the model</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>tokenizer</code></td>
          <td>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Get the eos_token_id, pad_token_id and bos token id</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
          </td>
          <td>
            <div class="doc-md-description">
              <p>A function that takes in three parameters:</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>lib/python/EasyDel/serve/jax_serve.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">configure_generate_functions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">tokenizer</span><span class="p">):</span>

<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The configure_generate_functions function is used to configure the generation functions for a given model.</span>

<span class="sd">    :param self: Access variables within the class</span>
<span class="sd">    :param model: Generate the model</span>
<span class="sd">    :param tokenizer: Get the eos_token_id, pad_token_id and bos token id</span>
<span class="sd">    :return: A function that takes in three parameters:</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">rules</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;you should first shard params with using ``shard_params`` method&#39;</span>

    <span class="k">if</span> <span class="n">tokenizer</span><span class="o">.</span><span class="n">pad_token</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
            <span class="s1">&#39;Tokenizer does not contain padding token setting padding token to eos token for open end generation&#39;</span><span class="p">)</span>
        <span class="n">tokenizer</span><span class="o">.</span><span class="n">pad_token</span> <span class="o">=</span> <span class="n">tokenizer</span><span class="o">.</span><span class="n">eos_token</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">tokenizer</span><span class="o">.</span><span class="n">padding_side</span> <span class="o">=</span> <span class="s1">&#39;left&#39;</span>
        <span class="n">tokenizer</span><span class="o">.</span><span class="n">truncation_side</span> <span class="o">=</span> <span class="s1">&#39;left&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prefix_tokenizer</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">tokenizer</span><span class="p">)</span>
        <span class="n">tokenizer</span><span class="o">.</span><span class="n">padding_side</span> <span class="o">=</span> <span class="s1">&#39;right&#39;</span>
        <span class="n">tokenizer</span><span class="o">.</span><span class="n">truncation_side</span> <span class="o">=</span> <span class="s1">&#39;right&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tokenizer</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">tokenizer</span><span class="p">)</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="n">prefix_str</span><span class="p">(</span>
            <span class="s1">&#39;Warning&#39;</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;The class Model of Tokenizer </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">tokenizer</span><span class="p">)</span><span class="si">}</span><span class="s1"> do not support deepcopy option &#39;</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">use_prefix_tokenizer</span><span class="p">:</span>
            <span class="n">tokenizer</span><span class="o">.</span><span class="n">padding_side</span> <span class="o">=</span> <span class="s1">&#39;left&#39;</span>
            <span class="n">tokenizer</span><span class="o">.</span><span class="n">truncation_side</span> <span class="o">=</span> <span class="s1">&#39;left&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">tokenizer</span><span class="o">.</span><span class="n">padding_side</span> <span class="o">=</span> <span class="s1">&#39;right&#39;</span>
            <span class="n">tokenizer</span><span class="o">.</span><span class="n">truncation_side</span> <span class="o">=</span> <span class="s1">&#39;right&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prefix_tokenizer</span> <span class="o">=</span> <span class="n">tokenizer</span>

    <span class="nd">@functools</span><span class="o">.</span><span class="n">partial</span><span class="p">(</span>
        <span class="n">pjit</span><span class="p">,</span>
        <span class="n">in_shardings</span><span class="o">=</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rules</span><span class="p">,</span> <span class="n">Ps</span><span class="p">(),</span> <span class="n">Ps</span><span class="p">()),</span>
        <span class="n">out_shardings</span><span class="o">=</span><span class="p">(</span><span class="n">Ps</span><span class="p">())</span>
    <span class="p">)</span>
    <span class="k">def</span> <span class="nf">greedy_generate</span><span class="p">(</span><span class="n">parameters</span><span class="p">,</span> <span class="n">input_ids</span><span class="p">,</span> <span class="n">attention_mask</span><span class="p">):</span>
        <span class="n">input_ids</span> <span class="o">=</span> <span class="n">with_sharding_constraint</span><span class="p">(</span><span class="n">input_ids</span><span class="p">,</span> <span class="n">Ps</span><span class="p">((</span><span class="s1">&#39;dp&#39;</span><span class="p">,</span> <span class="s1">&#39;fsdp&#39;</span><span class="p">)))</span>
        <span class="n">attention_mask</span> <span class="o">=</span> <span class="n">with_sharding_constraint</span><span class="p">(</span><span class="n">attention_mask</span><span class="p">,</span> <span class="n">Ps</span><span class="p">((</span><span class="s1">&#39;dp&#39;</span><span class="p">,</span> <span class="s1">&#39;fsdp&#39;</span><span class="p">)))</span>
        <span class="n">predict</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">generate</span><span class="p">(</span>
            <span class="n">input_ids</span><span class="p">,</span>
            <span class="n">attention_mask</span><span class="o">=</span><span class="n">attention_mask</span><span class="p">,</span>
            <span class="n">params</span><span class="o">=</span><span class="n">parameters</span><span class="p">,</span>
            <span class="n">generation_config</span><span class="o">=</span><span class="n">GenerationConfig</span><span class="p">(</span>
                <span class="n">max_new_tokens</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">max_stream_tokens</span><span class="p">,</span>
                <span class="n">eos_token_id</span><span class="o">=</span><span class="n">tokenizer</span><span class="o">.</span><span class="n">eos_token_id</span><span class="p">,</span>
                <span class="n">pad_token_id</span><span class="o">=</span><span class="n">tokenizer</span><span class="o">.</span><span class="n">pad_token_id</span><span class="p">,</span>
                <span class="n">bos_token_id</span><span class="o">=</span><span class="n">tokenizer</span><span class="o">.</span><span class="n">bos_token_id</span><span class="p">,</span>

                <span class="n">do_sample</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">num_beams</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="p">)</span><span class="o">.</span><span class="n">sequences</span><span class="p">[:,</span> <span class="n">input_ids</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]:]</span>
        <span class="k">return</span> <span class="n">predict</span>

    <span class="nd">@functools</span><span class="o">.</span><span class="n">partial</span><span class="p">(</span>
        <span class="n">pjit</span><span class="p">,</span>
        <span class="n">in_shardings</span><span class="o">=</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rules</span><span class="p">,</span> <span class="n">Ps</span><span class="p">(),</span> <span class="n">Ps</span><span class="p">()),</span>
        <span class="n">out_shardings</span><span class="o">=</span><span class="p">(</span><span class="n">Ps</span><span class="p">())</span>
    <span class="p">)</span>
    <span class="k">def</span> <span class="nf">generate</span><span class="p">(</span><span class="n">parameters</span><span class="p">,</span> <span class="n">input_ids</span><span class="p">,</span> <span class="n">attention_mask</span><span class="p">):</span>
        <span class="n">input_ids</span> <span class="o">=</span> <span class="n">with_sharding_constraint</span><span class="p">(</span><span class="n">input_ids</span><span class="p">,</span> <span class="n">Ps</span><span class="p">((</span><span class="s1">&#39;dp&#39;</span><span class="p">,</span> <span class="s1">&#39;fsdp&#39;</span><span class="p">)))</span>
        <span class="n">attention_mask</span> <span class="o">=</span> <span class="n">with_sharding_constraint</span><span class="p">(</span><span class="n">attention_mask</span><span class="p">,</span> <span class="n">Ps</span><span class="p">((</span><span class="s1">&#39;dp&#39;</span><span class="p">,</span> <span class="s1">&#39;fsdp&#39;</span><span class="p">)))</span>
        <span class="n">predict</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">generate</span><span class="p">(</span>
            <span class="n">input_ids</span><span class="p">,</span>
            <span class="n">attention_mask</span><span class="o">=</span><span class="n">attention_mask</span><span class="p">,</span>
            <span class="n">params</span><span class="o">=</span><span class="n">parameters</span><span class="p">,</span>
            <span class="n">generation_config</span><span class="o">=</span><span class="n">GenerationConfig</span><span class="p">(</span>
                <span class="n">max_new_tokens</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">max_stream_tokens</span><span class="p">,</span>

                <span class="n">eos_token_id</span><span class="o">=</span><span class="n">tokenizer</span><span class="o">.</span><span class="n">eos_token_id</span><span class="p">,</span>
                <span class="n">pad_token_id</span><span class="o">=</span><span class="n">tokenizer</span><span class="o">.</span><span class="n">pad_token_id</span><span class="p">,</span>
                <span class="n">bos_token_id</span><span class="o">=</span><span class="n">tokenizer</span><span class="o">.</span><span class="n">bos_token_id</span><span class="p">,</span>

                <span class="n">temperature</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">temperature</span><span class="p">,</span>
                <span class="n">do_sample</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">num_beams</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                <span class="n">top_p</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">top_p</span><span class="p">,</span>
                <span class="n">top_k</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">top_k</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="p">)</span><span class="o">.</span><span class="n">sequences</span><span class="p">[:,</span> <span class="n">input_ids</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]:]</span>
        <span class="k">return</span> <span class="n">predict</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_generate</span> <span class="o">=</span> <span class="n">generate</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_greedy_generate</span> <span class="o">=</span> <span class="n">greedy_generate</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_funcs_generated</span> <span class="o">=</span> <span class="kc">True</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h3 id="lib.python.EasyDel.serve.jax_serve.JAXServer.create_gradio_ui_chat" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">create_gradio_ui_chat</span><span class="p">()</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>The create_gradio_ui_chat function creates a Gradio UI for the chatbot.</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>self</code></td>
          <td>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Represent the instance of the class</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
          </td>
          <td>
            <div class="doc-md-description">
              <p>A block</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>lib/python/EasyDel/serve/jax_serve.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">834</span>
<span class="normal">835</span>
<span class="normal">836</span>
<span class="normal">837</span>
<span class="normal">838</span>
<span class="normal">839</span>
<span class="normal">840</span>
<span class="normal">841</span>
<span class="normal">842</span>
<span class="normal">843</span>
<span class="normal">844</span>
<span class="normal">845</span>
<span class="normal">846</span>
<span class="normal">847</span>
<span class="normal">848</span>
<span class="normal">849</span>
<span class="normal">850</span>
<span class="normal">851</span>
<span class="normal">852</span>
<span class="normal">853</span>
<span class="normal">854</span>
<span class="normal">855</span>
<span class="normal">856</span>
<span class="normal">857</span>
<span class="normal">858</span>
<span class="normal">859</span>
<span class="normal">860</span>
<span class="normal">861</span>
<span class="normal">862</span>
<span class="normal">863</span>
<span class="normal">864</span>
<span class="normal">865</span>
<span class="normal">866</span>
<span class="normal">867</span>
<span class="normal">868</span>
<span class="normal">869</span>
<span class="normal">870</span>
<span class="normal">871</span>
<span class="normal">872</span>
<span class="normal">873</span>
<span class="normal">874</span>
<span class="normal">875</span>
<span class="normal">876</span>
<span class="normal">877</span>
<span class="normal">878</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">create_gradio_ui_chat</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The create_gradio_ui_chat function creates a Gradio UI for the chatbot.</span>

<span class="sd">    :param self: Represent the instance of the class</span>
<span class="sd">    :return: A block</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">with</span> <span class="n">gr</span><span class="o">.</span><span class="n">Blocks</span><span class="p">(</span>
            <span class="n">theme</span><span class="o">=</span><span class="n">seafoam</span><span class="p">)</span> <span class="k">as</span> <span class="n">block</span><span class="p">:</span>
        <span class="n">gr</span><span class="o">.</span><span class="n">Markdown</span><span class="p">(</span><span class="s2">&quot;# &lt;h1&gt; &lt;center&gt;Powered by [EasyDeL](https://github.com/erfanzar/EasyDel) &lt;/center&gt; &lt;/h1&gt;&quot;</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">gr</span><span class="o">.</span><span class="n">Row</span><span class="p">():</span>
            <span class="n">history</span> <span class="o">=</span> <span class="n">gr</span><span class="o">.</span><span class="n">Chatbot</span><span class="p">(</span><span class="n">elem_id</span><span class="o">=</span><span class="s2">&quot;EasyDel&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;EasyDel&quot;</span><span class="p">,</span> <span class="n">container</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">600</span><span class="p">)</span>

        <span class="k">with</span> <span class="n">gr</span><span class="o">.</span><span class="n">Row</span><span class="p">():</span>
            <span class="k">with</span> <span class="n">gr</span><span class="o">.</span><span class="n">Column</span><span class="p">():</span>
                <span class="n">prompt</span> <span class="o">=</span> <span class="n">gr</span><span class="o">.</span><span class="n">Textbox</span><span class="p">(</span><span class="n">show_label</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">placeholder</span><span class="o">=</span><span class="s1">&#39;Message Box&#39;</span><span class="p">,</span> <span class="n">container</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="k">with</span> <span class="n">gr</span><span class="o">.</span><span class="n">Column</span><span class="p">():</span>
                <span class="k">with</span> <span class="n">gr</span><span class="o">.</span><span class="n">Row</span><span class="p">():</span>
                    <span class="n">submit</span> <span class="o">=</span> <span class="n">gr</span><span class="o">.</span><span class="n">Button</span><span class="p">(</span><span class="n">variant</span><span class="o">=</span><span class="s2">&quot;primary&quot;</span><span class="p">)</span>
                    <span class="n">stop</span> <span class="o">=</span> <span class="n">gr</span><span class="o">.</span><span class="n">Button</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="s1">&#39;Stop &#39;</span><span class="p">)</span>
                    <span class="n">clear</span> <span class="o">=</span> <span class="n">gr</span><span class="o">.</span><span class="n">Button</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="s1">&#39;Clear Conversation&#39;</span><span class="p">)</span>

        <span class="k">with</span> <span class="n">gr</span><span class="o">.</span><span class="n">Row</span><span class="p">():</span>
            <span class="k">with</span> <span class="n">gr</span><span class="o">.</span><span class="n">Accordion</span><span class="p">(</span><span class="s1">&#39;Advanced Options&#39;</span><span class="p">,</span> <span class="nb">open</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
                <span class="n">max_new_tokens</span> <span class="o">=</span> <span class="n">gr</span><span class="o">.</span><span class="n">Slider</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">max_new_tokens</span><span class="p">,</span> <span class="n">maximum</span><span class="o">=</span><span class="mi">10000</span><span class="p">,</span>
                                           <span class="n">minimum</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">max_stream_tokens</span><span class="p">,</span>
                                           <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Max New Tokens&#39;</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">max_stream_tokens</span><span class="p">,</span> <span class="p">)</span>

                <span class="n">system</span> <span class="o">=</span> <span class="n">gr</span><span class="o">.</span><span class="n">Textbox</span><span class="p">(</span><span class="n">show_label</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">placeholder</span><span class="o">=</span><span class="s1">&#39;System Prompt&#39;</span><span class="p">,</span> <span class="n">container</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
                <span class="n">greedy</span> <span class="o">=</span> <span class="n">gr</span><span class="o">.</span><span class="n">Checkbox</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Greedy Search&#39;</span><span class="p">)</span>

        <span class="n">inputs</span> <span class="o">=</span> <span class="p">[</span><span class="n">prompt</span><span class="p">,</span> <span class="n">history</span><span class="p">,</span> <span class="n">max_new_tokens</span><span class="p">,</span> <span class="n">system</span><span class="p">,</span> <span class="n">greedy</span><span class="p">]</span>
        <span class="n">sub_event</span> <span class="o">=</span> <span class="n">submit</span><span class="o">.</span><span class="n">click</span><span class="p">(</span><span class="n">fn</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">process_gradio_chat</span><span class="p">,</span> <span class="n">inputs</span><span class="o">=</span><span class="n">inputs</span><span class="p">,</span> <span class="n">outputs</span><span class="o">=</span><span class="p">[</span><span class="n">prompt</span><span class="p">,</span> <span class="n">history</span><span class="p">])</span>

        <span class="k">def</span> <span class="nf">clear_</span><span class="p">():</span>
            <span class="k">return</span> <span class="p">[]</span>

        <span class="n">clear</span><span class="o">.</span><span class="n">click</span><span class="p">(</span><span class="n">fn</span><span class="o">=</span><span class="n">clear_</span><span class="p">,</span> <span class="n">outputs</span><span class="o">=</span><span class="p">[</span><span class="n">history</span><span class="p">])</span>
        <span class="n">txt_event</span> <span class="o">=</span> <span class="n">prompt</span><span class="o">.</span><span class="n">submit</span><span class="p">(</span><span class="n">fn</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">process_gradio_chat</span><span class="p">,</span> <span class="n">inputs</span><span class="o">=</span><span class="n">inputs</span><span class="p">,</span> <span class="n">outputs</span><span class="o">=</span><span class="p">[</span><span class="n">prompt</span><span class="p">,</span> <span class="n">history</span><span class="p">])</span>

        <span class="n">stop</span><span class="o">.</span><span class="n">click</span><span class="p">(</span><span class="n">fn</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">inputs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">outputs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">cancels</span><span class="o">=</span><span class="p">[</span><span class="n">txt_event</span><span class="p">,</span> <span class="n">sub_event</span><span class="p">])</span>

    <span class="n">block</span><span class="o">.</span><span class="n">queue</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">block</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h3 id="lib.python.EasyDel.serve.jax_serve.JAXServer.create_gradio_ui_instruct" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">create_gradio_ui_instruct</span><span class="p">()</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>The create_gradio_ui_instruct function creates a Gradio UI for the EasyDeL model.
The function takes in an instance of the EasyDeL class and returns a Gradio UI object.</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>self</code></td>
          <td>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Represent the instance of the class</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
          </td>
          <td>
            <div class="doc-md-description">
              <p>A block</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>lib/python/EasyDel/serve/jax_serve.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">880</span>
<span class="normal">881</span>
<span class="normal">882</span>
<span class="normal">883</span>
<span class="normal">884</span>
<span class="normal">885</span>
<span class="normal">886</span>
<span class="normal">887</span>
<span class="normal">888</span>
<span class="normal">889</span>
<span class="normal">890</span>
<span class="normal">891</span>
<span class="normal">892</span>
<span class="normal">893</span>
<span class="normal">894</span>
<span class="normal">895</span>
<span class="normal">896</span>
<span class="normal">897</span>
<span class="normal">898</span>
<span class="normal">899</span>
<span class="normal">900</span>
<span class="normal">901</span>
<span class="normal">902</span>
<span class="normal">903</span>
<span class="normal">904</span>
<span class="normal">905</span>
<span class="normal">906</span>
<span class="normal">907</span>
<span class="normal">908</span>
<span class="normal">909</span>
<span class="normal">910</span>
<span class="normal">911</span>
<span class="normal">912</span>
<span class="normal">913</span>
<span class="normal">914</span>
<span class="normal">915</span>
<span class="normal">916</span>
<span class="normal">917</span>
<span class="normal">918</span>
<span class="normal">919</span>
<span class="normal">920</span>
<span class="normal">921</span>
<span class="normal">922</span>
<span class="normal">923</span>
<span class="normal">924</span>
<span class="normal">925</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">create_gradio_ui_instruct</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The create_gradio_ui_instruct function creates a Gradio UI for the EasyDeL model.</span>
<span class="sd">    The function takes in an instance of the EasyDeL class and returns a Gradio UI object.</span>


<span class="sd">    :param self: Represent the instance of the class</span>
<span class="sd">    :return: A block</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">with</span> <span class="n">gr</span><span class="o">.</span><span class="n">Blocks</span><span class="p">(</span>
            <span class="n">theme</span><span class="o">=</span><span class="n">seafoam</span><span class="p">)</span> <span class="k">as</span> <span class="n">block</span><span class="p">:</span>
        <span class="n">gr</span><span class="o">.</span><span class="n">Markdown</span><span class="p">(</span><span class="s2">&quot;# &lt;h1&gt; &lt;center&gt;Powered by [EasyDeL](https://github.com/erfanzar/EasyDel) &lt;/center&gt; &lt;/h1&gt;&quot;</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">gr</span><span class="o">.</span><span class="n">Row</span><span class="p">():</span>
            <span class="n">pred</span> <span class="o">=</span> <span class="n">gr</span><span class="o">.</span><span class="n">TextArea</span><span class="p">(</span><span class="n">elem_id</span><span class="o">=</span><span class="s2">&quot;EasyDel&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;EasyDel&quot;</span><span class="p">,</span> <span class="n">container</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="k">with</span> <span class="n">gr</span><span class="o">.</span><span class="n">Row</span><span class="p">():</span>
            <span class="n">submit</span> <span class="o">=</span> <span class="n">gr</span><span class="o">.</span><span class="n">Button</span><span class="p">(</span><span class="n">variant</span><span class="o">=</span><span class="s2">&quot;primary&quot;</span><span class="p">)</span>
            <span class="n">stop</span> <span class="o">=</span> <span class="n">gr</span><span class="o">.</span><span class="n">Button</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="s1">&#39;Stop &#39;</span><span class="p">)</span>
            <span class="n">clear</span> <span class="o">=</span> <span class="n">gr</span><span class="o">.</span><span class="n">Button</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="s1">&#39;Clear Conversation&#39;</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">gr</span><span class="o">.</span><span class="n">Column</span><span class="p">():</span>
            <span class="n">prompt</span> <span class="o">=</span> <span class="n">gr</span><span class="o">.</span><span class="n">Textbox</span><span class="p">(</span><span class="n">show_label</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">placeholder</span><span class="o">=</span><span class="s1">&#39;Instruct Message&#39;</span><span class="p">,</span> <span class="n">container</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="k">with</span> <span class="n">gr</span><span class="o">.</span><span class="n">Row</span><span class="p">():</span>
            <span class="k">with</span> <span class="n">gr</span><span class="o">.</span><span class="n">Accordion</span><span class="p">(</span><span class="s1">&#39;Advanced Options&#39;</span><span class="p">,</span> <span class="nb">open</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
                <span class="n">system</span> <span class="o">=</span> <span class="n">gr</span><span class="o">.</span><span class="n">Textbox</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span>
                                    <span class="n">show_label</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">placeholder</span><span class="o">=</span><span class="s1">&#39;System Message&#39;</span><span class="p">,</span> <span class="n">container</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                <span class="n">max_new_tokens</span> <span class="o">=</span> <span class="n">gr</span><span class="o">.</span><span class="n">Slider</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">max_new_tokens</span><span class="p">,</span> <span class="n">maximum</span><span class="o">=</span><span class="mi">10000</span><span class="p">,</span>
                                           <span class="n">minimum</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">max_stream_tokens</span><span class="p">,</span>
                                           <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Max New Tokens&#39;</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">max_stream_tokens</span><span class="p">,</span> <span class="p">)</span>

                <span class="n">greedy</span> <span class="o">=</span> <span class="n">gr</span><span class="o">.</span><span class="n">Checkbox</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Greedy Search&#39;</span><span class="p">)</span>

        <span class="n">inputs</span> <span class="o">=</span> <span class="p">[</span><span class="n">prompt</span><span class="p">,</span> <span class="n">system</span><span class="p">,</span> <span class="n">max_new_tokens</span><span class="p">,</span> <span class="n">greedy</span><span class="p">]</span>
        <span class="n">sub_event</span> <span class="o">=</span> <span class="n">submit</span><span class="o">.</span><span class="n">click</span><span class="p">(</span><span class="n">fn</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">process_gradio_instruct</span><span class="p">,</span> <span class="n">inputs</span><span class="o">=</span><span class="n">inputs</span><span class="p">,</span> <span class="n">outputs</span><span class="o">=</span><span class="p">[</span><span class="n">prompt</span><span class="p">,</span> <span class="n">pred</span><span class="p">])</span>

        <span class="k">def</span> <span class="nf">clear_</span><span class="p">():</span>
            <span class="k">return</span> <span class="s1">&#39;&#39;</span>

        <span class="n">clear</span><span class="o">.</span><span class="n">click</span><span class="p">(</span><span class="n">fn</span><span class="o">=</span><span class="n">clear_</span><span class="p">,</span> <span class="n">outputs</span><span class="o">=</span><span class="p">[</span><span class="n">pred</span><span class="p">])</span>
        <span class="n">txt_event</span> <span class="o">=</span> <span class="n">prompt</span><span class="o">.</span><span class="n">submit</span><span class="p">(</span><span class="n">fn</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">process_gradio_instruct</span><span class="p">,</span> <span class="n">inputs</span><span class="o">=</span><span class="n">inputs</span><span class="p">,</span> <span class="n">outputs</span><span class="o">=</span><span class="p">[</span><span class="n">prompt</span><span class="p">,</span> <span class="n">pred</span><span class="p">])</span>

        <span class="n">stop</span><span class="o">.</span><span class="n">click</span><span class="p">(</span><span class="n">fn</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">inputs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">outputs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">cancels</span><span class="o">=</span><span class="p">[</span><span class="n">txt_event</span><span class="p">,</span> <span class="n">sub_event</span><span class="p">])</span>

    <span class="n">block</span><span class="o">.</span><span class="n">queue</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">block</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h3 id="lib.python.EasyDel.serve.jax_serve.JAXServer.end" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">end</span><span class="p">()</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>The end function is used to stop the server.
    It will wait for the process to end before returning.</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>self</code></td>
          <td>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Represent the instance of the class</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The process_uvicorn</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>lib/python/EasyDel/serve/jax_serve.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">946</span>
<span class="normal">947</span>
<span class="normal">948</span>
<span class="normal">949</span>
<span class="normal">950</span>
<span class="normal">951</span>
<span class="normal">952</span>
<span class="normal">953</span>
<span class="normal">954</span>
<span class="normal">955</span>
<span class="normal">956</span>
<span class="normal">957</span>
<span class="normal">958</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">end</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The end function is used to stop the server.</span>
<span class="sd">        It will wait for the process to end before returning.</span>

<span class="sd">    :param self: Represent the instance of the class</span>
<span class="sd">    :return: The process_uvicorn</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">process_uvicorn</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">process_uvicorn</span><span class="o">.</span><span class="n">join</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;you have to fire server before ending that this command will be ignored&#39;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h3 id="lib.python.EasyDel.serve.jax_serve.JAXServer.fire" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">fire</span><span class="p">()</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>The fire function is a wrapper around the uvicorn.run function that allows you to run your model in a separate process
from the main one. This is useful for running models on GPUs, as it prevents any other processes from using them while
the model is being served.</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>self</code></td>
          <td>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Refer to the instance of the class</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
          </td>
          <td>
            <div class="doc-md-description">
              <p>A process, which is a child of the main process</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>lib/python/EasyDel/serve/jax_serve.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">927</span>
<span class="normal">928</span>
<span class="normal">929</span>
<span class="normal">930</span>
<span class="normal">931</span>
<span class="normal">932</span>
<span class="normal">933</span>
<span class="normal">934</span>
<span class="normal">935</span>
<span class="normal">936</span>
<span class="normal">937</span>
<span class="normal">938</span>
<span class="normal">939</span>
<span class="normal">940</span>
<span class="normal">941</span>
<span class="normal">942</span>
<span class="normal">943</span>
<span class="normal">944</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">fire</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The fire function is a wrapper around the uvicorn.run function that allows you to run your model in a separate process</span>
<span class="sd">    from the main one. This is useful for running models on GPUs, as it prevents any other processes from using them while</span>
<span class="sd">    the model is being served.</span>

<span class="sd">    :param self: Refer to the instance of the class</span>
<span class="sd">    :return: A process, which is a child of the main process</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">_funcs_generated</span><span class="p">,</span> <span class="s1">&#39;you have to first add your model and parameters into server before using fire &#39;</span> \
                                  <span class="s1">&#39;with using ``configure_generate_functions``&#39;</span>

    <span class="k">def</span> <span class="nf">run</span><span class="p">():</span>
        <span class="n">uvicorn</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="p">,</span> <span class="n">host</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">host</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">port</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">process_uvicorn</span> <span class="o">=</span> <span class="n">mp</span><span class="o">.</span><span class="n">Process</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">run</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">process_uvicorn</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h3 id="lib.python.EasyDel.serve.jax_serve.JAXServer.format_chat" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">format_chat</span><span class="p">(</span><span class="n">history</span><span class="p">,</span> <span class="n">prompt</span><span class="p">,</span> <span class="n">system</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

</h3>


  <div class="doc doc-contents ">
  
      <p>Here you will get the system, prompt and history from user, and you can apply your prompting style</p>

          <details class="quote">
            <summary>Source code in <code>lib/python/EasyDel/serve/jax_serve.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span> <span class="nf">format_chat</span><span class="p">(</span><span class="n">history</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">prompt</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">system</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="kc">None</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Here you will get the system, prompt and history from user, and you can apply your prompting style</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h3 id="lib.python.EasyDel.serve.jax_serve.JAXServer.format_instruct" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">format_instruct</span><span class="p">(</span><span class="n">system</span><span class="p">,</span> <span class="n">instruction</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

</h3>


  <div class="doc doc-contents ">
  
      <p>Here you will get the system and instruction from user, and you can apply your prompting style</p>

          <details class="quote">
            <summary>Source code in <code>lib/python/EasyDel/serve/jax_serve.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span> <span class="nf">format_instruct</span><span class="p">(</span><span class="n">system</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">instruction</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Here you will get the system and instruction from user, and you can apply your prompting style</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h3 id="lib.python.EasyDel.serve.jax_serve.JAXServer.forward_chat" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">forward_chat</span><span class="p">(</span><span class="n">data</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>The forward_chat function is the main function of this class.
It takes in a ChatRequest object, which contains a prompt and history.
The prompt is the user's input to be processed by the chatbot, while history
is an array of previous inputs and outputs from both sides (user and bot).
The forward_chat function then formats these inputs into one string that can be processed by our model.
This formatted string is then passed through our process() method, which returns an output response as well as how many tokens were used to generate it.</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>self</code></td>
          <td>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Access the attributes and methods of the class</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>data</code></td>
          <td>
                <code><span title="lib.python.EasyDel.serve.utils.ChatRequest">ChatRequest</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>ChatRequest: Pass in the data from the request</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
          </td>
          <td>
            <div class="doc-md-description">
              <p>A dictionary with the following keys:</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>lib/python/EasyDel/serve/jax_serve.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">forward_chat</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">ChatRequest</span><span class="p">):</span>

<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The forward_chat function is the main function of this class.</span>
<span class="sd">    It takes in a ChatRequest object, which contains a prompt and history.</span>
<span class="sd">    The prompt is the user&#39;s input to be processed by the chatbot, while history</span>
<span class="sd">    is an array of previous inputs and outputs from both sides (user and bot).</span>
<span class="sd">    The forward_chat function then formats these inputs into one string that can be processed by our model.</span>
<span class="sd">    This formatted string is then passed through our process() method, which returns an output response as well as how many tokens were used to generate it.</span>

<span class="sd">    :param self: Access the attributes and methods of the class</span>
<span class="sd">    :param data: ChatRequest: Pass in the data from the request</span>
<span class="sd">    :return: A dictionary with the following keys:</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_funcs_generated</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="s1">&#39;status&#39;</span><span class="p">:</span> <span class="s2">&quot;down&quot;</span>
        <span class="p">}</span>

    <span class="n">string</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">format_chat</span><span class="p">(</span>
        <span class="n">prompt</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">prompt</span><span class="p">,</span>
        <span class="n">system</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">history</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">history</span>
    <span class="p">)</span>

    <span class="n">response</span><span class="p">,</span> <span class="n">used_tokens</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="mi">2</span>
    <span class="k">for</span> <span class="n">response</span><span class="p">,</span> <span class="n">used_tokens</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">process</span><span class="p">(</span>
            <span class="n">string</span><span class="o">=</span><span class="n">string</span><span class="p">,</span>
            <span class="n">greedy</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">greedy</span><span class="p">,</span>
            <span class="n">max_new_tokens</span><span class="o">=</span><span class="kc">None</span>
    <span class="p">):</span>
        <span class="o">...</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">number_of_served_request_until_last_up_time</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="p">{</span>
        <span class="s1">&#39;input&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">string</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span>
        <span class="s1">&#39;response&#39;</span><span class="p">:</span> <span class="n">response</span><span class="p">,</span>
        <span class="s1">&#39;tokens_used&#39;</span><span class="p">:</span> <span class="n">used_tokens</span><span class="p">,</span>
    <span class="p">}</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h3 id="lib.python.EasyDel.serve.jax_serve.JAXServer.forward_chat_non_api" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">forward_chat_non_api</span><span class="p">(</span><span class="n">prompt</span><span class="p">,</span> <span class="n">history</span><span class="p">,</span> <span class="n">greedy</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>The forward_chat_non_api function is a wrapper for the forward_chat function.
It takes in a prompt, history, and greedy parameter and returns the response from
the forward_chat function. The purpose of this wrapper is to allow users to use
the chatbot without having to create ChatRequest objects.</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>self</code></td>
          <td>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Represent the instance of the class</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>prompt</code></td>
          <td>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Pass the user's input to the model</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>history</code></td>
          <td>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Pass the history of the conversation to the model</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>greedy</code></td>
          <td>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Determine whether the model should use a greedy search</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
          </td>
          <td>
            <div class="doc-md-description">
              <p>A chat-response object</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>lib/python/EasyDel/serve/jax_serve.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">675</span>
<span class="normal">676</span>
<span class="normal">677</span>
<span class="normal">678</span>
<span class="normal">679</span>
<span class="normal">680</span>
<span class="normal">681</span>
<span class="normal">682</span>
<span class="normal">683</span>
<span class="normal">684</span>
<span class="normal">685</span>
<span class="normal">686</span>
<span class="normal">687</span>
<span class="normal">688</span>
<span class="normal">689</span>
<span class="normal">690</span>
<span class="normal">691</span>
<span class="normal">692</span>
<span class="normal">693</span>
<span class="normal">694</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">forward_chat_non_api</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prompt</span><span class="p">,</span> <span class="n">history</span><span class="p">,</span> <span class="n">greedy</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The forward_chat_non_api function is a wrapper for the forward_chat function.</span>
<span class="sd">    It takes in a prompt, history, and greedy parameter and returns the response from</span>
<span class="sd">    the forward_chat function. The purpose of this wrapper is to allow users to use</span>
<span class="sd">    the chatbot without having to create ChatRequest objects.</span>

<span class="sd">    :param self: Represent the instance of the class</span>
<span class="sd">    :param prompt: Pass the user&#39;s input to the model</span>
<span class="sd">    :param history: Pass the history of the conversation to the model</span>
<span class="sd">    :param greedy: Determine whether the model should use a greedy search</span>
<span class="sd">    :return: A chat-response object</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">ChatRequest</span><span class="p">(</span>
        <span class="n">prompt</span><span class="o">=</span><span class="n">prompt</span><span class="p">,</span>
        <span class="n">history</span><span class="o">=</span><span class="n">history</span><span class="p">,</span>
        <span class="n">greedy</span><span class="o">=</span><span class="n">greedy</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">forward_chat</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h3 id="lib.python.EasyDel.serve.jax_serve.JAXServer.forward_instruct" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">forward_instruct</span><span class="p">(</span><span class="n">data</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>The forward_instruct function is the main function of this class.
It takes in a InstructRequest object, which contains the system and instruction to be processed.
The function then formats the input string using format_instruct, and passes it into process().
process() returns a tuple containing (response, used_tokens). The response is returned as part of
the response dictionary. If no valid responses are found by process(), None will be returned instead.</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>self</code></td>
          <td>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Bind the method to the object</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>data</code></td>
          <td>
                <code><span title="lib.python.EasyDel.serve.utils.InstructRequest">InstructRequest</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>InstructRequest: Pass the system and instruction to the function</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
          </td>
          <td>
            <div class="doc-md-description">
              <p>A dictionary with three keys:</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>lib/python/EasyDel/serve/jax_serve.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">forward_instruct</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">InstructRequest</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The forward_instruct function is the main function of this class.</span>
<span class="sd">    It takes in a InstructRequest object, which contains the system and instruction to be processed.</span>
<span class="sd">    The function then formats the input string using format_instruct, and passes it into process().</span>
<span class="sd">    process() returns a tuple containing (response, used_tokens). The response is returned as part of</span>
<span class="sd">    the response dictionary. If no valid responses are found by process(), None will be returned instead.</span>

<span class="sd">    :param self: Bind the method to the object</span>
<span class="sd">    :param data: InstructRequest: Pass the system and instruction to the function</span>
<span class="sd">    :return: A dictionary with three keys:</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_funcs_generated</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="s1">&#39;status&#39;</span><span class="p">:</span> <span class="s2">&quot;down&quot;</span>
        <span class="p">}</span>

    <span class="n">response</span><span class="p">,</span> <span class="n">used_tokens</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="mi">2</span>
    <span class="n">string</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">format_instruct</span><span class="p">(</span>
        <span class="n">system</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">system</span><span class="p">,</span>
        <span class="n">instruction</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">instruction</span>
    <span class="p">)</span>
    <span class="k">for</span> <span class="n">response</span><span class="p">,</span> <span class="n">used_tokens</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">process</span><span class="p">(</span>
            <span class="n">string</span><span class="o">=</span><span class="n">string</span><span class="p">,</span>
            <span class="n">greedy</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">greedy</span><span class="p">,</span>
            <span class="n">max_new_tokens</span><span class="o">=</span><span class="kc">None</span>
    <span class="p">):</span>
        <span class="o">...</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">number_of_served_request_until_last_up_time</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="p">{</span>
        <span class="s1">&#39;input&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">string</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span>
        <span class="s1">&#39;response&#39;</span><span class="p">:</span> <span class="n">response</span><span class="p">,</span>
        <span class="s1">&#39;tokens_used&#39;</span><span class="p">:</span> <span class="n">used_tokens</span><span class="p">,</span>
    <span class="p">}</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h3 id="lib.python.EasyDel.serve.jax_serve.JAXServer.forward_instruct_non_api" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">forward_instruct_non_api</span><span class="p">(</span><span class="n">prompt</span><span class="p">,</span> <span class="n">system</span><span class="p">,</span> <span class="n">greedy</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>The forward_instruct_non_api function is a wrapper for the forward_instruct function.
It takes in a prompt, system, and greedy flag as arguments and returns the response from
the forward_instruct function. The purpose of this wrapper is to allow users to call
forward_instruct without having to create an InstructRequest object.</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>self</code></td>
          <td>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Represent the instance of the class</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>prompt</code></td>
          <td>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Pass the instruction to the system</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>system</code></td>
          <td>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Specify which system to use for the instruction</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>greedy</code></td>
          <td>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Determine whether the system should return</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The response from the forward_instruct function</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>lib/python/EasyDel/serve/jax_serve.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span>
<span class="normal">667</span>
<span class="normal">668</span>
<span class="normal">669</span>
<span class="normal">670</span>
<span class="normal">671</span>
<span class="normal">672</span>
<span class="normal">673</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">forward_instruct_non_api</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prompt</span><span class="p">,</span> <span class="n">system</span><span class="p">,</span> <span class="n">greedy</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The forward_instruct_non_api function is a wrapper for the forward_instruct function.</span>
<span class="sd">    It takes in a prompt, system, and greedy flag as arguments and returns the response from</span>
<span class="sd">    the forward_instruct function. The purpose of this wrapper is to allow users to call</span>
<span class="sd">    forward_instruct without having to create an InstructRequest object.</span>

<span class="sd">    :param self: Represent the instance of the class</span>
<span class="sd">    :param prompt: Pass the instruction to the system</span>
<span class="sd">    :param system: Specify which system to use for the instruction</span>
<span class="sd">    :param greedy: Determine whether the system should return</span>
<span class="sd">    :return: The response from the forward_instruct function</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">InstructRequest</span><span class="p">(</span>
        <span class="n">prompt</span><span class="o">=</span><span class="n">prompt</span><span class="p">,</span>
        <span class="n">system</span><span class="o">=</span><span class="n">system</span><span class="p">,</span>
        <span class="n">greedy</span><span class="o">=</span><span class="n">greedy</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">forward_instruct</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h3 id="lib.python.EasyDel.serve.jax_serve.JAXServer.generate" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">generate</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">input_ids</span><span class="p">,</span> <span class="n">attention_mask</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>The generate function is used to generate a sequence of tokens from the model.</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>self</code></td>
          <td>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Access variables that belong to the class</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>params</code></td>
          <td>
                <code><span title="typing.Union">Union</span>[<span title="flax.core.FrozenDict">FrozenDict</span>, dict]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Union[flax.core.FrozenDict, dict]: Pass the parameters of the model to be used in generating text</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>input_ids</code></td>
          <td>
                <code><span title="chex.Array">Array</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>chex.Array: Pass the input to the model</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>attention_mask</code></td>
          <td>
                <code><span title="chex.Array">Array</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>chex.Array: Mask the padding tokens</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The logits of the model</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>lib/python/EasyDel/serve/jax_serve.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">generate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
             <span class="n">params</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">flax</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">FrozenDict</span><span class="p">,</span> <span class="nb">dict</span><span class="p">],</span>
             <span class="n">input_ids</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span><span class="p">,</span>
             <span class="n">attention_mask</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span><span class="p">,</span>
             <span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The generate function is used to generate a sequence of tokens from the model.</span>

<span class="sd">    :param self: Access variables that belong to the class</span>
<span class="sd">    :param params: Union[flax.core.FrozenDict, dict]: Pass the parameters of the model to be used in generating text</span>
<span class="sd">    :param input_ids: chex.Array: Pass the input to the model</span>
<span class="sd">    :param attention_mask: chex.Array: Mask the padding tokens</span>
<span class="sd">    :return: The logits of the model</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_funcs_generated</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span>
            <span class="s1">&#39;this method will be implemented automatically after using ``configure_generate_functions`` function&#39;</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">mesh</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_generate</span><span class="p">(</span>
                <span class="n">params</span><span class="p">,</span> <span class="n">input_ids</span><span class="p">,</span> <span class="n">attention_mask</span>
            <span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h3 id="lib.python.EasyDel.serve.jax_serve.JAXServer.get_memory" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">get_memory</span><span class="p">()</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

</h3>


  <div class="doc doc-contents ">
  
      <p>The get_memory function returns the total memory of the system in bytes.</p>



  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The amount of memory used by the program</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>lib/python/EasyDel/serve/jax_serve.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span> <span class="nf">get_memory</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The get_memory function returns the total memory of the system in bytes.</span>


<span class="sd">    :return: The amount of memory used by the program</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">get_mem</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h3 id="lib.python.EasyDel.serve.jax_serve.JAXServer.greedy_generate" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">greedy_generate</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">input_ids</span><span class="p">,</span> <span class="n">attention_mask</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>The greedy_generate function is a helper function that takes in the model parameters, input_ids and attention_mask
and returns the generated tokens. It uses greedy search to generate tokens one at a time.</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>self</code></td>
          <td>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Refer to the object itself</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>params</code></td>
          <td>
                <code><span title="typing.Union">Union</span>[<span title="flax.core.FrozenDict">FrozenDict</span>, dict]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Union[flax.core.FrozenDict, dict]: Pass the parameters to the model</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>input_ids</code></td>
          <td>
                <code><span title="chex.Array">Array</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>chex.Array: Pass in the input sequence</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>attention_mask</code></td>
          <td>
                <code><span title="chex.Array">Array</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>chex.Array: Mask the input tokens</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code></code></td>
          <td>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Specify the parameters of the model</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
          </td>
          <td>
            <div class="doc-md-description">
              <p>generated_ids</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>lib/python/EasyDel/serve/jax_serve.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">greedy_generate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                    <span class="n">params</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">flax</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">FrozenDict</span><span class="p">,</span> <span class="nb">dict</span><span class="p">],</span>
                    <span class="n">input_ids</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span><span class="p">,</span>
                    <span class="n">attention_mask</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span><span class="p">,</span>
                    <span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The greedy_generate function is a helper function that takes in the model parameters, input_ids and attention_mask</span>
<span class="sd">    and returns the generated tokens. It uses greedy search to generate tokens one at a time.</span>


<span class="sd">    :param self: Refer to the object itself</span>
<span class="sd">    :param params: Union[flax.core.FrozenDict, dict]: Pass the parameters to the model</span>
<span class="sd">    :param input_ids: chex.Array: Pass in the input sequence</span>
<span class="sd">    :param attention_mask: chex.Array: Mask the input tokens</span>
<span class="sd">    :param : Specify the parameters of the model</span>
<span class="sd">    :return:  generated_ids</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_funcs_generated</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span>
            <span class="s1">&#39;this method will be implemented automatically after using ``configure_generate_functions`` function&#39;</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">mesh</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_greedy_generate</span><span class="p">(</span>
                <span class="n">params</span><span class="p">,</span> <span class="n">input_ids</span><span class="p">,</span> <span class="n">attention_mask</span>
            <span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h3 id="lib.python.EasyDel.serve.jax_serve.JAXServer.launch" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">launch</span><span class="p">(</span><span class="n">share_chat</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">share_inst</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>The launch function is a wrapper for the launch function of the gradio.Interface class.
It takes two boolean arguments: share_chat and share_inst, which are used to determine whether to
share the chatbot interface and/or instruction interface respectively. If both are set to False, then neither
interface will be shared (this is useful if you want to run your app locally). If one or both of them are True,
then they will be shared on Gradio's servers with a unique URL that can be accessed by anyone in order for them
to interact with your app.</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>self</code></td>
          <td>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Represent the instance of the class</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>share_chat</code></td>
          <td>
                <code>bool</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>bool: Determine if the chatbot should be shared</p>
            </div>
          </td>
          <td>
                <code>False</code>
          </td>
        </tr>
        <tr>
          <td><code>share_inst</code></td>
          <td>
                <code>bool</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>bool: Share the instructions for the app</p>
            </div>
          </td>
          <td>
                <code>False</code>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
          </td>
          <td>
            <div class="doc-md-description">
              <p>A dictionary with the share urls for chat and instructions</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>lib/python/EasyDel/serve/jax_serve.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">960</span>
<span class="normal">961</span>
<span class="normal">962</span>
<span class="normal">963</span>
<span class="normal">964</span>
<span class="normal">965</span>
<span class="normal">966</span>
<span class="normal">967</span>
<span class="normal">968</span>
<span class="normal">969</span>
<span class="normal">970</span>
<span class="normal">971</span>
<span class="normal">972</span>
<span class="normal">973</span>
<span class="normal">974</span>
<span class="normal">975</span>
<span class="normal">976</span>
<span class="normal">977</span>
<span class="normal">978</span>
<span class="normal">979</span>
<span class="normal">980</span>
<span class="normal">981</span>
<span class="normal">982</span>
<span class="normal">983</span>
<span class="normal">984</span>
<span class="normal">985</span>
<span class="normal">986</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">launch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
           <span class="n">share_chat</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
           <span class="n">share_inst</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
           <span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The launch function is a wrapper for the launch function of the gradio.Interface class.</span>
<span class="sd">    It takes two boolean arguments: share_chat and share_inst, which are used to determine whether to</span>
<span class="sd">    share the chatbot interface and/or instruction interface respectively. If both are set to False, then neither</span>
<span class="sd">    interface will be shared (this is useful if you want to run your app locally). If one or both of them are True,</span>
<span class="sd">    then they will be shared on Gradio&#39;s servers with a unique URL that can be accessed by anyone in order for them</span>
<span class="sd">    to interact with your app.</span>

<span class="sd">    :param self: Represent the instance of the class</span>
<span class="sd">    :param share_chat: bool: Determine if the chatbot should be shared</span>
<span class="sd">    :param share_inst: bool: Share the instructions for the app</span>
<span class="sd">    :return: A dictionary with the share urls for chat and instructions</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">share_kwargs</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">assert</span> <span class="ow">not</span> <span class="n">share_chat</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">share_inst</span><span class="p">,</span> <span class="s1">&#39;you have to pass at least one of sharing options True&#39;</span>
    <span class="k">if</span> <span class="n">share_chat</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gradio_app_chat</span><span class="o">.</span><span class="n">launch</span><span class="p">(</span><span class="n">share</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">share_kwargs</span><span class="p">[</span><span class="s1">&#39;chat&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gradio_app_chat</span><span class="o">.</span><span class="n">share_url</span>
    <span class="k">if</span> <span class="n">share_inst</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gradio_app_instruct</span><span class="o">.</span><span class="n">launch</span><span class="p">(</span><span class="n">share</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">share_kwargs</span><span class="p">[</span><span class="s1">&#39;inst&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gradio_app_instruct</span><span class="o">.</span><span class="n">share_url</span>
    <span class="k">return</span> <span class="n">share_kwargs</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h3 id="lib.python.EasyDel.serve.jax_serve.JAXServer.load" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">load</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">config_model</span><span class="p">,</span> <span class="n">tokenizer</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">config</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">add_params_field</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">init_shape</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">do_memory_log</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h3>


  <div class="doc doc-contents ">
  
      <p>The load function is used to load a pretrained model from disk.</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>cls</code></td>
          <td>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Refer to the class itself</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>model</code></td>
          <td>
                <code><span title="transformers.FlaxPreTrainedModel">FlaxPreTrainedModel</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>transformers.FlaxPreTrainedModel: Initialize the server</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>config_model</code></td>
          <td>
                <code><span title="transformers.PretrainedConfig">PretrainedConfig</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>transformers.PretrainedConfig: Get the partition rules</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>tokenizer</code></td>
          <td>
                <code><span title="transformers.PreTrainedTokenizer">PreTrainedTokenizer</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>transformers.PreTrainedTokenizer: Load the tokenizer from the model</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>path</code></td>
          <td>
                <code><span title="typing.Union">Union</span>[str, <span title="os.PathLike">PathLike</span>]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>typing.Union[str, os.PathLike]: Specify the path to the checkpoint file</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>config</code></td>
          <td>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Configure the server</p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>add_params_field</code></td>
          <td>
                <code>bool</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>bool: Add a params field to the server</p>
            </div>
          </td>
          <td>
                <code>True</code>
          </td>
        </tr>
        <tr>
          <td><code>init_shape</code></td>
          <td>
                <code>tuple</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>tuple: Specify the shape of the input to be used for generating shard_fns</p>
            </div>
          </td>
          <td>
                <code>(1, 1)</code>
          </td>
        </tr>
        <tr>
          <td><code>do_memory_log</code></td>
          <td>
                <code>bool</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>bool: Log the memory usage of the server</p>
            </div>
          </td>
          <td>
                <code>False</code>
          </td>
        </tr>
        <tr>
          <td><code>verbose</code></td>
          <td>
                <code>bool</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>bool: Print the compilation process</p>
            </div>
          </td>
          <td>
                <code>True</code>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
          </td>
          <td>
            <div class="doc-md-description">
              <p>A server</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>lib/python/EasyDel/serve/jax_serve.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">load</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">,</span>
        <span class="n">model</span><span class="p">:</span> <span class="n">transformers</span><span class="o">.</span><span class="n">FlaxPreTrainedModel</span><span class="p">,</span>
        <span class="n">config_model</span><span class="p">:</span> <span class="n">transformers</span><span class="o">.</span><span class="n">PretrainedConfig</span><span class="p">,</span>
        <span class="n">tokenizer</span><span class="p">:</span> <span class="n">transformers</span><span class="o">.</span><span class="n">PreTrainedTokenizer</span><span class="p">,</span>
        <span class="n">path</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">PathLike</span><span class="p">],</span>
        <span class="n">config</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">add_params_field</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">init_shape</span><span class="p">:</span> <span class="nb">tuple</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
        <span class="n">do_memory_log</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The load function is used to load a pretrained model from disk.</span>

<span class="sd">    :param cls: Refer to the class itself</span>
<span class="sd">    :param model: transformers.FlaxPreTrainedModel: Initialize the server</span>
<span class="sd">    :param config_model: transformers.PretrainedConfig: Get the partition rules</span>
<span class="sd">    :param tokenizer: transformers.PreTrainedTokenizer: Load the tokenizer from the model</span>
<span class="sd">    :param path: typing.Union[str, os.PathLike]: Specify the path to the checkpoint file</span>
<span class="sd">    :param config: Configure the server</span>
<span class="sd">    :param add_params_field: bool: Add a params field to the server</span>
<span class="sd">    :param init_shape: tuple: Specify the shape of the input to be used for generating shard_fns</span>
<span class="sd">    :param do_memory_log: bool: Log the memory usage of the server</span>
<span class="sd">    :param verbose: bool: Print the compilation process</span>
<span class="sd">    :return: A server</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">assert</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">model</span><span class="p">,</span>
                   <span class="s1">&#39;init_weights&#39;</span><span class="p">),</span> <span class="s1">&#39;model must contain init_weights func in order to init params for shard_fns&#39;</span>
    <span class="k">assert</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">config_model</span><span class="p">,</span>
                   <span class="s1">&#39;get_partition_rules&#39;</span><span class="p">),</span> <span class="s1">&#39;config_model must contain get_partition_rules functions&#39;</span>
    <span class="n">server</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">(</span><span class="n">config</span><span class="o">=</span><span class="n">config</span><span class="p">)</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
        <span class="s1">&#39;running _init() func in order to make shard_fns&#39;</span>
    <span class="p">)</span>
    <span class="k">with</span> <span class="n">jax</span><span class="o">.</span><span class="n">default_device</span><span class="p">(</span><span class="n">jax</span><span class="o">.</span><span class="n">devices</span><span class="p">(</span><span class="s1">&#39;cpu&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]):</span>
        <span class="k">def</span> <span class="nf">_init</span><span class="p">():</span>
            <span class="k">return</span> <span class="n">model</span><span class="o">.</span><span class="n">init_weights</span><span class="p">(</span><span class="n">jax</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">PRNGKey</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="n">init_shape</span><span class="p">)</span>

        <span class="n">shape</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">eval_shape</span><span class="p">(</span><span class="n">_init</span><span class="p">)</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
        <span class="s1">&#39;matching partition rules&#39;</span>
    <span class="p">)</span>
    <span class="n">rules</span> <span class="o">=</span> <span class="n">match_partition_rules</span><span class="p">(</span><span class="n">params</span><span class="o">=</span><span class="n">shape</span><span class="p">,</span> <span class="n">rules</span><span class="o">=</span><span class="n">config_model</span><span class="o">.</span><span class="n">get_partition_rules</span><span class="p">(</span><span class="kc">True</span><span class="p">))</span>

    <span class="k">with</span> <span class="n">server</span><span class="o">.</span><span class="n">mesh</span><span class="p">:</span>
        <span class="n">shard_fns</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">make_shard_and_gather_fns</span><span class="p">(</span><span class="n">rules</span><span class="p">,</span> <span class="n">get_float_dtype_by_name</span><span class="p">(</span><span class="n">server</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">dtype</span><span class="p">))</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
            <span class="s1">&#39;loading checkpoints&#39;</span>
        <span class="p">)</span>

        <span class="n">shard_fns</span> <span class="o">=</span> <span class="n">flax</span><span class="o">.</span><span class="n">traverse_util</span><span class="o">.</span><span class="n">flatten_dict</span><span class="p">(</span><span class="n">shard_fns</span><span class="p">)</span>
        <span class="n">server</span><span class="o">.</span><span class="n">params</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">stream</span><span class="p">:</span>
            <span class="n">unpacker</span> <span class="o">=</span> <span class="n">msgpack</span><span class="o">.</span><span class="n">Unpacker</span><span class="p">(</span><span class="n">stream</span><span class="p">,</span> <span class="n">read_size</span><span class="o">=</span><span class="mi">83886080</span><span class="p">,</span> <span class="n">max_buffer_size</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">pbar</span> <span class="o">=</span> <span class="n">tqdm</span><span class="o">.</span><span class="n">tqdm</span><span class="p">(</span><span class="n">unpacker</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">pbar</span><span class="p">:</span>
                <span class="n">key</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
                <span class="n">tensor</span> <span class="o">=</span> <span class="n">from_bytes</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
                <span class="n">tensor</span> <span class="o">=</span> <span class="n">shard_fns</span><span class="p">[</span><span class="n">key</span><span class="p">](</span><span class="n">tensor</span><span class="p">)</span>
                <span class="n">server</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">tensor</span>
                <span class="k">if</span> <span class="n">do_memory_log</span><span class="p">:</span>
                    <span class="n">pbar</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">server</span><span class="o">.</span><span class="n">get_memory</span><span class="p">())</span>
                <span class="n">pbar</span><span class="o">.</span><span class="n">set_description</span><span class="p">(</span><span class="s1">&#39;Sharding Params&#39;</span><span class="p">)</span>
    <span class="n">server</span><span class="o">.</span><span class="n">params</span> <span class="o">=</span> <span class="n">flax</span><span class="o">.</span><span class="n">traverse_util</span><span class="o">.</span><span class="n">unflatten_dict</span><span class="p">(</span><span class="n">server</span><span class="o">.</span><span class="n">params</span><span class="p">)</span>
    <span class="n">server</span><span class="o">.</span><span class="n">params</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;params&#39;</span><span class="p">:</span> <span class="n">server</span><span class="o">.</span><span class="n">params</span><span class="p">}</span> <span class="k">if</span> <span class="n">add_params_field</span> <span class="k">else</span> <span class="n">server</span><span class="o">.</span><span class="n">params</span>

    <span class="n">server</span><span class="o">.</span><span class="n">rules</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;params&#39;</span><span class="p">:</span> <span class="n">rules</span><span class="p">}</span> <span class="k">if</span> <span class="n">add_params_field</span> <span class="k">else</span> <span class="n">rules</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
        <span class="s1">&#39;configuring generate functions for the server&#39;</span>
    <span class="p">)</span>
    <span class="n">server</span><span class="o">.</span><span class="n">configure_generate_functions</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">tokenizer</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">server</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">pre_compile</span><span class="p">:</span>
        <span class="n">server</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">server</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h3 id="lib.python.EasyDel.serve.jax_serve.JAXServer.load_from_params" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">load_from_params</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">config_model</span><span class="p">,</span> <span class="n">tokenizer</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">config</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">add_params_field</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">do_memory_log</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h3>


  <div class="doc doc-contents ">
  
      <p>The load_from_params function is used to load a model from the parameters of a pretrained model.
It takes in the following arguments:
    - cls: The class of the server you are loading, this should be Server or TPU_Server depending on what backend you want to use.
    - model: A FlaxPreTrainedModel object that contains all of your models functions and parameters. This can be found in transformers/flax_utils/models/<em>model</em>.py
        where <em>model</em> is replaced with whatever transformer you are using (e.g., bert). You can also create your own custom</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>cls</code></td>
          <td>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Create a new instance of the class</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>model</code></td>
          <td>
                <code><span title="transformers.FlaxPreTrainedModel">FlaxPreTrainedModel</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>transformers.FlaxPreTrainedModel: Load the model</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>config_model</code></td>
          <td>
                <code><span title="transformers.PretrainedConfig">PretrainedConfig</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>transformers.PretrainedConfig: Get the partition rules</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>tokenizer</code></td>
          <td>
                <code><span title="transformers.PreTrainedTokenizer">PreTrainedTokenizer</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>transformers.PreTrainedTokenizer: Tokenize the input text</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>params</code></td>
          <td>
                <code><span title="typing.Dict">Dict</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>typing.Dict: Pass in the parameters of the model</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>config</code></td>
          <td>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Pass in the config file for the server</p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>add_params_field</code></td>
          <td>
                <code>bool</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>bool: Add a params field to the server</p>
            </div>
          </td>
          <td>
                <code>True</code>
          </td>
        </tr>
        <tr>
          <td><code>do_memory_log</code></td>
          <td>
                <code>bool</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>bool: Log the memory usage of the server</p>
            </div>
          </td>
          <td>
                <code>False</code>
          </td>
        </tr>
        <tr>
          <td><code>verbose</code></td>
          <td>
                <code>bool</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>bool: Print out the status of the compilation</p>
            </div>
          </td>
          <td>
                <code>True</code>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
          </td>
          <td>
            <div class="doc-md-description">
              <p>A server object</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>lib/python/EasyDel/serve/jax_serve.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">load_from_params</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">,</span>
        <span class="n">model</span><span class="p">:</span> <span class="n">transformers</span><span class="o">.</span><span class="n">FlaxPreTrainedModel</span><span class="p">,</span>
        <span class="n">config_model</span><span class="p">:</span> <span class="n">transformers</span><span class="o">.</span><span class="n">PretrainedConfig</span><span class="p">,</span>
        <span class="n">tokenizer</span><span class="p">:</span> <span class="n">transformers</span><span class="o">.</span><span class="n">PreTrainedTokenizer</span><span class="p">,</span>
        <span class="n">params</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Dict</span><span class="p">,</span>
        <span class="n">config</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">add_params_field</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">do_memory_log</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The load_from_params function is used to load a model from the parameters of a pretrained model.</span>
<span class="sd">    It takes in the following arguments:</span>
<span class="sd">        - cls: The class of the server you are loading, this should be Server or TPU_Server depending on what backend you want to use.</span>
<span class="sd">        - model: A FlaxPreTrainedModel object that contains all of your models functions and parameters. This can be found in transformers/flax_utils/models/*model*.py</span>
<span class="sd">            where *model* is replaced with whatever transformer you are using (e.g., bert). You can also create your own custom</span>

<span class="sd">    :param cls: Create a new instance of the class</span>
<span class="sd">    :param model: transformers.FlaxPreTrainedModel: Load the model</span>
<span class="sd">    :param config_model: transformers.PretrainedConfig: Get the partition rules</span>
<span class="sd">    :param tokenizer: transformers.PreTrainedTokenizer: Tokenize the input text</span>
<span class="sd">    :param params: typing.Dict: Pass in the parameters of the model</span>
<span class="sd">    :param config: Pass in the config file for the server</span>
<span class="sd">    :param add_params_field: bool: Add a params field to the server</span>
<span class="sd">    :param do_memory_log: bool: Log the memory usage of the server</span>
<span class="sd">    :param verbose: bool: Print out the status of the compilation</span>
<span class="sd">    :return: A server object</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">assert</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">model</span><span class="p">,</span>
                   <span class="s1">&#39;init_weights&#39;</span><span class="p">),</span> <span class="s1">&#39;model must contain init_weights func in order to init params for shard_fns&#39;</span>
    <span class="k">assert</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">config_model</span><span class="p">,</span>
                   <span class="s1">&#39;get_partition_rules&#39;</span><span class="p">),</span> <span class="s1">&#39;config_model must contain get_partition_rules functions&#39;</span>
    <span class="n">server</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">(</span><span class="n">config</span><span class="o">=</span><span class="n">config</span><span class="p">)</span>

    <span class="k">with</span> <span class="n">server</span><span class="o">.</span><span class="n">mesh</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
            <span class="s1">&#39;matching partition rules&#39;</span>
        <span class="p">)</span>
        <span class="n">rules</span> <span class="o">=</span> <span class="n">match_partition_rules</span><span class="p">(</span><span class="n">params</span><span class="o">=</span><span class="n">params</span><span class="p">,</span> <span class="n">rules</span><span class="o">=</span><span class="n">config_model</span><span class="o">.</span><span class="n">get_partition_rules</span><span class="p">(</span><span class="kc">True</span><span class="p">))</span>
        <span class="n">shard_fns</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">make_shard_and_gather_fns</span><span class="p">(</span><span class="n">rules</span><span class="p">,</span> <span class="n">get_float_dtype_by_name</span><span class="p">(</span><span class="n">server</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">dtype</span><span class="p">))</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
            <span class="s1">&#39;sharding parameters across all of the chosen backend(tpu/gpu/cpu)s&#39;</span>
        <span class="p">)</span>
        <span class="n">params</span> <span class="o">=</span> <span class="n">flax</span><span class="o">.</span><span class="n">traverse_util</span><span class="o">.</span><span class="n">flatten_dict</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>
        <span class="n">shard_fns</span> <span class="o">=</span> <span class="n">flax</span><span class="o">.</span><span class="n">traverse_util</span><span class="o">.</span><span class="n">flatten_dict</span><span class="p">(</span><span class="n">shard_fns</span><span class="p">)</span>
        <span class="n">pbar</span> <span class="o">=</span> <span class="n">tqdm</span><span class="o">.</span><span class="n">tqdm</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">pbar</span><span class="p">:</span>

            <span class="n">key</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
            <span class="n">params</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">shard_fns</span><span class="p">[</span><span class="n">key</span><span class="p">](</span><span class="n">params</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>

            <span class="k">if</span> <span class="n">do_memory_log</span><span class="p">:</span>
                <span class="n">pbar</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">server</span><span class="o">.</span><span class="n">get_memory</span><span class="p">())</span>
            <span class="n">pbar</span><span class="o">.</span><span class="n">set_description</span><span class="p">(</span><span class="s1">&#39;Sharding Params&#39;</span><span class="p">)</span>
        <span class="n">server</span><span class="o">.</span><span class="n">params</span> <span class="o">=</span> <span class="n">flax</span><span class="o">.</span><span class="n">traverse_util</span><span class="o">.</span><span class="n">unflatten_dict</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>
        <span class="n">server</span><span class="o">.</span><span class="n">params</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;params&#39;</span><span class="p">:</span> <span class="n">server</span><span class="o">.</span><span class="n">params</span><span class="p">}</span> <span class="k">if</span> <span class="n">add_params_field</span> <span class="k">else</span> <span class="n">server</span><span class="o">.</span><span class="n">params</span>
    <span class="n">server</span><span class="o">.</span><span class="n">rules</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;params&#39;</span><span class="p">:</span> <span class="n">rules</span><span class="p">}</span> <span class="k">if</span> <span class="n">add_params_field</span> <span class="k">else</span> <span class="n">rules</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
        <span class="s1">&#39;configuring generate functions for the server&#39;</span>
    <span class="p">)</span>
    <span class="n">server</span><span class="o">.</span><span class="n">configure_generate_functions</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">tokenizer</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">server</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">pre_compile</span><span class="p">:</span>
        <span class="n">server</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">server</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h3 id="lib.python.EasyDel.serve.jax_serve.JAXServer.process" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">process</span><span class="p">(</span><span class="n">string</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">greedy</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">max_new_tokens</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>The process function is the main function of a model. It takes in an input string and returns a list of strings
that are generated from that input string. The process function can be called multiple times with different inputs,
and each time it will return a new set of outputs based on those inputs.</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>self</code></td>
          <td>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Access the class attributes</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>string</code></td>
          <td>
                <code>str</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>str: Pass the string that we want to generate</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>*</code></td>
          <td>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Pass a variable number of arguments to a function</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>greedy</code></td>
          <td>
                <code>bool</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>bool: Determine whether to use the greedy or non-greedy version of the generate function</p>
            </div>
          </td>
          <td>
                <code>False</code>
          </td>
        </tr>
        <tr>
          <td><code>max_new_tokens</code></td>
          <td>
                <code>int</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>int: Set the number of tokens to generate</p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>**kwargs</code></td>
          <td>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Pass any additional parameters to the process function</p>
            </div>
          </td>
          <td>
                <code>{}</code>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
          </td>
          <td>
            <div class="doc-md-description">
              <p>A generator that yields the predicted text and the number of tokens generated</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>lib/python/EasyDel/serve/jax_serve.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">696</span>
<span class="normal">697</span>
<span class="normal">698</span>
<span class="normal">699</span>
<span class="normal">700</span>
<span class="normal">701</span>
<span class="normal">702</span>
<span class="normal">703</span>
<span class="normal">704</span>
<span class="normal">705</span>
<span class="normal">706</span>
<span class="normal">707</span>
<span class="normal">708</span>
<span class="normal">709</span>
<span class="normal">710</span>
<span class="normal">711</span>
<span class="normal">712</span>
<span class="normal">713</span>
<span class="normal">714</span>
<span class="normal">715</span>
<span class="normal">716</span>
<span class="normal">717</span>
<span class="normal">718</span>
<span class="normal">719</span>
<span class="normal">720</span>
<span class="normal">721</span>
<span class="normal">722</span>
<span class="normal">723</span>
<span class="normal">724</span>
<span class="normal">725</span>
<span class="normal">726</span>
<span class="normal">727</span>
<span class="normal">728</span>
<span class="normal">729</span>
<span class="normal">730</span>
<span class="normal">731</span>
<span class="normal">732</span>
<span class="normal">733</span>
<span class="normal">734</span>
<span class="normal">735</span>
<span class="normal">736</span>
<span class="normal">737</span>
<span class="normal">738</span>
<span class="normal">739</span>
<span class="normal">740</span>
<span class="normal">741</span>
<span class="normal">742</span>
<span class="normal">743</span>
<span class="normal">744</span>
<span class="normal">745</span>
<span class="normal">746</span>
<span class="normal">747</span>
<span class="normal">748</span>
<span class="normal">749</span>
<span class="normal">750</span>
<span class="normal">751</span>
<span class="normal">752</span>
<span class="normal">753</span>
<span class="normal">754</span>
<span class="normal">755</span>
<span class="normal">756</span>
<span class="normal">757</span>
<span class="normal">758</span>
<span class="normal">759</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">process</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
            <span class="n">string</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
            <span class="o">*</span><span class="p">,</span>
            <span class="n">greedy</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
            <span class="n">max_new_tokens</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="o">**</span><span class="n">kwargs</span>
            <span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The process function is the main function of a model. It takes in an input string and returns a list of strings</span>
<span class="sd">    that are generated from that input string. The process function can be called multiple times with different inputs,</span>
<span class="sd">    and each time it will return a new set of outputs based on those inputs.</span>

<span class="sd">    :param self: Access the class attributes</span>
<span class="sd">    :param string: str: Pass the string that we want to generate</span>
<span class="sd">    :param *: Pass a variable number of arguments to a function</span>
<span class="sd">    :param greedy: bool: Determine whether to use the greedy or non-greedy version of the generate function</span>
<span class="sd">    :param max_new_tokens: int: Set the number of tokens to generate</span>
<span class="sd">    :param **kwargs: Pass any additional parameters to the process function</span>
<span class="sd">    :return: A generator that yields the predicted text and the number of tokens generated</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">tokens</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">prefix_tokenizer</span><span class="p">(</span>
        <span class="n">string</span><span class="p">,</span>
        <span class="n">max_length</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">max_length</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">max_stream_tokens</span><span class="p">,</span>
        <span class="n">padding</span><span class="o">=</span><span class="s1">&#39;max_length&#39;</span><span class="p">,</span>
        <span class="n">return_tensors</span><span class="o">=</span><span class="s1">&#39;jax&#39;</span>
    <span class="p">)</span> \
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">use_prefix_tokenizer</span> <span class="k">else</span> \
        <span class="bp">self</span><span class="o">.</span><span class="n">tokenizer</span><span class="p">(</span>
            <span class="n">string</span><span class="p">,</span>
            <span class="n">return_tensors</span><span class="o">=</span><span class="s1">&#39;jax&#39;</span>
        <span class="p">)</span>

    <span class="n">input_ids</span> <span class="o">=</span> <span class="n">tokens</span><span class="o">.</span><span class="n">input_ids</span>
    <span class="n">attention_mask</span> <span class="o">=</span> <span class="n">tokens</span><span class="o">.</span><span class="n">attention_mask</span>
    <span class="n">num_generated_tokens</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">pad</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">max_length</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">max_stream_tokens</span>

    <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">((</span><span class="n">max_new_tokens</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">max_new_tokens</span><span class="p">)</span> <span class="o">//</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">max_stream_tokens</span><span class="p">):</span>
        <span class="n">predicted_token</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">greedy_generate</span><span class="p">(</span>
            <span class="n">params</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">,</span>
            <span class="n">input_ids</span><span class="o">=</span><span class="n">input_ids</span><span class="p">,</span>
            <span class="n">attention_mask</span><span class="o">=</span><span class="n">attention_mask</span>
        <span class="p">)</span> <span class="k">if</span> <span class="n">greedy</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">generate</span><span class="p">(</span>
            <span class="n">params</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">,</span>
            <span class="n">input_ids</span><span class="o">=</span><span class="n">input_ids</span><span class="p">,</span>
            <span class="n">attention_mask</span><span class="o">=</span><span class="n">attention_mask</span>
        <span class="p">)</span>

        <span class="n">num_generated_tokens</span> <span class="o">+=</span> <span class="n">predicted_token</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

        <span class="n">input_ids</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span>
            <span class="p">(</span><span class="n">input_ids</span><span class="p">,</span> <span class="n">predicted_token</span><span class="p">),</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span>
        <span class="p">)[:,</span> <span class="o">-</span><span class="n">pad</span><span class="p">:]</span>
        <span class="n">attention_mask</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span>
            <span class="p">(</span><span class="n">attention_mask</span><span class="p">,</span> <span class="n">jnp</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">attention_mask</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">max_stream_tokens</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">jnp</span><span class="o">.</span><span class="n">int32</span><span class="p">)),</span>
            <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span>
        <span class="p">)[:,</span> <span class="o">-</span><span class="n">pad</span><span class="p">:]</span>

        <span class="k">yield</span> <span class="bp">self</span><span class="o">.</span><span class="n">tokenizer</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="n">input_ids</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="o">-</span><span class="n">num_generated_tokens</span><span class="p">:],</span>
                                    <span class="n">skip_special_tokens</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span> <span class="n">num_generated_tokens</span>
        <span class="k">if</span> <span class="n">predicted_token</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">tokenizer</span><span class="o">.</span><span class="n">eos_token_id</span> <span class="ow">or</span> <span class="n">predicted_token</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span>
            <span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">prefix_tokenizer</span><span class="o">.</span><span class="n">eos_token_id</span><span class="p">:</span>
            <span class="k">break</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h3 id="lib.python.EasyDel.serve.jax_serve.JAXServer.process_gradio_chat" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">process_gradio_chat</span><span class="p">(</span><span class="n">prompt</span><span class="p">,</span> <span class="n">history</span><span class="p">,</span> <span class="n">max_new_tokens</span><span class="p">,</span> <span class="n">system</span><span class="p">,</span> <span class="n">greedy</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>The process_gradio_chat function is a wrapper for the process function.
It takes in a prompt, history, max_new_tokens and system as arguments.
The string variable is set to the output of format_chat with the given history and prompt.
If stream tokens are not enabled then it will append an empty response to history and iterate through all responses from process until there are no more left (the last one). It will then return an empty string along with this new updated version of history. If stream tokens are enabled it appends an empty response to the end of our current list of histories (history) and iterates through</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>self</code></td>
          <td>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Refer to the object itself</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>prompt</code></td>
          <td>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Add the user's input to the history</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>history</code></td>
          <td>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Keep track of the conversation</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>max_new_tokens</code></td>
          <td>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Limit the number of tokens that can be generated by the model</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>system</code></td>
          <td>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Determine whether the message is from the user or system</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>greedy</code></td>
          <td>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Determine if the model should generate a response token by token or all at once</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
          </td>
          <td>
            <div class="doc-md-description">
              <p>A tuple of two values:</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>lib/python/EasyDel/serve/jax_serve.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">761</span>
<span class="normal">762</span>
<span class="normal">763</span>
<span class="normal">764</span>
<span class="normal">765</span>
<span class="normal">766</span>
<span class="normal">767</span>
<span class="normal">768</span>
<span class="normal">769</span>
<span class="normal">770</span>
<span class="normal">771</span>
<span class="normal">772</span>
<span class="normal">773</span>
<span class="normal">774</span>
<span class="normal">775</span>
<span class="normal">776</span>
<span class="normal">777</span>
<span class="normal">778</span>
<span class="normal">779</span>
<span class="normal">780</span>
<span class="normal">781</span>
<span class="normal">782</span>
<span class="normal">783</span>
<span class="normal">784</span>
<span class="normal">785</span>
<span class="normal">786</span>
<span class="normal">787</span>
<span class="normal">788</span>
<span class="normal">789</span>
<span class="normal">790</span>
<span class="normal">791</span>
<span class="normal">792</span>
<span class="normal">793</span>
<span class="normal">794</span>
<span class="normal">795</span>
<span class="normal">796</span>
<span class="normal">797</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">process_gradio_chat</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prompt</span><span class="p">,</span> <span class="n">history</span><span class="p">,</span> <span class="n">max_new_tokens</span><span class="p">,</span> <span class="n">system</span><span class="p">,</span> <span class="n">greedy</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The process_gradio_chat function is a wrapper for the process function.</span>
<span class="sd">    It takes in a prompt, history, max_new_tokens and system as arguments.</span>
<span class="sd">    The string variable is set to the output of format_chat with the given history and prompt.</span>
<span class="sd">    If stream tokens are not enabled then it will append an empty response to history and iterate through all responses from process until there are no more left (the last one). It will then return an empty string along with this new updated version of history. If stream tokens are enabled it appends an empty response to the end of our current list of histories (history) and iterates through</span>

<span class="sd">    :param self: Refer to the object itself</span>
<span class="sd">    :param prompt: Add the user&#39;s input to the history</span>
<span class="sd">    :param history: Keep track of the conversation</span>
<span class="sd">    :param max_new_tokens: Limit the number of tokens that can be generated by the model</span>
<span class="sd">    :param system: Determine whether the message is from the user or system</span>
<span class="sd">    :param greedy: Determine if the model should generate a response token by token or all at once</span>
<span class="sd">    :return: A tuple of two values:</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">string</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">format_chat</span><span class="p">(</span><span class="n">history</span><span class="o">=</span><span class="n">history</span><span class="p">,</span> <span class="n">prompt</span><span class="o">=</span><span class="n">prompt</span><span class="p">,</span> <span class="n">system</span><span class="o">=</span><span class="n">system</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">stream_tokens_for_gradio</span><span class="p">:</span>
        <span class="n">response</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="k">for</span> <span class="n">response</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">process</span><span class="p">(</span>
                <span class="n">string</span><span class="o">=</span><span class="n">string</span><span class="p">,</span>
                <span class="n">greedy</span><span class="o">=</span><span class="n">greedy</span><span class="p">,</span>
                <span class="n">max_new_tokens</span><span class="o">=</span><span class="n">max_new_tokens</span><span class="p">,</span>
        <span class="p">):</span>
            <span class="k">pass</span>
        <span class="n">history</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">prompt</span><span class="p">,</span> <span class="n">response</span><span class="p">])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">history</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">prompt</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">])</span>
        <span class="k">for</span> <span class="n">response</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">process</span><span class="p">(</span>
                <span class="n">string</span><span class="o">=</span><span class="n">string</span><span class="p">,</span>
                <span class="n">greedy</span><span class="o">=</span><span class="n">greedy</span><span class="p">,</span>
                <span class="n">max_new_tokens</span><span class="o">=</span><span class="n">max_new_tokens</span><span class="p">,</span>
        <span class="p">):</span>
            <span class="n">history</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">response</span>
            <span class="k">yield</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">history</span>
    <span class="k">return</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">history</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h3 id="lib.python.EasyDel.serve.jax_serve.JAXServer.process_gradio_instruct" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">process_gradio_instruct</span><span class="p">(</span><span class="n">instruction</span><span class="p">,</span> <span class="n">system</span><span class="p">,</span> <span class="n">max_new_tokens</span><span class="p">,</span> <span class="n">greedy</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>The process_gradio_instruct function is a wrapper for the process function.
It takes in an instruction and system, formats them into a string, and then passes that string to the process function.
The response from this call to process is returned as output.</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>self</code></td>
          <td>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Refer to the instance of the class</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>instruction</code></td>
          <td>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Pass in the instruction from the user</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>system</code></td>
          <td>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Determine which system to use for the instruction</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>max_new_tokens</code></td>
          <td>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Limit the number of new tokens that can be added to the vocabulary</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>greedy</code></td>
          <td>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Determine whether the model should be greedy or not</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
          </td>
          <td>
            <div class="doc-md-description">
              <p>A tuple of two strings:</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>lib/python/EasyDel/serve/jax_serve.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">799</span>
<span class="normal">800</span>
<span class="normal">801</span>
<span class="normal">802</span>
<span class="normal">803</span>
<span class="normal">804</span>
<span class="normal">805</span>
<span class="normal">806</span>
<span class="normal">807</span>
<span class="normal">808</span>
<span class="normal">809</span>
<span class="normal">810</span>
<span class="normal">811</span>
<span class="normal">812</span>
<span class="normal">813</span>
<span class="normal">814</span>
<span class="normal">815</span>
<span class="normal">816</span>
<span class="normal">817</span>
<span class="normal">818</span>
<span class="normal">819</span>
<span class="normal">820</span>
<span class="normal">821</span>
<span class="normal">822</span>
<span class="normal">823</span>
<span class="normal">824</span>
<span class="normal">825</span>
<span class="normal">826</span>
<span class="normal">827</span>
<span class="normal">828</span>
<span class="normal">829</span>
<span class="normal">830</span>
<span class="normal">831</span>
<span class="normal">832</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">process_gradio_instruct</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">instruction</span><span class="p">,</span> <span class="n">system</span><span class="p">,</span> <span class="n">max_new_tokens</span><span class="p">,</span> <span class="n">greedy</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The process_gradio_instruct function is a wrapper for the process function.</span>
<span class="sd">    It takes in an instruction and system, formats them into a string, and then passes that string to the process function.</span>
<span class="sd">    The response from this call to process is returned as output.</span>

<span class="sd">    :param self: Refer to the instance of the class</span>
<span class="sd">    :param instruction: Pass in the instruction from the user</span>
<span class="sd">    :param system: Determine which system to use for the instruction</span>
<span class="sd">    :param max_new_tokens: Limit the number of new tokens that can be added to the vocabulary</span>
<span class="sd">    :param greedy: Determine whether the model should be greedy or not</span>
<span class="sd">    :return: A tuple of two strings:</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">string</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">format_instruct</span><span class="p">(</span><span class="n">instruction</span><span class="o">=</span><span class="n">instruction</span><span class="p">,</span> <span class="n">system</span><span class="o">=</span><span class="n">system</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">stream_tokens_for_gradio</span><span class="p">:</span>
        <span class="n">response</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="k">for</span> <span class="n">response</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">process</span><span class="p">(</span>
                <span class="n">string</span><span class="o">=</span><span class="n">string</span><span class="p">,</span>
                <span class="n">greedy</span><span class="o">=</span><span class="n">greedy</span><span class="p">,</span>
                <span class="n">max_new_tokens</span><span class="o">=</span><span class="n">max_new_tokens</span><span class="p">,</span>
        <span class="p">):</span>
            <span class="k">pass</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="n">response</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="k">for</span> <span class="n">response</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">process</span><span class="p">(</span>
                <span class="n">string</span><span class="o">=</span><span class="n">string</span><span class="p">,</span>
                <span class="n">greedy</span><span class="o">=</span><span class="n">greedy</span><span class="p">,</span>
                <span class="n">max_new_tokens</span><span class="o">=</span><span class="n">max_new_tokens</span><span class="p">,</span>
                <span class="n">stream</span><span class="o">=</span><span class="kc">True</span>
        <span class="p">):</span>
            <span class="k">yield</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">response</span>
    <span class="k">return</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">response</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h3 id="lib.python.EasyDel.serve.jax_serve.JAXServer.shard_params" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">shard_params</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">partition_rules</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>The shard_params function takes in a set of parameters and a partition rule.
The partition rule is used to determine how the parameters should be sharded across devices.
For example, if we have two devices, one with 4GB of memory and another with 8GB of memory,
we may want to shard our model such that the device with more memory has more parameters on it.
This function returns an updated version of params where each parameter is now stored on its own device.</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>self</code></td>
          <td>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Bind the instance of the class to a method</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>params</code></td>
          <td>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Pass the parameters of the model to be sharded</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>partition_rules</code></td>
          <td>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Specify how the parameters should be partitioned</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The sharded parameters</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>lib/python/EasyDel/serve/jax_serve.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">shard_params</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">partition_rules</span><span class="p">):</span>

<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The shard_params function takes in a set of parameters and a partition rule.</span>
<span class="sd">    The partition rule is used to determine how the parameters should be sharded across devices.</span>
<span class="sd">    For example, if we have two devices, one with 4GB of memory and another with 8GB of memory,</span>
<span class="sd">    we may want to shard our model such that the device with more memory has more parameters on it.</span>
<span class="sd">    This function returns an updated version of params where each parameter is now stored on its own device.</span>

<span class="sd">    :param self: Bind the instance of the class to a method</span>
<span class="sd">    :param params: Pass the parameters of the model to be sharded</span>
<span class="sd">    :param partition_rules: Specify how the parameters should be partitioned</span>
<span class="sd">    :return: The sharded parameters</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">log</span><span class="p">(</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">,</span>
        <span class="s1">&#39;the parameters will be sharded and ba saved inside server you can access them by ``JAXServer.params``&#39;</span><span class="p">)</span>
    <span class="n">rules</span> <span class="o">=</span> <span class="n">match_partition_rules</span><span class="p">(</span><span class="n">params</span><span class="o">=</span><span class="n">params</span><span class="p">,</span> <span class="n">rules</span><span class="o">=</span><span class="n">partition_rules</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">rules</span> <span class="o">=</span> <span class="n">rules</span>
    <span class="n">shard_fns</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">make_shard_and_gather_fns</span><span class="p">(</span><span class="n">rules</span><span class="p">,</span> <span class="n">get_float_dtype_by_name</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">dtype</span><span class="p">))</span>

    <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">mesh</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">params</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">tree_map</span><span class="p">(</span>
            <span class="k">lambda</span> <span class="n">f</span><span class="p">,</span> <span class="n">p</span><span class="p">:</span> <span class="n">f</span><span class="p">(</span><span class="n">p</span><span class="p">),</span> <span class="n">shard_fns</span><span class="p">,</span> <span class="n">params</span>
        <span class="p">)</span>

    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h3 id="lib.python.EasyDel.serve.jax_serve.JAXServer.status" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">status</span><span class="p">()</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>The status function returns a dictionary with the following keys:
    config: A dictionary containing all of the configuration parameters for this server.
    devices: A string describing which devices are available to JAX.
    number_of_backends: The number of backends available to JAX.  This is usually equal to the number of GPUs on your machine, but can be less if you have not installed CUDA or if you have disabled some GPUs in your system BIOS settings (e.g., because they are defective).  It can also be more than one if you have multiple machines connected via MPI and running under Horov</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>self</code></td>
          <td>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Represent the instance of the class</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
          </td>
          <td>
            <div class="doc-md-description">
              <p>A dictionary with the following keys:</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>lib/python/EasyDel/serve/jax_serve.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">status</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The status function returns a dictionary with the following keys:</span>
<span class="sd">        config: A dictionary containing all of the configuration parameters for this server.</span>
<span class="sd">        devices: A string describing which devices are available to JAX.</span>
<span class="sd">        number_of_backends: The number of backends available to JAX.  This is usually equal to the number of GPUs on your machine, but can be less if you have not installed CUDA or if you have disabled some GPUs in your system BIOS settings (e.g., because they are defective).  It can also be more than one if you have multiple machines connected via MPI and running under Horov</span>

<span class="sd">    :param self: Represent the instance of the class</span>
<span class="sd">    :return: A dictionary with the following keys:</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">{</span>
        <span class="s1">&#39;config&#39;</span><span class="p">:</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">items</span><span class="p">()},</span>
        <span class="s1">&#39;devices&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">jax</span><span class="o">.</span><span class="n">devices</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="s1">&#39;number_of_backends&#39;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">jax</span><span class="o">.</span><span class="n">devices</span><span class="p">()),</span>
        <span class="s1">&#39;status&#39;</span><span class="p">:</span> <span class="s1">&#39;Ready&#39;</span><span class="p">,</span>
        <span class="s1">&#39;number_of_served_request_until_last_up_time&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">number_of_served_request_until_last_up_time</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="s1">&#39;memory&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">get_mem</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="p">}</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>



  </div>

  </div>

</div>

<div class="doc doc-object doc-class">




<h2 id="lib.python.EasyDel.serve.jax_serve.JaxServerConfig" class="doc doc-heading">
          <code>JaxServerConfig</code>


</h2>


  <div class="doc doc-contents ">


            <details class="quote">
              <summary>Source code in <code>lib/python/EasyDel/serve/jax_serve.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">JaxServerConfig</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">host</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;0.0.0.0&quot;</span><span class="p">,</span>
            <span class="n">port</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">2059</span><span class="p">,</span>
            <span class="n">batch_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
            <span class="n">contains_auto_format</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
            <span class="n">max_length</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">4096</span><span class="p">,</span>
            <span class="n">max_new_tokens</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">4096</span><span class="p">,</span>
            <span class="n">max_stream_tokens</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">64</span><span class="p">,</span>
            <span class="n">temperature</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">,</span>
            <span class="n">top_p</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.95</span><span class="p">,</span>
            <span class="n">top_k</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">50</span><span class="p">,</span>
            <span class="n">logging</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
            <span class="n">mesh_axes_names</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;dp&quot;</span><span class="p">,</span> <span class="s2">&quot;fsdp&quot;</span><span class="p">,</span> <span class="s2">&quot;tp&quot;</span><span class="p">,</span> <span class="s2">&quot;mp&quot;</span><span class="p">),</span>
            <span class="n">mesh_axes_shape</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
            <span class="n">dtype</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;fp16&#39;</span><span class="p">,</span>
            <span class="n">stream_tokens_for_gradio</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
            <span class="n">use_prefix_tokenizer</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
            <span class="n">pre_compile</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The __init__ function is called when the class is instantiated.</span>
<span class="sd">        It sets up the attributes of an instance of this class, which are:</span>
<span class="sd">            host: str = &amp;quot;0.0.0.0&amp;quot;</span>
<span class="sd">                The IP address to listen on for incoming requests from clients</span>

<span class="sd">        :param self: Represent the instance of the class</span>
<span class="sd">        :param host: str: Set the host address of the server</span>
<span class="sd">        :param port: int: Specify the port number that the server will run on</span>
<span class="sd">        :param batch_size: int: Set the batch size of the model</span>
<span class="sd">        :param contains_auto_format: bool: Determine whether the input text contains auto-formatting</span>
<span class="sd">        :param max_length: int: Set the maximum length of the text that can be generated</span>
<span class="sd">        :param max_new_tokens: int: Determine how many tokens can be added to the vocabulary</span>
<span class="sd">        :param max_stream_tokens: int: Set the maximum number of tokens that can be streamed at a time</span>
<span class="sd">        :param temperature: float: Control the randomness of the output</span>
<span class="sd">        :param top_p: float: Control the diversity of the text generated</span>
<span class="sd">        :param top_k: int: Limit the number of tokens that can be generated</span>
<span class="sd">        :param logging: bool: Print out the progress of the server</span>
<span class="sd">        :param mesh_axes_names: Sequence[str]: Specify the names of the axes in the mesh tensor</span>
<span class="sd">        :param &amp;quot;fsdp&amp;quot;: Set the number of tokens to be generated</span>
<span class="sd">        :param &amp;quot;tp&amp;quot;: Set the top_p value</span>
<span class="sd">        :param &amp;quot;mp&amp;quot;): Define the mesh_axes_names</span>
<span class="sd">        :param mesh_axes_shape: Sequence[int]: Specify the shape of the mesh</span>
<span class="sd">        :param dtype: str: Specify the data type of the model</span>
<span class="sd">        :param stream_tokens_for_gradio: bool: Determine whether the stream tokens</span>
<span class="sd">        :param use_prefix_tokenizer: bool: Determine if the tokenizer should be used to generate tokens</span>
<span class="sd">        :param pre_compile: bool: Pre-compile the model</span>
<span class="sd">        :param : Set the host address</span>
<span class="sd">        :return: Nothing</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">host</span> <span class="o">=</span> <span class="n">host</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">port</span> <span class="o">=</span> <span class="n">port</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">batch_size</span> <span class="o">=</span> <span class="n">batch_size</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">contains_auto_format</span> <span class="o">=</span> <span class="n">contains_auto_format</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_length</span> <span class="o">=</span> <span class="n">max_length</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_new_tokens</span> <span class="o">=</span> <span class="n">max_new_tokens</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_stream_tokens</span> <span class="o">=</span> <span class="n">max_stream_tokens</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">temperature</span> <span class="o">=</span> <span class="n">temperature</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">top_p</span> <span class="o">=</span> <span class="n">top_p</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">top_k</span> <span class="o">=</span> <span class="n">top_k</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logging</span> <span class="o">=</span> <span class="n">logging</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mesh_axes_names</span> <span class="o">=</span> <span class="n">mesh_axes_names</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mesh_axes_shape</span> <span class="o">=</span> <span class="n">mesh_axes_shape</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dtype</span> <span class="o">=</span> <span class="n">dtype</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stream_tokens_for_gradio</span> <span class="o">=</span> <span class="n">stream_tokens_for_gradio</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">use_prefix_tokenizer</span> <span class="o">=</span> <span class="n">use_prefix_tokenizer</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pre_compile</span> <span class="o">=</span> <span class="n">pre_compile</span>
        <span class="k">assert</span> <span class="n">max_new_tokens</span> <span class="o">%</span> <span class="n">max_stream_tokens</span> <span class="o">==</span> <span class="mi">0</span><span class="p">,</span> \
            <span class="s1">&#39;max_new_tokens should be divisible by  max_new_tokens&#39;</span> \
            <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">max_new_tokens</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="n">max_stream_tokens</span><span class="si">}</span><span class="s1">&#39;</span>

    <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">):</span>
            <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">item</span><span class="si">}</span><span class="s1"> not found !&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__setitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>

  

  <div class="doc doc-children">










<div class="doc doc-object doc-function">




<h3 id="lib.python.EasyDel.serve.jax_serve.JaxServerConfig.__init__" class="doc doc-heading">
          <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">host</span><span class="o">=</span><span class="s1">&#39;0.0.0.0&#39;</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="mi">2059</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">contains_auto_format</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">max_length</span><span class="o">=</span><span class="mi">4096</span><span class="p">,</span> <span class="n">max_new_tokens</span><span class="o">=</span><span class="mi">4096</span><span class="p">,</span> <span class="n">max_stream_tokens</span><span class="o">=</span><span class="mi">64</span><span class="p">,</span> <span class="n">temperature</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">top_p</span><span class="o">=</span><span class="mf">0.95</span><span class="p">,</span> <span class="n">top_k</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">logging</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">mesh_axes_names</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;dp&#39;</span><span class="p">,</span> <span class="s1">&#39;fsdp&#39;</span><span class="p">,</span> <span class="s1">&#39;tp&#39;</span><span class="p">,</span> <span class="s1">&#39;mp&#39;</span><span class="p">),</span> <span class="n">mesh_axes_shape</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;fp16&#39;</span><span class="p">,</span> <span class="n">stream_tokens_for_gradio</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">use_prefix_tokenizer</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">pre_compile</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>The <strong>init</strong> function is called when the class is instantiated.
It sets up the attributes of an instance of this class, which are:
    host: str = &quot;0.0.0.0&quot;
        The IP address to listen on for incoming requests from clients</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>self</code></td>
          <td>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Represent the instance of the class</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>host</code></td>
          <td>
                <code>str</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>str: Set the host address of the server</p>
            </div>
          </td>
          <td>
                <code>&#39;0.0.0.0&#39;</code>
          </td>
        </tr>
        <tr>
          <td><code>port</code></td>
          <td>
                <code>int</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>int: Specify the port number that the server will run on</p>
            </div>
          </td>
          <td>
                <code>2059</code>
          </td>
        </tr>
        <tr>
          <td><code>batch_size</code></td>
          <td>
                <code>int</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>int: Set the batch size of the model</p>
            </div>
          </td>
          <td>
                <code>1</code>
          </td>
        </tr>
        <tr>
          <td><code>contains_auto_format</code></td>
          <td>
                <code>bool</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>bool: Determine whether the input text contains auto-formatting</p>
            </div>
          </td>
          <td>
                <code>True</code>
          </td>
        </tr>
        <tr>
          <td><code>max_length</code></td>
          <td>
                <code>int</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>int: Set the maximum length of the text that can be generated</p>
            </div>
          </td>
          <td>
                <code>4096</code>
          </td>
        </tr>
        <tr>
          <td><code>max_new_tokens</code></td>
          <td>
                <code>int</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>int: Determine how many tokens can be added to the vocabulary</p>
            </div>
          </td>
          <td>
                <code>4096</code>
          </td>
        </tr>
        <tr>
          <td><code>max_stream_tokens</code></td>
          <td>
                <code>int</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>int: Set the maximum number of tokens that can be streamed at a time</p>
            </div>
          </td>
          <td>
                <code>64</code>
          </td>
        </tr>
        <tr>
          <td><code>temperature</code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>float: Control the randomness of the output</p>
            </div>
          </td>
          <td>
                <code>0.1</code>
          </td>
        </tr>
        <tr>
          <td><code>top_p</code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>float: Control the diversity of the text generated</p>
            </div>
          </td>
          <td>
                <code>0.95</code>
          </td>
        </tr>
        <tr>
          <td><code>top_k</code></td>
          <td>
                <code>int</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>int: Limit the number of tokens that can be generated</p>
            </div>
          </td>
          <td>
                <code>50</code>
          </td>
        </tr>
        <tr>
          <td><code>logging</code></td>
          <td>
                <code>bool</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>bool: Print out the progress of the server</p>
            </div>
          </td>
          <td>
                <code>True</code>
          </td>
        </tr>
        <tr>
          <td><code>mesh_axes_names</code></td>
          <td>
                <code><span title="typing.Sequence">Sequence</span>[str]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Sequence[str]: Specify the names of the axes in the mesh tensor</p>
            </div>
          </td>
          <td>
                <code>(&#39;dp&#39;, &#39;fsdp&#39;, &#39;tp&#39;, &#39;mp&#39;)</code>
          </td>
        </tr>
        <tr>
          <td><code>&amp;quot;fsdp&amp;quot;</code></td>
          <td>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Set the number of tokens to be generated</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>&amp;quot;tp&amp;quot;</code></td>
          <td>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Set the top_p value</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>&amp;quot;mp&amp;quot;)</code></td>
          <td>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Define the mesh_axes_names</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>mesh_axes_shape</code></td>
          <td>
                <code><span title="typing.Sequence">Sequence</span>[int]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Sequence[int]: Specify the shape of the mesh</p>
            </div>
          </td>
          <td>
                <code>(1, -1, 1, 1)</code>
          </td>
        </tr>
        <tr>
          <td><code>dtype</code></td>
          <td>
                <code>str</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>str: Specify the data type of the model</p>
            </div>
          </td>
          <td>
                <code>&#39;fp16&#39;</code>
          </td>
        </tr>
        <tr>
          <td><code>stream_tokens_for_gradio</code></td>
          <td>
                <code>bool</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>bool: Determine whether the stream tokens</p>
            </div>
          </td>
          <td>
                <code>True</code>
          </td>
        </tr>
        <tr>
          <td><code>use_prefix_tokenizer</code></td>
          <td>
                <code>bool</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>bool: Determine if the tokenizer should be used to generate tokens</p>
            </div>
          </td>
          <td>
                <code>True</code>
          </td>
        </tr>
        <tr>
          <td><code>pre_compile</code></td>
          <td>
                <code>bool</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>bool: Pre-compile the model</p>
            </div>
          </td>
          <td>
                <code>True</code>
          </td>
        </tr>
        <tr>
          <td><code></code></td>
          <td>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Set the host address</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Nothing</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>lib/python/EasyDel/serve/jax_serve.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">host</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;0.0.0.0&quot;</span><span class="p">,</span>
        <span class="n">port</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">2059</span><span class="p">,</span>
        <span class="n">batch_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
        <span class="n">contains_auto_format</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">max_length</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">4096</span><span class="p">,</span>
        <span class="n">max_new_tokens</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">4096</span><span class="p">,</span>
        <span class="n">max_stream_tokens</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">64</span><span class="p">,</span>
        <span class="n">temperature</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">,</span>
        <span class="n">top_p</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.95</span><span class="p">,</span>
        <span class="n">top_k</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">50</span><span class="p">,</span>
        <span class="n">logging</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">mesh_axes_names</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;dp&quot;</span><span class="p">,</span> <span class="s2">&quot;fsdp&quot;</span><span class="p">,</span> <span class="s2">&quot;tp&quot;</span><span class="p">,</span> <span class="s2">&quot;mp&quot;</span><span class="p">),</span>
        <span class="n">mesh_axes_shape</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
        <span class="n">dtype</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;fp16&#39;</span><span class="p">,</span>
        <span class="n">stream_tokens_for_gradio</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">use_prefix_tokenizer</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">pre_compile</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The __init__ function is called when the class is instantiated.</span>
<span class="sd">    It sets up the attributes of an instance of this class, which are:</span>
<span class="sd">        host: str = &amp;quot;0.0.0.0&amp;quot;</span>
<span class="sd">            The IP address to listen on for incoming requests from clients</span>

<span class="sd">    :param self: Represent the instance of the class</span>
<span class="sd">    :param host: str: Set the host address of the server</span>
<span class="sd">    :param port: int: Specify the port number that the server will run on</span>
<span class="sd">    :param batch_size: int: Set the batch size of the model</span>
<span class="sd">    :param contains_auto_format: bool: Determine whether the input text contains auto-formatting</span>
<span class="sd">    :param max_length: int: Set the maximum length of the text that can be generated</span>
<span class="sd">    :param max_new_tokens: int: Determine how many tokens can be added to the vocabulary</span>
<span class="sd">    :param max_stream_tokens: int: Set the maximum number of tokens that can be streamed at a time</span>
<span class="sd">    :param temperature: float: Control the randomness of the output</span>
<span class="sd">    :param top_p: float: Control the diversity of the text generated</span>
<span class="sd">    :param top_k: int: Limit the number of tokens that can be generated</span>
<span class="sd">    :param logging: bool: Print out the progress of the server</span>
<span class="sd">    :param mesh_axes_names: Sequence[str]: Specify the names of the axes in the mesh tensor</span>
<span class="sd">    :param &amp;quot;fsdp&amp;quot;: Set the number of tokens to be generated</span>
<span class="sd">    :param &amp;quot;tp&amp;quot;: Set the top_p value</span>
<span class="sd">    :param &amp;quot;mp&amp;quot;): Define the mesh_axes_names</span>
<span class="sd">    :param mesh_axes_shape: Sequence[int]: Specify the shape of the mesh</span>
<span class="sd">    :param dtype: str: Specify the data type of the model</span>
<span class="sd">    :param stream_tokens_for_gradio: bool: Determine whether the stream tokens</span>
<span class="sd">    :param use_prefix_tokenizer: bool: Determine if the tokenizer should be used to generate tokens</span>
<span class="sd">    :param pre_compile: bool: Pre-compile the model</span>
<span class="sd">    :param : Set the host address</span>
<span class="sd">    :return: Nothing</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">host</span> <span class="o">=</span> <span class="n">host</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">port</span> <span class="o">=</span> <span class="n">port</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">batch_size</span> <span class="o">=</span> <span class="n">batch_size</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">contains_auto_format</span> <span class="o">=</span> <span class="n">contains_auto_format</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">max_length</span> <span class="o">=</span> <span class="n">max_length</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">max_new_tokens</span> <span class="o">=</span> <span class="n">max_new_tokens</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">max_stream_tokens</span> <span class="o">=</span> <span class="n">max_stream_tokens</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">temperature</span> <span class="o">=</span> <span class="n">temperature</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">top_p</span> <span class="o">=</span> <span class="n">top_p</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">top_k</span> <span class="o">=</span> <span class="n">top_k</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">logging</span> <span class="o">=</span> <span class="n">logging</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">mesh_axes_names</span> <span class="o">=</span> <span class="n">mesh_axes_names</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">mesh_axes_shape</span> <span class="o">=</span> <span class="n">mesh_axes_shape</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">dtype</span> <span class="o">=</span> <span class="n">dtype</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">stream_tokens_for_gradio</span> <span class="o">=</span> <span class="n">stream_tokens_for_gradio</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">use_prefix_tokenizer</span> <span class="o">=</span> <span class="n">use_prefix_tokenizer</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">pre_compile</span> <span class="o">=</span> <span class="n">pre_compile</span>
    <span class="k">assert</span> <span class="n">max_new_tokens</span> <span class="o">%</span> <span class="n">max_stream_tokens</span> <span class="o">==</span> <span class="mi">0</span><span class="p">,</span> \
        <span class="s1">&#39;max_new_tokens should be divisible by  max_new_tokens&#39;</span> \
        <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">max_new_tokens</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="n">max_stream_tokens</span><span class="si">}</span><span class="s1">&#39;</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>



  </div>

  </div>

</div>




  </div>

  </div>

</div>





                
              </article>
            </div>
          
          
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Erfan Zare Chavoshi-EasyDel
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "..", "features": [], "search": "../assets/javascripts/workers/search.f886a092.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.cd18aaf1.min.js"></script>
      
    
  </body>
</html>